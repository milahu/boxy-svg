const e=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},t={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=i>>2,h=(3&i)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(l=64)),r.push(n[u],n[h],n[l],n[d])}return r.join("")},encodeString(t,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(t):this.encodeByteArray(e(t),n)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const r=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){const s=r[e.charAt(t++)],o=t<e.length?r[e.charAt(t)]:0;++t;const a=t<e.length?r[e.charAt(t)]:64;++t;const c=t<e.length?r[e.charAt(t)]:64;if(++t,null==s||null==o||null==a||null==c)throw new n;const u=s<<2|o>>4;if(i.push(u),64!==a){const e=o<<4&240|a>>2;if(i.push(e),64!==c){const e=a<<6&192|c;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class n extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const r=function(n){return function(n){const r=e(n);return t.encodeByteArray(r,!0)}(n).replace(/\./g,"")},i=function(e){try{return t.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},s=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&i(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},o=e=>{const t=(e=>{var t,n;return null===(n=null===(t=s())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]})(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},a=()=>{var e;return null===(e=s())||void 0===e?void 0:e.config};class c{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function u(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function h(){return!function(){var e;const t=null===(e=s())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function l(){try{return"object"==typeof indexedDB}catch(e){return!1}}class d extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,d.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,f.prototype.create)}}class f{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(p,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new d(r,o,n)}}const p=/\{\$([^}]+)}/g;function g(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(m(n)&&m(s)){if(!g(n,s))return!1}else if(n!==s)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function m(e){return null!==e&&"object"==typeof e}function y(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function v(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function w(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class _{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=I),void 0===r.error&&(r.error=I),void 0===r.complete&&(r.complete=I);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function I(){}function b(e){return e&&e._delegate?e._delegate:e}class E{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const T="[DEFAULT]";class S{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new c;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:T})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=T){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=T){return this.instances.has(e)}getOptions(e=T){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===T?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=T){return this.component?this.component.multipleInstances?e:T:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class C{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new S(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var A;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(A||(A={}));const k={debug:A.DEBUG,verbose:A.VERBOSE,info:A.INFO,warn:A.WARN,error:A.ERROR,silent:A.SILENT},N=A.INFO,D={[A.DEBUG]:"log",[A.VERBOSE]:"log",[A.INFO]:"info",[A.WARN]:"warn",[A.ERROR]:"error"},x=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=D[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class R{constructor(e){this.name=e,this._logLevel=N,this._logHandler=x,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in A))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?k[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,A.DEBUG,...e),this._logHandler(this,A.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,A.VERBOSE,...e),this._logHandler(this,A.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,A.INFO,...e),this._logHandler(this,A.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,A.WARN,...e),this._logHandler(this,A.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,A.ERROR,...e),this._logHandler(this,A.ERROR,...e)}}const O=(e,t)=>t.some((t=>e instanceof t));let P,L;const M=new WeakMap,U=new WeakMap,F=new WeakMap,V=new WeakMap,B=new WeakMap;let q={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return U.get(e);if("objectStoreNames"===t)return e.objectStoreNames||F.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return j(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function j(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(j(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&M.set(t,e)})).catch((()=>{})),B.set(t,e),t}(e);if(V.has(e))return V.get(e);const t=function(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(L||(L=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(z(this),e),j(M.get(this))}:function(...e){return j(t.apply(z(this),e))}:function(e,...n){const r=t.call(z(this),e,...n);return F.set(r,e.sort?e.sort():[e]),j(r)}:(e instanceof IDBTransaction&&function(e){if(U.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));U.set(e,t)}(e),O(e,P||(P=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,q):e);var t}(e);return t!==e&&(V.set(e,t),B.set(t,e)),t}const z=e=>B.get(e),K=["get","getKey","getAll","getAllKeys","count"],$=["put","add","delete","clear"],G=new Map;function H(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(G.get(t))return G.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=$.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!K.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return G.set(t,s),s}var Q;Q=q,q={...Q,get:(e,t,n)=>H(e,t)||Q.get(e,t,n),has:(e,t)=>!!H(e,t)||Q.has(e,t)};class W{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const Y="@firebase/app",J="0.9.27",X=new R("@firebase/app"),Z="[DEFAULT]",ee={[Y]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},te=new Map,ne=new Map;function re(e,t){try{e.container.addComponent(t)}catch(n){X.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function ie(e){const t=e.name;if(ne.has(t))return X.debug(`There were multiple attempts to register component ${t}.`),!1;ne.set(t,e);for(const t of te.values())re(t,e);return!0}function se(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const oe=new f("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class ae{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new E("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw oe.create("app-deleted",{appName:this._name})}}const ce="10.8.0";function ue(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const r=Object.assign({name:Z,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!=typeof i||!i)throw oe.create("bad-app-name",{appName:String(i)});if(n||(n=a()),!n)throw oe.create("no-options");const s=te.get(i);if(s){if(g(n,s.options)&&g(r,s.config))return s;throw oe.create("duplicate-app",{appName:i})}const o=new C(i);for(const e of ne.values())o.addComponent(e);const c=new ae(n,r,o);return te.set(i,c),c}function he(e=Z){const t=te.get(e);if(!t&&e===Z&&a())return ue();if(!t)throw oe.create("no-app",{appName:e});return t}function le(e,t,n){var r;let i=null!==(r=ee[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${i}" with version "${t}":`];return s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void X.warn(e.join(" "))}ie(new E(`${i}-version`,(()=>({library:i,version:t})),"VERSION"))}const de="firebase-heartbeat-database",fe=1,pe="firebase-heartbeat-store";let ge=null;function me(){return ge||(ge=function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=j(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(j(o.result),e.oldVersion,e.newVersion,j(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}(de,fe,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(pe)}catch(e){console.warn(e)}}}).catch((e=>{throw oe.create("idb-open",{originalErrorMessage:e.message})}))),ge}async function ye(e,t){try{const n=(await me()).transaction(pe,"readwrite"),r=n.objectStore(pe);await r.put(t,ve(e)),await n.done}catch(e){if(e instanceof d)X.warn(e.message);else{const t=oe.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});X.warn(t.message)}}}function ve(e){return`${e.name}!${e.options.appId}`}class we{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Ie(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=_e();if((null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==r&&!this._heartbeatsCache.heartbeats.some((e=>e.date===r)))return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var e;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=_e(),{heartbeatsToSend:n,unsentEntries:i}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),be(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),be(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),s=r(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}}function _e(){return(new Date).toISOString().substring(0,10)}class Ie{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!l()&&new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await me()).transaction(pe),n=await t.objectStore(pe).get(ve(e));return await t.done,n}catch(e){if(e instanceof d)X.warn(e.message);else{const t=oe.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});X.warn(t.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return ye(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return ye(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function be(e){return r(JSON.stringify({version:2,heartbeats:e})).length}function Ee(e,t){const n={};for(const r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}function Te(e){if(null==e)return null;if(e instanceof Number&&(e=e.valueOf()),"number"==typeof e&&isFinite(e))return e;if(!0===e||!1===e)return e;if("[object String]"===Object.prototype.toString.call(e))return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map((e=>Te(e)));if("function"==typeof e||"object"==typeof e)return Ee(e,(e=>Te(e)));throw new Error("Data cannot be encoded in JSON: "+e)}function Se(e){if(null==e)return e;if(e["@type"])switch(e["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":{const t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t}default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map((e=>Se(e))):"function"==typeof e||"object"==typeof e?Ee(e,(e=>Se(e))):e}ie(new E("platform-logger",(e=>new W(e)),"PRIVATE")),ie(new E("heartbeat",(e=>new we(e)),"PRIVATE")),le(Y,J,""),le(Y,J,"esm2017"),le("fire-js",""),le("firebase","10.8.0","app");const Ce="functions",Ae={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ke extends d{constructor(e,t,n){super(`${Ce}/${e}`,t||""),this.details=n}}class Ne{constructor(e,t,n){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then((e=>this.auth=e),(()=>{})),this.messaging||t.get().then((e=>this.messaging=e),(()=>{})),this.appCheck||n.get().then((e=>this.appCheck=e),(()=>{}))}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return null==e?void 0:e.accessToken}catch(e){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return await this.messaging.getToken()}catch(e){return}}async getAppCheckToken(e){if(this.appCheck){const t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){return{authToken:await this.getAuthToken(),messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken(e)}}}const De="us-central1";class xe{constructor(e,t,n,r,i=De,s){this.app=e,this.fetchImpl=s,this.emulatorOrigin=null,this.contextProvider=new Ne(t,n,r),this.cancelAllRequests=new Promise((e=>{this.deleteService=()=>Promise.resolve(e())}));try{const e=new URL(i);this.customDomain=e.origin,this.region=De}catch(e){this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;return null!==this.emulatorOrigin?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:null!==this.customDomain?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}async function Re(e,t,n,r){let i;n["Content-Type"]="application/json";try{i=await r(e,{method:"POST",body:JSON.stringify(t),headers:n})}catch(e){return{status:0,json:null}}let s=null;try{s=await i.json()}catch(e){}return{status:i.status,json:s}}const Oe="@firebase/functions",Pe="0.11.1";var Le;Le=fetch.bind(self),ie(new E(Ce,((e,{instanceIdentifier:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("messaging-internal"),s=e.getProvider("app-check-internal");return new xe(n,r,i,s,t,Le)}),"PUBLIC").setMultipleInstances(!0)),le(Oe,Pe,void 0),le(Oe,Pe,"esm2017");const Me="firebasestorage.googleapis.com",Ue="storageBucket";class Fe extends d{constructor(e,t,n=0){super(qe(e),`Firebase Storage: ${t} (${qe(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Fe.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return qe(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var Ve,Be;function qe(e){return"storage/"+e}function je(){return new Fe(Ve.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function ze(){return new Fe(Ve.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function Ke(){return new Fe(Ve.CANCELED,"User canceled the upload/download.")}function $e(){return new Fe(Ve.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function Ge(e){return new Fe(Ve.INVALID_ARGUMENT,e)}function He(){return new Fe(Ve.APP_DELETED,"The Firebase app was deleted.")}function Qe(e){throw new Fe(Ve.INTERNAL_ERROR,"Internal error: "+e)}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(Ve||(Ve={}));class We{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=We.makeFromUrl(e,t)}catch(t){return new We(e,"")}if(""===n.path)return n;throw r=e,new Fe(Ve.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.");var r}static makeFromUrl(e,t){let n=null;const r="([A-Za-z0-9.\\-_]+)",i=new RegExp("^gs://"+r+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}const o=t.replace(/[.]/g,"\\."),a=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${t===Me?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let t=0;t<a.length;t++){const r=a[t],i=r.regex.exec(e);if(i){const e=i[r.indices.bucket];let t=i[r.indices.path];t||(t=""),n=new We(e,t),r.postModify(n);break}}if(null==n)throw function(e){return new Fe(Ve.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return n}}class Ye{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function Je(e){return"string"==typeof e||e instanceof String}function Xe(e){return Ze()&&e instanceof Blob}function Ze(){return"undefined"!=typeof Blob}function et(e,t,n,r){if(r<t)throw Ge(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>n)throw Ge(`Invalid value for '${e}'. Expected ${n} or less.`)}function tt(e,t,n){let r=t;return null==n&&(r=`https://${t}`),`${n}://${r}/v0${e}`}function nt(e,t){const n=e>=500&&e<600,r=-1!==[408,429].indexOf(e),i=-1!==t.indexOf(e);return n||r||i}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(Be||(Be={}));class rt{constructor(e,t,n,r,i,s,o,a,c,u,h,l=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=o,this.errorCallback_=a,this.timeout_=c,this.progressCallback_=u,this.connectionFactory_=h,this.retry=l,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()}))}start_(){const e=(e,t)=>{const n=this.resolve_,r=this.reject_,i=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(i,i.getResponse());!function(e){return void 0!==e}(e)?n():n(e)}catch(e){r(e)}else if(null!==i){const e=je();e.serverResponse=i.getErrorText(),this.errorCallback_?r(this.errorCallback_(i,e)):r(e)}else t.canceled?r(this.appDelete_?He():Ke()):r(ze())};this.canceled_?e(0,new it(!1,null,!0)):this.backoffId_=function(e,t,n){let r=1,i=null,s=null,o=!1,a=0;function c(){return 2===a}let u=!1;function h(...e){u||(u=!0,t.apply(null,e))}function l(t){i=setTimeout((()=>{i=null,e(f,c())}),t)}function d(){s&&clearTimeout(s)}function f(e,...t){if(u)return void d();if(e)return d(),void h.call(null,e,...t);if(c()||o)return d(),void h.call(null,e,...t);let n;r<64&&(r*=2),1===a?(a=2,n=0):n=1e3*(r+Math.random()),l(n)}let p=!1;function g(e){p||(p=!0,d(),u||(null!==i?(e||(a=2),clearTimeout(i),l(0)):e||(a=1)))}return l(0),s=setTimeout((()=>{o=!0,g(!0)}),n),g}(((e,t)=>{if(t)return void e(!1,new it(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const r=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;const t=n.getErrorCode()===Be.NO_ERROR,i=n.getStatus();if(!t||nt(i,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===Be.ABORT;return void e(!1,new it(!1,null,t))}const s=-1!==this.successCodes_.indexOf(i);e(!0,new it(s,n))}))}),e,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&function(e){e(!1)}(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class it{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function st(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function ot(...e){const t=st();if(void 0!==t){const n=new t;for(let t=0;t<e.length;t++)n.append(e[t]);return n.getBlob()}if(Ze())return new Blob(e);throw new Fe(Ve.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}class at{constructor(e,t){this.data=e,this.contentType=t||null}}function ct(e){const t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);r<=127?t.push(r):r<=2047?t.push(192|r>>6,128|63&r):55296==(64512&r)?n<e.length-1&&56320==(64512&e.charCodeAt(n+1))?(r=65536|(1023&r)<<10|1023&e.charCodeAt(++n),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)):t.push(239,191,189):56320==(64512&r)?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(t)}class ut{constructor(e,t){let n=0,r="";Xe(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(Xe(this.data_)){const s=(r=e,i=t,(n=this.data_).webkitSlice?n.webkitSlice(r,i):n.mozSlice?n.mozSlice(r,i):n.slice?n.slice(r,i):null);return null===s?null:new ut(s)}var n,r,i;{const n=new Uint8Array(this.data_.buffer,e,t-e);return new ut(n,!0)}}static getBlob(...e){if(Ze()){const t=e.map((e=>e instanceof ut?e.data_:e));return new ut(ot.apply(null,t))}{const t=e.map((e=>{return Je(e)?(t=e,new at(ct(t))).data:e.data_;var t}));let n=0;t.forEach((e=>{n+=e.byteLength}));const r=new Uint8Array(n);let i=0;return t.forEach((e=>{for(let t=0;t<e.length;t++)r[i++]=e[t]})),new ut(r,!0)}}uploadData(){return this.data_}}function ht(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function lt(e,t){return t}class dt{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||lt}}let ft=null;function pt(){if(ft)return ft;const e=[];e.push(new dt("bucket")),e.push(new dt("generation")),e.push(new dt("metageneration")),e.push(new dt("name","fullPath",!0));const t=new dt("name");t.xform=function(e,t){return function(e){return!Je(e)||e.length<2?e:ht(e)}(t)},e.push(t);const n=new dt("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new dt("timeCreated")),e.push(new dt("updated")),e.push(new dt("md5Hash",null,!0)),e.push(new dt("cacheControl",null,!0)),e.push(new dt("contentDisposition",null,!0)),e.push(new dt("contentEncoding",null,!0)),e.push(new dt("contentLanguage",null,!0)),e.push(new dt("contentType",null,!0)),e.push(new dt("metadata","customMetadata",!0)),ft=e,ft}function gt(e,t){const n={},r=t.length;for(let i=0;i<r;i++){const r=t[i];r.writable&&(n[r.server]=e[r.local])}return JSON.stringify(n)}class mt{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function yt(e){if(!e)throw je()}function vt(e,t){return function(n,r){const i=function(e,t,n){const r=function(e){let t;try{t=JSON.parse(e)}catch(e){return null}return function(e){return"object"==typeof e&&!Array.isArray(e)}(t)?t:null}(t);return null===r?null:function(e,t,n){const r={type:"file"},i=n.length;for(let e=0;e<i;e++){const i=n[e];r[i.local]=i.xform(r,t[i.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){const n=e.bucket,r=e.fullPath,i=new We(n,r);return t._makeStorageReference(i)}})}(r,e),r}(e,r,n)}(e,r,t);return yt(null!==i),i}}function wt(e){return function(t,n){let r;var i,s;return 401===t.getStatus()?r=t.getErrorText().includes("Firebase App Check token is invalid")?new Fe(Ve.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new Fe(Ve.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(s=e.bucket,r=new Fe(Ve.QUOTA_EXCEEDED,"Quota for bucket '"+s+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(i=e.path,r=new Fe(Ve.UNAUTHORIZED,"User does not have permission to access '"+i+"'.")):r=n,r.status=t.getStatus(),r.serverResponse=n.serverResponse,r}}function _t(e){const t=wt(e);return function(n,r){let i=t(n,r);var s;return 404===n.getStatus()&&(s=e.path,i=new Fe(Ve.OBJECT_NOT_FOUND,"Object '"+s+"' does not exist.")),i.serverResponse=r.serverResponse,i}}function It(e,t,n){const r=tt(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime,s=new mt(r,"GET",vt(e,n),i);return s.errorHandler=_t(t),s}function bt(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=function(e,t){return t&&t.type()||"application/octet-stream"}(0,t)),r}class Et{constructor(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null}}function Tt(e,t){let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(e){yt(!1)}return yt(!!n&&-1!==(t||["active"]).indexOf(n)),n}const St=262144,Ct="running",At="paused",kt="success",Nt="canceled",Dt="error";function xt(e){switch(e){case"running":case"pausing":case"canceling":return Ct;case"paused":return At;case"success":return kt;case"canceled":return Nt;default:return Dt}}class Rt{constructor(e,t,n){const r=function(e){return"function"==typeof e}(e)||null!=t||null!=n;if(r)this.next=e,this.error=null!=t?t:void 0,this.complete=null!=n?n:void 0;else{const t=e;this.next=t.next,this.error=t.error,this.complete=t.complete}}}function Ot(e){return(...t)=>{Promise.resolve().then((()=>e(...t)))}}class Pt{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Be.NO_ERROR,this.sendPromise_=new Promise((e=>{this.xhr_.addEventListener("abort",(()=>{this.errorCode_=Be.ABORT,e()})),this.xhr_.addEventListener("error",(()=>{this.errorCode_=Be.NETWORK_ERROR,e()})),this.xhr_.addEventListener("load",(()=>{e()}))}))}send(e,t,n,r){if(this.sent_)throw Qe("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const e in r)r.hasOwnProperty(e)&&this.xhr_.setRequestHeader(e,r[e].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Qe("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Qe("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(!this.sent_)throw Qe("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Qe("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class Lt extends Pt{initXhr(){this.xhr_.responseType="text"}}function Mt(){return new Lt}class Ut{constructor(e,t,n=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=n,this._mappings=pt(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=e=>{if(this._request=void 0,this._chunkMultiplier=1,e._codeEquals(Ve.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const t=this.isExponentialBackoffExpired();if(nt(e.status,[])){if(!t)return this.sleepTime=Math.max(2*this.sleepTime,1e3),this._needToFetchStatus=!0,void this.completeTransitions_();e=ze()}this._error=e,this._transition("error")}},this._metadataErrorHandler=e=>{this._request=void 0,e._codeEquals(Ve.CANCELED)?this.completeTransitions_():(this._error=e,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise(((e,t)=>{this._resolve=e,this._reject=t,this._start()})),this._promise.then(null,(()=>{}))}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const e=this._transferred;return t=>this._updateProgress(e+t)}_shouldDoResumable(e){return e.size()>262144}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout((()=>{this.pendingTimeout=void 0,this._continueUpload()}),this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then((([t,n])=>{switch(this._state){case"running":e(t,n);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}}))}_createResumable(){this._resolveToken(((e,t)=>{const n=function(e,t,n,r,i){const s=t.bucketOnlyServerUrl(),o=bt(t,r,i),a={name:o.fullPath},c=tt(s,e.host,e._protocol),u={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},h=gt(o,n),l=e.maxUploadRetryTime,d=new mt(c,"POST",(function(e){let t;Tt(e);try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(e){yt(!1)}return yt(Je(t)),t}),l);return d.urlParams=a,d.headers=u,d.body=h,d.errorHandler=wt(t),d}(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(n,Mt,e,t);this._request=r,r.getPromise().then((e=>{this._request=void 0,this._uploadUrl=e,this._needToFetchStatus=!1,this.completeTransitions_()}),this._errorHandler)}))}_fetchStatus(){const e=this._uploadUrl;this._resolveToken(((t,n)=>{const r=function(e,t,n,r){const i=e.maxUploadRetryTime,s=new mt(n,"POST",(function(e){const t=Tt(e,["active","final"]);let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){yt(!1)}n||yt(!1);const i=Number(n);return yt(!isNaN(i)),new Et(i,r.size(),"final"===t)}),i);return s.headers={"X-Goog-Upload-Command":"query"},s.errorHandler=wt(t),s}(this._ref.storage,this._ref._location,e,this._blob),i=this._ref.storage._makeRequest(r,Mt,t,n);this._request=i,i.getPromise().then((e=>{this._request=void 0,this._updateProgress(e.current),this._needToFetchStatus=!1,e.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()}),this._errorHandler)}))}_continueUpload(){const e=St*this._chunkMultiplier,t=new Et(this._transferred,this._blob.size()),n=this._uploadUrl;this._resolveToken(((r,i)=>{let s;try{s=function(e,t,n,r,i,s,o,a){const c=new Et(0,0);if(o?(c.current=o.current,c.total=o.total):(c.current=0,c.total=r.size()),r.size()!==c.total)throw new Fe(Ve.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");const u=c.total-c.current;let h=u;i>0&&(h=Math.min(h,i));const l=c.current,d=l+h;let f="";f=0===h?"finalize":u===h?"upload, finalize":"upload";const p={"X-Goog-Upload-Command":f,"X-Goog-Upload-Offset":`${c.current}`},g=r.slice(l,d);if(null===g)throw $e();const m=t.maxUploadRetryTime,y=new mt(n,"POST",(function(e,n){const i=Tt(e,["active","final"]),o=c.current+h,a=r.size();let u;return u="final"===i?vt(t,s)(e,n):null,new Et(o,a,"final"===i,u)}),m);return y.headers=p,y.body=g.uploadData(),y.progressCallback=a||null,y.errorHandler=wt(e),y}(this._ref._location,this._ref.storage,n,this._blob,e,this._mappings,t,this._makeProgressCallback())}catch(e){return this._error=e,void this._transition("error")}const o=this._ref.storage._makeRequest(s,Mt,r,i,!1);this._request=o,o.getPromise().then((e=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(e.current),e.finalized?(this._metadata=e.metadata,this._transition("success")):this.completeTransitions_()}),this._errorHandler)}))}_increaseMultiplier(){St*this._chunkMultiplier*2<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken(((e,t)=>{const n=It(this._ref.storage,this._ref._location,this._mappings),r=this._ref.storage._makeRequest(n,Mt,e,t);this._request=r,r.getPromise().then((e=>{this._request=void 0,this._metadata=e,this._transition("success")}),this._metadataErrorHandler)}))}_oneShotUpload(){this._resolveToken(((e,t)=>{const n=function(e,t,n,r,i){const s=t.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"},a=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();o["Content-Type"]="multipart/related; boundary="+a;const c=bt(t,r,i),u="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+gt(c,n)+"\r\n--"+a+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",h="\r\n--"+a+"--",l=ut.getBlob(u,r,h);if(null===l)throw $e();const d={name:c.fullPath},f=tt(s,e.host,e._protocol),p=e.maxUploadRetryTime,g=new mt(f,"POST",vt(e,n),p);return g.urlParams=d,g.headers=o,g.body=l.uploadData(),g.errorHandler=wt(t),g}(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(n,Mt,e,t);this._request=r,r.getPromise().then((e=>{this._request=void 0,this._metadata=e,this._updateProgress(this._blob.size()),this._transition("success")}),this._errorHandler)}))}_updateProgress(e){const t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":case"error":case"success":this._state=e,this._notifyObservers();break;case"canceled":this._error=Ke(),this._state=e,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){const e=xt(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,n,r){const i=new Rt(t||void 0,n||void 0,r||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const t=this._observers.indexOf(e);-1!==t&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach((e=>{this._notifyObserver(e)}))}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(xt(this._state)){case kt:Ot(this._resolve.bind(null,this.snapshot))();break;case Nt:case Dt:Ot(this._reject.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(xt(this._state)){case Ct:case At:e.next&&Ot(e.next.bind(e,this.snapshot))();break;case kt:e.complete&&Ot(e.complete.bind(e))();break;default:e.error&&Ot(e.error.bind(e,this._error))()}}resume(){const e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){const e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){const e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}class Ft{constructor(e,t){this._service=e,this._location=t instanceof We?t:We.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Ft(e,t)}get root(){const e=new We(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return ht(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new We(this._location.bucket,e);return new Ft(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new Fe(Ve.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function Vt(e,t){if(e instanceof jt){const n=e;if(null==n._bucket)throw new Fe(Ve.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Ue+"' property when initializing the app?");const r=new Ft(n,n._bucket);return null!=t?Vt(r,t):r}return void 0!==t?function(e,t){const n=function(e,t){const n=t.split("/").filter((e=>e.length>0)).join("/");return 0===e.length?n:e+"/"+n}(e._location.path,t),r=new We(e._location.bucket,n);return new Ft(e.storage,r)}(e,t):e}function Bt(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof jt)return new Ft(e,t);throw Ge("To use ref(service, url), the first argument must be a Storage instance.")}return Vt(e,t)}function qt(e,t){const n=null==t?void 0:t[Ue];return null==n?null:We.makeFromBucketSpec(n,e)}class jt{constructor(e,t,n,r,i){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._bucket=null,this._host=Me,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?We.makeFromBucketSpec(r,this._host):qt(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=We.makeFromBucketSpec(this._url,e):this._bucket=qt(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){et("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){et("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((e=>e.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Ft(this,e)}_makeRequest(e,t,n,r,i=!0){if(this._deleted)return new Ye(He());{const s=function(e,t,n,r,i,s,o=!0){const a=function(e){const t=encodeURIComponent;let n="?";for(const r in e)e.hasOwnProperty(r)&&(n=n+(t(r)+"=")+t(e[r])+"&");return n=n.slice(0,-1),n}(e.urlParams),c=e.url+a,u=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(u,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(u,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!=t?t:"AppManager")}(u,s),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(u,r),new rt(c,e.method,u,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i,o)}(e,this._appId,n,r,t,this._firebaseVersion,i);return this._requests.add(s),s.getPromise().then((()=>this._requests.delete(s)),(()=>this._requests.delete(s))),s}}async makeRequestWithTokens(e,t){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const zt="@firebase/storage",Kt="0.12.1",$t="storage";ie(new E($t,(function(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return new jt(n,r,i,t,ce)}),"PUBLIC").setMultipleInstances(!0)),le(zt,Kt,""),le(zt,Kt,"esm2017");var Gt,Ht="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Qt=Qt||{},Wt=Ht||self;function Yt(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function Jt(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var Xt="closure_uid_"+(1e9*Math.random()>>>0),Zt=0;function en(e,t,n){return e.call.apply(e.bind,arguments)}function tn(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function nn(e,t,n){return(nn=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?en:tn).apply(null,arguments)}function rn(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function sn(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function on(){this.s=this.s,this.o=this.o}on.prototype.s=!1,on.prototype.sa=function(){var e;!this.s&&(this.s=!0,this.N(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,Xt)&&e[Xt]||(e[Xt]=++Zt))},on.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const an=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function cn(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function un(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(Yt(n)){const t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function hn(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}hn.prototype.h=function(){this.defaultPrevented=!0};var ln=function(){if(!Wt.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};Wt.addEventListener("test",e,t),Wt.removeEventListener("test",e,t)}catch(e){}return e}();function dn(e){return/^[\s\xa0]*$/.test(e)}function fn(){var e=Wt.navigator;return e&&(e=e.userAgent)?e:""}function pn(e){return-1!=fn().indexOf(e)}function gn(e){return gn[" "](e),e}gn[" "]=function(){};var mn,yn,vn=pn("Opera"),wn=pn("Trident")||pn("MSIE"),_n=pn("Edge"),In=_n||wn,bn=pn("Gecko")&&!(-1!=fn().toLowerCase().indexOf("webkit")&&!pn("Edge"))&&!(pn("Trident")||pn("MSIE"))&&!pn("Edge"),En=-1!=fn().toLowerCase().indexOf("webkit")&&!pn("Edge");function Tn(){var e=Wt.document;return e?e.documentMode:void 0}e:{var Sn="",Cn=(yn=fn(),bn?/rv:([^\);]+)(\)|;)/.exec(yn):_n?/Edge\/([\d\.]+)/.exec(yn):wn?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(yn):En?/WebKit\/(\S+)/.exec(yn):vn?/(?:Version)[ \/]?(\S+)/.exec(yn):void 0);if(Cn&&(Sn=Cn?Cn[1]:""),wn){var An=Tn();if(null!=An&&An>parseFloat(Sn)){mn=String(An);break e}}mn=Sn}var kn=Wt.document&&wn&&(Tn()||parseInt(mn,10))||void 0;function Nn(e,t){if(hn.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(bn){e:{try{gn(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:Dn[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&Nn.$.h.call(this)}}sn(Nn,hn);var Dn={2:"touch",3:"pen",4:"mouse"};Nn.prototype.h=function(){Nn.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var xn="closure_listenable_"+(1e6*Math.random()|0),Rn=0;function On(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.la=i,this.key=++Rn,this.fa=this.ia=!1}function Pn(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function Ln(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function Mn(e){const t={};for(const n in e)t[n]=e[n];return t}const Un="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Fn(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<Un.length;t++)n=Un[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function Vn(e){this.src=e,this.g={},this.h=0}function Bn(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=an(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(Pn(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function qn(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.fa&&s.listener==t&&s.capture==!!n&&s.la==r)return i}return-1}Vn.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=qn(e,t,r,i);return-1<o?(t=e[o],n||(t.ia=!1)):((t=new On(t,this.src,s,!!r,i)).ia=n,e.push(t)),t};var jn="closure_lm_"+(1e6*Math.random()|0),zn={};function Kn(e,t,n,r,i){if(r&&r.once)return Gn(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)Kn(e,t[s],n,r,i);return null}return n=Zn(n),e&&e[xn]?e.O(t,n,Jt(r)?!!r.capture:!!r,i):$n(e,t,n,!1,r,i)}function $n(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=Jt(i)?!!i.capture:!!i,a=Jn(e);if(a||(e[jn]=a=new Vn(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function(){const e=Yn;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)ln||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Wn(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function Gn(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)Gn(e,t[s],n,r,i);return null}return n=Zn(n),e&&e[xn]?e.P(t,n,Jt(r)?!!r.capture:!!r,i):$n(e,t,n,!0,r,i)}function Hn(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)Hn(e,t[s],n,r,i);else r=Jt(r)?!!r.capture:!!r,n=Zn(n),e&&e[xn]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=qn(s=e.g[t],n,r,i))&&(Pn(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=Jn(e))&&(t=e.g[t.toString()],e=-1,t&&(e=qn(t,n,r,i)),(n=-1<e?t[e]:null)&&Qn(n))}function Qn(e){if("number"!=typeof e&&e&&!e.fa){var t=e.src;if(t&&t[xn])Bn(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Wn(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Jn(t))?(Bn(n,e),0==n.h&&(n.src=null,t[jn]=null)):Pn(e)}}}function Wn(e){return e in zn?zn[e]:zn[e]="on"+e}function Yn(e,t){if(e.fa)e=!0;else{t=new Nn(t,this);var n=e.listener,r=e.la||e.src;e.ia&&Qn(e),e=n.call(r,t)}return e}function Jn(e){return(e=e[jn])instanceof Vn?e:null}var Xn="__closure_events_fn_"+(1e9*Math.random()>>>0);function Zn(e){return"function"==typeof e?e:(e[Xn]||(e[Xn]=function(t){return e.handleEvent(t)}),e[Xn])}function er(){on.call(this),this.i=new Vn(this),this.S=this,this.J=null}function tr(e,t){var n,r=e.J;if(r)for(n=[];r;r=r.J)n.push(r);if(e=e.S,r=t.type||t,"string"==typeof t)t=new hn(t,e);else if(t instanceof hn)t.target=t.target||e;else{var i=t;Fn(t=new hn(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=nr(o,r,!0,t)&&i}if(i=nr(o=t.g=e,r,!0,t)&&i,i=nr(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=nr(o=t.g=n[s],r,!1,t)&&i}function nr(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&Bn(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}sn(er,on),er.prototype[xn]=!0,er.prototype.removeEventListener=function(e,t,n,r){Hn(this,e,t,n,r)},er.prototype.N=function(){if(er.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)Pn(n[r]);delete t.g[e],t.h--}}this.J=null},er.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},er.prototype.P=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var rr=Wt.JSON.stringify;function ir(){var e=lr;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var sr=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new or),(e=>e.reset()));class or{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function ar(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function cr(e){Wt.setTimeout((()=>{throw e}),0)}let ur,hr=!1,lr=new class{constructor(){this.h=this.g=null}add(e,t){const n=sr.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},dr=()=>{const e=Wt.Promise.resolve(void 0);ur=()=>{e.then(fr)}};var fr=()=>{for(var e;e=ir();){try{e.h.call(e.g)}catch(e){cr(e)}var t=sr;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}hr=!1};function pr(e,t){er.call(this),this.h=e||1,this.g=t||Wt,this.j=nn(this.qb,this),this.l=Date.now()}function gr(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function mr(e,t,n){if("function"==typeof e)n&&(e=nn(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=nn(e.handleEvent,e)}return 2147483647<Number(t)?-1:Wt.setTimeout(e,t||0)}function yr(e){e.g=mr((()=>{e.g=null,e.i&&(e.i=!1,yr(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}sn(pr,er),(Gt=pr.prototype).ga=!1,Gt.T=null,Gt.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),tr(this,"tick"),this.ga&&(gr(this),this.start()))}},Gt.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},Gt.N=function(){pr.$.N.call(this),gr(this),delete this.g};class vr extends on{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:yr(this)}N(){super.N(),this.g&&(Wt.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function wr(e){on.call(this),this.h=e,this.g={}}sn(wr,on);var _r=[];function Ir(e,t,n,r){Array.isArray(n)||(n&&(_r[0]=n.toString()),n=_r);for(var i=0;i<n.length;i++){var s=Kn(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function br(e){Ln(e.g,(function(e,t){this.g.hasOwnProperty(t)&&Qn(e)}),e),e.g={}}function Er(){this.g=!0}function Tr(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return rr(n)}catch(e){return t}}(e,n)+(r?" "+r:"")}))}wr.prototype.N=function(){wr.$.N.call(this),br(this)},wr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Er.prototype.Ea=function(){this.g=!1},Er.prototype.info=function(){};var Sr={},Cr=null;function Ar(){return Cr=Cr||new er}function kr(e){hn.call(this,Sr.Ta,e)}function Nr(e){const t=Ar();tr(t,new kr(t))}function Dr(e,t){hn.call(this,Sr.STAT_EVENT,e),this.stat=t}function xr(e){const t=Ar();tr(t,new Dr(t,e))}function Rr(e,t){hn.call(this,Sr.Ua,e),this.size=t}function Or(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return Wt.setTimeout((function(){e()}),t)}Sr.Ta="serverreachability",sn(kr,hn),Sr.STAT_EVENT="statevent",sn(Dr,hn),Sr.Ua="timingevent",sn(Rr,hn);var Pr={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Lr={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Mr(){}function Ur(e){return e.h||(e.h=e.i())}function Fr(){}Mr.prototype.h=null;var Vr,Br={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function qr(){hn.call(this,"d")}function jr(){hn.call(this,"c")}function zr(){}function Kr(e,t,n,r){this.l=e,this.j=t,this.m=n,this.W=r||1,this.U=new wr(this),this.P=Gr,e=In?125:void 0,this.V=new pr(e),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new $r}function $r(){this.i=null,this.g="",this.h=!1}sn(qr,hn),sn(jr,hn),sn(zr,Mr),zr.prototype.g=function(){return new XMLHttpRequest},zr.prototype.i=function(){return{}},Vr=new zr;var Gr=45e3,Hr={},Qr={};function Wr(e,t,n){e.L=1,e.A=pi(ui(t)),e.u=n,e.S=!0,Yr(e,null)}function Yr(e,t){e.G=Date.now(),ei(e),e.B=ui(e.A);var n=e.B,r=e.W;Array.isArray(r)||(r=[String(r)]),Ai(n.i,"t",r),e.o=0,n=e.l.J,e.h=new $r,e.g=As(e.l,n?t:null,!e.u),0<e.O&&(e.M=new vr(nn(e.Pa,e,e.g),e.O)),Ir(e.U,e.g,"readystatechange",e.nb),t=e.I?Mn(e.I):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.B,e.v,e.u,t)):(e.v="GET",e.g.ha(e.B,e.v,null,t)),Nr(),function(e,t,n,r,i,s){e.info((function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.v,e.B,e.m,e.W,e.u)}function Jr(e){return!!e.g&&"GET"==e.v&&2!=e.L&&e.l.Ha}function Xr(e,t,n){let r,i=!0;for(;!e.J&&e.o<n.length;){if(r=Zr(e,n),r==Qr){4==t&&(e.s=4,xr(14),i=!1),Tr(e.j,e.m,null,"[Incomplete Response]");break}if(r==Hr){e.s=4,xr(15),Tr(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}Tr(e.j,e.m,r,null),si(e,r)}Jr(e)&&0!=e.o&&(e.h.g=e.h.g.slice(e.o),e.o=0),4!=t||0!=n.length||e.h.h||(e.s=1,xr(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.ba&&(e.ba=!0,(t=e.l).g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),ws(t),t.M=!0,xr(11))):(Tr(e.j,e.m,n,"[Invalid Chunked Response]"),ii(e),ri(e))}function Zr(e,t){var n=e.o,r=t.indexOf("\n",n);return-1==r?Qr:(n=Number(t.substring(n,r)),isNaN(n)?Hr:(r+=1)+n>t.length?Qr:(t=t.slice(r,r+n),e.o=r+n,t))}function ei(e){e.Y=Date.now()+e.P,ti(e,e.P)}function ti(e,t){if(null!=e.C)throw Error("WatchDog timer not null");e.C=Or(nn(e.lb,e),t)}function ni(e){e.C&&(Wt.clearTimeout(e.C),e.C=null)}function ri(e){0==e.l.H||e.J||bs(e.l,e)}function ii(e){ni(e);var t=e.M;t&&"function"==typeof t.sa&&t.sa(),e.M=null,gr(e.V),br(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function si(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||Pi(n.i,e)))if(!e.K&&Pi(n.i,e)&&3==n.H){try{var r=n.Ja.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.G+3e3<e.G))break e;Is(n),ls(n)}vs(n),xr(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&0==n.A&&!n.v&&(n.v=Or(nn(n.ib,n),6e3));if(1>=Oi(n.i)&&n.oa){try{n.oa()}catch(e){}n.oa=void 0}}else Ts(n,11)}else if((e.K||n.g==e)&&Is(n),!dn(t))for(i=n.Ja.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.V=u[0],u=u[1],2==n.H)if("c"==u[0]){n.K=u[1],n.pa=u[2];const t=u[3];null!=t&&(n.ra=t,n.l.info("VER="+n.ra));const i=u[4];null!=i&&(n.Ga=i,n.l.info("SVER="+n.Ga));const h=u[5];null!=h&&"number"==typeof h&&0<h&&(r=1.5*h,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=e.g;if(l){const e=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.i;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Li(s,s.h),s.h=null))}if(r.F){const e=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.Da=e,fi(r.I,r.F,e))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=e;if((r=n).wa=Cs(r,r.J?r.pa:null,r.Y),o.K){Mi(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.C&&(ni(a),ei(a)),r.g=o}else ys(r);0<n.j.length&&fs(n)}else"stop"!=u[0]&&"close"!=u[0]||Ts(n,7);else 3==n.H&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?Ts(n,7):hs(n):"noop"!=u[0]&&n.h&&n.h.Aa(u),n.A=0)}Nr()}catch(e){}}function oi(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(Yt(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.ta&&"function"==typeof e.ta)return e.ta();if(!e.Z||"function"!=typeof e.Z){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(Yt(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(Yt(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(Gt=Kr.prototype).setTimeout=function(e){this.P=e},Gt.nb=function(e){e=e.target;const t=this.M;t&&3==is(e)?t.l():this.Pa(e)},Gt.Pa=function(e){try{if(e==this.g)e:{const h=is(this.g);var t=this.g.Ia();if(this.g.da(),!(3>h)&&(3!=h||In||this.g&&(this.h.h||this.g.ja()||ss(this.g)))){this.J||4!=h||7==t||Nr(),ni(this);var n=this.g.da();this.ca=n;t:if(Jr(this)){var r=ss(this.g);e="";var i=r.length,s=4==is(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){ii(this),ri(this);var o="";break t}this.h.i=new Wt.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.length=0,this.h.g+=e,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(e,t,n,r,i,s,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o}))}(this.j,this.v,this.B,this.m,this.W,h,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!dn(a)){var u=a;break t}}u=null}if(!(n=u)){this.i=!1,this.s=3,xr(12),ii(this),ri(this);break e}Tr(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,si(this,n)}this.S?(Xr(this,h,o),In&&this.i&&3==h&&(Ir(this.U,this.V,"tick",this.mb),this.V.start())):(Tr(this.j,this.m,o,null),si(this,o)),4==h&&ii(this),this.i&&!this.J&&(4==h?bs(this.l,this):(this.i=!1,ei(this)))}else(function(e){const t={};e=(e.g&&2<=is(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(dn(e[r]))continue;var n=ar(e[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=t[i]||[];t[i]=s,s.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,xr(12)):(this.s=0,xr(13)),ii(this),ri(this)}}}catch(e){}},Gt.mb=function(){if(this.g){var e=is(this.g),t=this.g.ja();this.o<t.length&&(ni(this),Xr(this,e,t),this.i&&4!=e&&ei(this))}},Gt.cancel=function(){this.J=!0,ii(this)},Gt.lb=function(){this.C=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.B),2!=this.L&&(Nr(),xr(17)),ii(this),this.s=2,ri(this)):ti(this,this.Y-e)};var ai=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ci(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof ci){this.h=e.h,hi(this,e.j),this.s=e.s,this.g=e.g,li(this,e.m),this.l=e.l;var t=e.i,n=new Ei;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),di(this,n),this.o=e.o}else e&&(t=String(e).match(ai))?(this.h=!1,hi(this,t[1]||"",!0),this.s=gi(t[2]||""),this.g=gi(t[3]||"",!0),li(this,t[4]),this.l=gi(t[5]||"",!0),di(this,t[6]||"",!0),this.o=gi(t[7]||"")):(this.h=!1,this.i=new Ei(null,this.h))}function ui(e){return new ci(e)}function hi(e,t,n){e.j=n?gi(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function li(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function di(e,t,n){t instanceof Ei?(e.i=t,function(e,t){t&&!e.j&&(Ti(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(Si(this,t),Ai(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=mi(t,Ii)),e.i=new Ei(t,e.h))}function fi(e,t,n){e.i.set(t,n)}function pi(e){return fi(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function gi(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function mi(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,yi),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function yi(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}ci.prototype.toString=function(){var e=[],t=this.j;t&&e.push(mi(t,vi,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(mi(t,vi,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(mi(n,"/"==n.charAt(0)?_i:wi,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",mi(n,bi)),e.join("")};var vi=/[#\/\?@]/g,wi=/[#\?:]/g,_i=/[#\?]/g,Ii=/[#\?@]/g,bi=/#/g;function Ei(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Ti(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function Si(e,t){Ti(e),t=ki(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Ci(e,t){return Ti(e),t=ki(e,t),e.g.has(t)}function Ai(e,t,n){Si(e,t),0<n.length&&(e.i=null,e.g.set(ki(e,t),cn(n)),e.h+=n.length)}function ki(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(Gt=Ei.prototype).add=function(e,t){Ti(this),this.i=null,e=ki(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},Gt.forEach=function(e,t){Ti(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},Gt.ta=function(){Ti(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},Gt.Z=function(e){Ti(this);let t=[];if("string"==typeof e)Ci(this,e)&&(t=t.concat(this.g.get(ki(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},Gt.set=function(e,t){return Ti(this),this.i=null,Ci(this,e=ki(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},Gt.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},Gt.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")};var Ni=class{constructor(e,t){this.g=e,this.map=t}};function Di(e){this.l=e||xi,e=Wt.PerformanceNavigationTiming?0<(e=Wt.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(Wt.g&&Wt.g.Ka&&Wt.g.Ka()&&Wt.g.Ka().dc),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var xi=10;function Ri(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Oi(e){return e.h?1:e.g?e.g.size:0}function Pi(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Li(e,t){e.g?e.g.add(t):e.h=t}function Mi(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Ui(e){if(null!=e.h)return e.i.concat(e.h.F);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.F);return t}return cn(e.i)}Di.prototype.cancel=function(){if(this.i=Ui(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var Fi=class{stringify(e){return Wt.JSON.stringify(e,void 0)}parse(e){return Wt.JSON.parse(e,void 0)}};function Vi(){this.g=new Fi}function Bi(e,t,n){const r=n||"";try{oi(e,(function(e,n){let i=e;Jt(e)&&(i=rr(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function qi(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function ji(e){this.l=e.ec||null,this.j=e.ob||!1}function zi(e,t){er.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=Ki,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}sn(ji,Mr),ji.prototype.g=function(){return new zi(this.l,this.j)},ji.prototype.i=function(e){return function(){return e}}({}),sn(zi,er);var Ki=0;function $i(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function Gi(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Hi(e)}function Hi(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(Gt=zi.prototype).open=function(e,t){if(this.readyState!=Ki)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Hi(this)},Gt.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||Wt).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},Gt.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Gi(this)),this.readyState=Ki},Gt.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Hi(this)),this.g&&(this.readyState=3,Hi(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==Wt.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;$i(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))},Gt.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Gi(this):Hi(this),3==this.readyState&&$i(this)}},Gt.Za=function(e){this.g&&(this.response=this.responseText=e,Gi(this))},Gt.Ya=function(e){this.g&&(this.response=e,Gi(this))},Gt.ka=function(){this.g&&Gi(this)},Gt.setRequestHeader=function(e,t){this.v.append(e,t)},Gt.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},Gt.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(zi.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Qi=Wt.JSON.parse;function Wi(e){er.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Yi,this.L=this.M=!1}sn(Wi,er);var Yi="",Ji=/^https?$/i,Xi=["POST","PUT"];function Zi(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,es(e),ns(e)}function es(e){e.F||(e.F=!0,tr(e,"complete"),tr(e,"error"))}function ts(e){if(e.h&&void 0!==Qt&&(!e.C[1]||4!=is(e)||2!=e.da()))if(e.v&&4==is(e))mr(e.La,0,e);else if(tr(e,"readystatechange"),4==is(e)){e.h=!1;try{const o=e.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===o){var i=String(e.I).match(ai)[1]||null;!i&&Wt.self&&Wt.self.location&&(i=Wt.self.location.protocol.slice(0,-1)),r=!Ji.test(i?i.toLowerCase():"")}n=r}if(n)tr(e,"complete"),tr(e,"success");else{e.m=6;try{var s=2<is(e)?e.g.statusText:""}catch(e){s=""}e.j=s+" ["+e.da()+"]",es(e)}}finally{ns(e)}}}function ns(e,t){if(e.g){rs(e);const n=e.g,r=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||tr(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function rs(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(Wt.clearTimeout(e.A),e.A=null)}function is(e){return e.g?e.g.readyState:0}function ss(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case Yi:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function os(e){let t="";return Ln(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function as(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=os(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):fi(e,t,n))}function cs(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function us(e){this.Ga=0,this.j=[],this.l=new Er,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=cs("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=cs("baseRetryDelayMs",5e3,e),this.hb=cs("retryDelaySeedMs",1e4,e),this.eb=cs("forwardChannelMaxRetries",2,e),this.xa=cs("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new Di(e&&e.concurrentRequestLimit),this.Ja=new Vi,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function hs(e){if(ds(e),3==e.H){var t=e.W++,n=ui(e.I);if(fi(n,"SID",e.K),fi(n,"RID",t),fi(n,"TYPE","terminate"),gs(e,n),(t=new Kr(e,e.l,t)).L=2,t.A=pi(ui(n)),n=!1,Wt.navigator&&Wt.navigator.sendBeacon)try{n=Wt.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!n&&Wt.Image&&((new Image).src=t.A,n=!0),n||(t.g=As(t.l,null),t.g.ha(t.A)),t.G=Date.now(),ei(t)}Ss(e)}function ls(e){e.g&&(ws(e),e.g.cancel(),e.g=null)}function ds(e){ls(e),e.u&&(Wt.clearTimeout(e.u),e.u=null),Is(e),e.i.cancel(),e.m&&("number"==typeof e.m&&Wt.clearTimeout(e.m),e.m=null)}function fs(e){if(!Ri(e.i)&&!e.m){e.m=!0;var t=e.Na;ur||dr(),hr||(ur(),hr=!0),lr.add(t,e),e.C=0}}function ps(e,t){var n;n=t?t.m:e.W++;const r=ui(e.I);fi(r,"SID",e.K),fi(r,"RID",n),fi(r,"AID",e.V),gs(e,r),e.o&&e.s&&as(r,e.o,e.s),n=new Kr(e,e.l,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=ms(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),Li(e.i,n),Wr(n,r,t)}function gs(e,t){e.na&&Ln(e.na,(function(e,n){fi(t,n,e)})),e.h&&oi({},(function(e,n){fi(t,n,e)}))}function ms(e,t,n){n=Math.min(e.j.length,n);var r=e.h?nn(e.h.Va,e.h,e):null;e:{var i=e.j;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=t,0>n)t=Math.max(0,i[o].g-100),s=!1;else try{Bi(a,e,"req"+n+"_")}catch(e){r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.j.splice(0,n),t.F=e,r}function ys(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;ur||dr(),hr||(ur(),hr=!0),lr.add(t,e),e.A=0}}function vs(e){return!(e.g||e.u||3<=e.A||(e.ba++,e.u=Or(nn(e.Ma,e),Es(e,e.A)),e.A++,0))}function ws(e){null!=e.B&&(Wt.clearTimeout(e.B),e.B=null)}function _s(e){e.g=new Kr(e,e.l,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=ui(e.wa);fi(t,"RID","rpc"),fi(t,"SID",e.K),fi(t,"AID",e.V),fi(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&fi(t,"TO",e.qa),fi(t,"TYPE","xmlhttp"),gs(e,t),e.o&&e.s&&as(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.A=pi(ui(t)),n.u=null,n.S=!0,Yr(n,e)}function Is(e){null!=e.v&&(Wt.clearTimeout(e.v),e.v=null)}function bs(e,t){var n=null;if(e.g==t){Is(e),ws(e),e.g=null;var r=2}else{if(!Pi(e.i,t))return;n=t.F,Mi(e.i,t),r=1}if(0!=e.H)if(t.i)if(1==r){n=t.u?t.u.length:0,t=Date.now()-t.G;var i=e.C;tr(r=Ar(),new Rr(r,n)),fs(e)}else ys(e);else if(3==(i=t.s)||0==i&&0<t.ca||!(1==r&&function(e,t){return!(Oi(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.j=t.F.concat(e.j),0):1==e.H||2==e.H||e.C>=(e.cb?0:e.eb)||(e.m=Or(nn(e.Na,e,t),Es(e,e.C)),e.C++,0)))}(e,t)||2==r&&vs(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:Ts(e,5);break;case 4:Ts(e,10);break;case 3:Ts(e,6);break;default:Ts(e,2)}}function Es(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function Ts(e,t){if(e.l.info("Error code "+t),2==t){var n=null;e.h&&(n=null);var r=nn(e.pb,e);n||(n=new ci("//www.google.com/images/cleardot.gif"),Wt.location&&"http"==Wt.location.protocol||hi(n,"https"),pi(n)),function(e,t){const n=new Er;if(Wt.Image){const r=new Image;r.onload=rn(qi,n,r,"TestLoadImage: loaded",!0,t),r.onerror=rn(qi,n,r,"TestLoadImage: error",!1,t),r.onabort=rn(qi,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=rn(qi,n,r,"TestLoadImage: timeout",!1,t),Wt.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else xr(2);e.H=0,e.h&&e.h.za(t),Ss(e),ds(e)}function Ss(e){if(e.H=0,e.ma=[],e.h){const t=Ui(e.i);0==t.length&&0==e.j.length||(un(e.ma,t),un(e.ma,e.j),e.i.i.length=0,cn(e.j),e.j.length=0),e.h.ya()}}function Cs(e,t,n){var r=n instanceof ci?ui(n):new ci(n);if(""!=r.g)t&&(r.g=t+"."+r.g),li(r,r.m);else{var i=Wt.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new ci(null);r&&hi(s,r),t&&(s.g=t),i&&li(s,i),n&&(s.l=n),r=s}return n=e.F,t=e.Da,n&&t&&fi(r,n,t),fi(r,"VER",e.ra),gs(e,r),r}function As(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ha&&!e.va?new Wi(new ji({ob:n})):new Wi(e.va)).Oa(e.J),t}function ks(){}function Ns(){if(wn&&!(10<=Number(kn)))throw Error("Environmental error: no available transport.")}function Ds(e,t){er.call(this),this.g=new us(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!dn(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!dn(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new Os(this)}function xs(e){qr.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function Rs(){jr.call(this),this.status=1}function Os(e){this.g=e}function Ps(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Ls(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],o=t+(s^n&(i^s))+r[0]+3614090360&4294967295;o=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=n+(o<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(t=n+((o=t+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(t^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function Ms(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}(Gt=Wi.prototype).Oa=function(e){this.M=e},Gt.ha=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Vr.g(),this.C=this.u?Ur(this.u):Ur(Vr),this.g.onreadystatechange=nn(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(e){return void Zi(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),i=Wt.FormData&&e instanceof Wt.FormData,!(0<=an(Xi,t))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{rs(this),0<this.B&&((this.L=function(e){return wn&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=nn(this.ua,this)):this.A=mr(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){Zi(this,e)}},Gt.ua=function(){void 0!==Qt&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,tr(this,"timeout"),this.abort(8))},Gt.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,tr(this,"complete"),tr(this,"abort"),ns(this))},Gt.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),ns(this,!0)),Wi.$.N.call(this)},Gt.La=function(){this.s||(this.G||this.v||this.l?ts(this):this.kb())},Gt.kb=function(){ts(this)},Gt.isActive=function(){return!!this.g},Gt.da=function(){try{return 2<is(this)?this.g.status:-1}catch(e){return-1}},Gt.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},Gt.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Qi(t)}},Gt.Ia=function(){return this.m},Gt.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(Gt=us.prototype).ra=8,Gt.H=1,Gt.Na=function(e){if(this.m)if(this.m=null,1==this.H){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;const i=new Kr(this,this.l,e);let s=this.s;if(this.U&&(s?(s=Mn(s),Fn(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var t=0,n=0;n<this.j.length;n++){var r=this.j[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.j.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=ms(this,i,t),fi(n=ui(this.I),"RID",e),fi(n,"CVER",22),this.F&&fi(n,"X-HTTP-Session-Id",this.F),gs(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(os(s)))+"&"+t:this.o&&as(n,this.o,s)),Li(this.i,i),this.bb&&fi(n,"TYPE","init"),this.P?(fi(n,"$req",t),fi(n,"SID","null"),i.aa=!0,Wr(i,n,null)):Wr(i,n,t),this.H=2}}else 3==this.H&&(e?ps(this,e):0==this.j.length||Ri(this.i)||ps(this))},Gt.Ma=function(){if(this.u=null,_s(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=Or(nn(this.jb,this),e)}},Gt.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,xr(10),ls(this),_s(this))},Gt.ib=function(){null!=this.v&&(this.v=null,ls(this),vs(this),xr(19))},Gt.pb=function(e){e?(this.l.info("Successfully pinged google.com"),xr(2)):(this.l.info("Failed to ping google.com"),xr(1))},Gt.isActive=function(){return!!this.h&&this.h.isActive(this)},(Gt=ks.prototype).Ba=function(){},Gt.Aa=function(){},Gt.za=function(){},Gt.ya=function(){},Gt.isActive=function(){return!0},Gt.Va=function(){},Ns.prototype.g=function(e,t){return new Ds(e,t)},sn(Ds,er),Ds.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;xr(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=Cs(e,null,e.Y),fs(e)},Ds.prototype.close=function(){hs(this.g)},Ds.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=rr(e),e=n);t.j.push(new Ni(t.fb++,e)),3==t.H&&fs(t)},Ds.prototype.N=function(){this.g.h=null,delete this.j,hs(this.g),delete this.g,Ds.$.N.call(this)},sn(xs,qr),sn(Rs,jr),sn(Os,ks),Os.prototype.Ba=function(){tr(this.g,"a")},Os.prototype.Aa=function(e){tr(this.g,new xs(e))},Os.prototype.za=function(e){tr(this.g,new Rs)},Os.prototype.ya=function(){tr(this.g,"b")},sn(Ps,(function(){this.blockSize=-1})),Ps.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Ps.prototype.j=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=this.m,i=this.h,s=0;s<t;){if(0==i)for(;s<=n;)Ls(this,e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(r[i++]=e.charCodeAt(s++),i==this.blockSize){Ls(this,r),i=0;break}}else for(;s<t;)if(r[i++]=e[s++],i==this.blockSize){Ls(this,r),i=0;break}}this.h=i,this.i+=t},Ps.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var Us={};function Fs(e){return-128<=e&&128>e?function(e,t){var n=Us;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=function(e){return new Ms([0|e],0>e?-1:0)}(e)}(e):new Ms([0|e],0>e?-1:0)}function Vs(e){if(isNaN(e)||!isFinite(e))return qs;if(0>e)return Gs(Vs(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=Bs;return new Ms(t,0)}var Bs=4294967296,qs=Fs(0),js=Fs(1),zs=Fs(16777216);function Ks(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function $s(e){return-1==e.h}function Gs(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new Ms(n,~e.h).add(js)}function Hs(e,t){return e.add(Gs(t))}function Qs(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function Ws(e,t){this.g=e,this.h=t}function Ys(e,t){if(Ks(t))throw Error("division by zero");if(Ks(e))return new Ws(qs,qs);if($s(e))return t=Ys(Gs(e),t),new Ws(Gs(t.g),Gs(t.h));if($s(t))return t=Ys(e,Gs(t)),new Ws(Gs(t.g),t.h);if(30<e.g.length){if($s(e)||$s(t))throw Error("slowDivide_ only works with positive integers.");for(var n=js,r=t;0>=r.X(e);)n=Js(n),r=Js(r);var i=Xs(n,1),s=Xs(r,1);for(r=Xs(r,2),n=Xs(n,2);!Ks(r);){var o=s.add(r);0>=o.X(e)&&(i=i.add(n),s=o),r=Xs(r,1),n=Xs(n,1)}return t=Hs(e,i.R(t)),new Ws(i,t)}for(i=qs;0<=e.X(t);){for(n=Math.max(1,Math.floor(e.ea()/t.ea())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(s=Vs(n)).R(t);$s(o)||0<o.X(e);)o=(s=Vs(n-=r)).R(t);Ks(s)&&(s=js),i=i.add(s),e=Hs(e,o)}return new Ws(i,e)}function Js(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.D(r)<<1|e.D(r-1)>>>31;return new Ms(n,e.h)}function Xs(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],s=0;s<r;s++)i[s]=0<t?e.D(s+n)>>>t|e.D(s+n+1)<<32-t:e.D(s+n);return new Ms(i,e.h)}(Gt=Ms.prototype).ea=function(){if($s(this))return-Gs(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.D(n);e+=(0<=r?r:Bs+r)*t,t*=Bs}return e},Gt.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(Ks(this))return"0";if($s(this))return"-"+Gs(this).toString(e);for(var t=Vs(Math.pow(e,6)),n=this,r="";;){var i=Ys(n,t).g,s=((0<(n=Hs(n,i.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(Ks(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},Gt.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},Gt.X=function(e){return $s(e=Hs(this,e))?-1:Ks(e)?0:1},Gt.abs=function(){return $s(this)?Gs(this):this},Gt.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var s=r+(65535&this.D(i))+(65535&e.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(e.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,n[i]=o<<16|s}return new Ms(n,-2147483648&n[n.length-1]?-1:0)},Gt.R=function(e){if(Ks(this)||Ks(e))return qs;if($s(this))return $s(e)?Gs(this).R(Gs(e)):Gs(Gs(this).R(e));if($s(e))return Gs(this.R(Gs(e)));if(0>this.X(zs)&&0>e.X(zs))return Vs(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),a=e.D(i)>>>16,c=65535&e.D(i);n[2*r+2*i]+=o*c,Qs(n,2*r+2*i),n[2*r+2*i+1]+=s*c,Qs(n,2*r+2*i+1),n[2*r+2*i+1]+=o*a,Qs(n,2*r+2*i+1),n[2*r+2*i+2]+=s*a,Qs(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new Ms(n,0)},Gt.gb=function(e){return Ys(this,e).h},Gt.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)&e.D(r);return new Ms(n,this.h&e.h)},Gt.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)|e.D(r);return new Ms(n,this.h|e.h)},Gt.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)^e.D(r);return new Ms(n,this.h^e.h)},Ns.prototype.createWebChannel=Ns.prototype.g,Ds.prototype.send=Ds.prototype.u,Ds.prototype.open=Ds.prototype.m,Ds.prototype.close=Ds.prototype.close,Pr.NO_ERROR=0,Pr.TIMEOUT=8,Pr.HTTP_ERROR=6,Lr.COMPLETE="complete",Fr.EventType=Br,Br.OPEN="a",Br.CLOSE="b",Br.ERROR="c",Br.MESSAGE="d",er.prototype.listen=er.prototype.O,Wi.prototype.listenOnce=Wi.prototype.P,Wi.prototype.getLastError=Wi.prototype.Sa,Wi.prototype.getLastErrorCode=Wi.prototype.Ia,Wi.prototype.getStatus=Wi.prototype.da,Wi.prototype.getResponseJson=Wi.prototype.Wa,Wi.prototype.getResponseText=Wi.prototype.ja,Wi.prototype.send=Wi.prototype.ha,Wi.prototype.setWithCredentials=Wi.prototype.Oa,Ps.prototype.digest=Ps.prototype.l,Ps.prototype.reset=Ps.prototype.reset,Ps.prototype.update=Ps.prototype.j,Ms.prototype.add=Ms.prototype.add,Ms.prototype.multiply=Ms.prototype.R,Ms.prototype.modulo=Ms.prototype.gb,Ms.prototype.compare=Ms.prototype.X,Ms.prototype.toNumber=Ms.prototype.ea,Ms.prototype.toString=Ms.prototype.toString,Ms.prototype.getBits=Ms.prototype.D,Ms.fromNumber=Vs,Ms.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return Gs(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=Vs(Math.pow(n,8)),i=qs,s=0;s<t.length;s+=8){var o=Math.min(8,t.length-s),a=parseInt(t.substring(s,s+o),n);8>o?(o=Vs(Math.pow(n,o)),i=i.R(o).add(Vs(a))):i=(i=i.R(r)).add(Vs(a))}return i};var Zs=Pr,eo=Lr,to=Sr,no=Fr,ro=Wi,io=Ps,so=Ms;const oo="@firebase/firestore";class ao{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ao.UNAUTHENTICATED=new ao(null),ao.GOOGLE_CREDENTIALS=new ao("google-credentials-uid"),ao.FIRST_PARTY=new ao("first-party-uid"),ao.MOCK_USER=new ao("mock-user");let co="10.8.0";const uo=new R("@firebase/firestore");function ho(){return uo.logLevel}function lo(e,...t){if(uo.logLevel<=A.DEBUG){const n=t.map(go);uo.debug(`Firestore (${co}): ${e}`,...n)}}function fo(e,...t){if(uo.logLevel<=A.ERROR){const n=t.map(go);uo.error(`Firestore (${co}): ${e}`,...n)}}function po(e,...t){if(uo.logLevel<=A.WARN){const n=t.map(go);uo.warn(`Firestore (${co}): ${e}`,...n)}}function go(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function mo(e="Unexpected state"){const t=`FIRESTORE (${co}) INTERNAL ASSERTION FAILED: `+e;throw fo(t),new Error(t)}function yo(e,t){e||mo()}function vo(e,t){return e}const wo={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class _o extends d{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Io{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class bo{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Eo{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(ao.UNAUTHENTICATED)))}shutdown(){}}class To{constructor(e){this.t=e,this.currentUser=ao.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new Io;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Io,e.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},o=e=>{lo("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(lo("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Io)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(lo("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(yo("string"==typeof t.accessToken),new bo(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return yo(null===e||"string"==typeof e),new ao(e)}}class So{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=ao.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Co{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new So(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable((()=>t(ao.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Ao{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ko{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=e=>{null!=e.error&&lo("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.R;return this.R=e.token,lo("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{lo("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.A.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?r(e):lo("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(yo("string"==typeof e.token),this.R=e.token,new Ao(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function No(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class Do{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=No(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function xo(e,t){return e<t?-1:e>t?1:0}function Ro(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}function Oo(e){return e+"\0"}class Po{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new _o(wo.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new _o(wo.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new _o(wo.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new _o(wo.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Po.fromMillis(Date.now())}static fromDate(e){return Po.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Po(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?xo(this.nanoseconds,e.nanoseconds):xo(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Lo{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Lo(e)}static min(){return new Lo(new Po(0,0))}static max(){return new Lo(new Po(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Mo{constructor(e,t,n){void 0===t?t=0:t>e.length&&mo(),void 0===n?n=e.length-t:n>e.length-t&&mo(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Mo.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Mo?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Uo extends Mo{construct(e,t,n){return new Uo(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new _o(wo.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new Uo(t)}static emptyPath(){return new Uo([])}}const Fo=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Vo extends Mo{construct(e,t,n){return new Vo(e,t,n)}static isValidIdentifier(e){return Fo.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Vo.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Vo(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new _o(wo.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new _o(wo.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new _o(wo.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new _o(wo.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Vo(t)}static emptyPath(){return new Vo([])}}class Bo{constructor(e){this.path=e}static fromPath(e){return new Bo(Uo.fromString(e))}static fromName(e){return new Bo(Uo.fromString(e).popFirst(5))}static empty(){return new Bo(Uo.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Uo.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Uo.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Bo(new Uo(e.slice()))}}class qo{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function jo(e){return e.fields.find((e=>2===e.kind))}function zo(e){return e.fields.filter((e=>2!==e.kind))}qo.UNKNOWN_ID=-1;class Ko{constructor(e,t){this.fieldPath=e,this.kind=t}}class $o{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new $o(0,Qo.min())}}function Go(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=Lo.fromTimestamp(1e9===r?new Po(n+1,0):new Po(n,r));return new Qo(i,Bo.empty(),t)}function Ho(e){return new Qo(e.readTime,e.key,-1)}class Qo{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Qo(Lo.min(),Bo.empty(),-1)}static max(){return new Qo(Lo.max(),Bo.empty(),-1)}}function Wo(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=Bo.comparator(e.documentKey,t.documentKey),0!==n?n:xo(e.largestBatchId,t.largestBatchId))}const Yo="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Jo{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Xo(e){if(e.code!==wo.FAILED_PRECONDITION||e.message!==Yo)throw e;lo("LocalStore","Unexpectedly lost primary lease")}class Zo{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&mo(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Zo(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Zo?t:Zo.resolve(t)}catch(e){return Zo.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Zo.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Zo.reject(t)}static resolve(e){return new Zo(((t,n)=>{t(e)}))}static reject(e){return new Zo(((t,n)=>{n(e)}))}static waitFor(e){return new Zo(((t,n)=>{let r=0,i=0,s=!1;e.forEach((e=>{++r,e.next((()=>{++i,s&&i===r&&t()}),(e=>n(e)))})),s=!0,i===r&&t()}))}static or(e){let t=Zo.resolve(!1);for(const n of e)t=t.next((e=>e?Zo.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new Zo(((n,r)=>{const i=e.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;t(e[c]).next((e=>{s[c]=e,++o,o===i&&n(s)}),(e=>r(e)))}}))}static doWhile(e,t){return new Zo(((n,r)=>{const i=()=>{!0===e()?t().next((()=>{i()}),r):n()};i()}))}}class ea{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Io,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new ra(e,t.error)):this.V.resolve()},this.transaction.onerror=t=>{const n=ca(t.target.error);this.V.reject(new ra(e,n))}}static open(e,t,n,r){try{return new ea(t,e.transaction(r,n))}catch(e){throw new ra(t,e)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(lo("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new sa(t)}}class ta{constructor(e,t,n){this.name=e,this.version=t,this.p=n,12.2===ta.S(u())&&fo("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return lo("SimpleDb","Removing database:",e),oa(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!l())return!1;if(ta.C())return!0;const e=u(),t=ta.S(e),n=0<t&&t<10,r=ta.v(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static C(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.F)}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static v(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async O(e){return this.db||(lo("SimpleDb","Opening database:",this.name),this.db=await new Promise(((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new ra(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new _o(wo.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new _o(wo.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new ra(e,r))},r.onupgradeneeded=e=>{lo("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.p.N(t,r.transaction,e.oldVersion,this.version).next((()=>{lo("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.B&&(this.db.onversionchange=e=>this.B(e)),this.db}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.O(e);const t=ea.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next((e=>(t.g(),e))).catch((e=>(t.abort(e),Zo.reject(e)))).toPromise();return s.catch((()=>{})),await t.m,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(lo("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class na{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return oa(this.k.delete())}}class ra extends _o{constructor(e,t){super(wo.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function ia(e){return"IndexedDbTransactionError"===e.name}class sa{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(lo("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(lo("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),oa(n)}add(e){return lo("SimpleDb","ADD",this.store.name,e,e),oa(this.store.add(e))}get(e){return oa(this.store.get(e)).next((t=>(void 0===t&&(t=null),lo("SimpleDb","GET",this.store.name,e,t),t)))}delete(e){return lo("SimpleDb","DELETE",this.store.name,e),oa(this.store.delete(e))}count(){return lo("SimpleDb","COUNT",this.store.name),oa(this.store.count())}W(e,t){const n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){const e=r.getAll(n.range);return new Zo(((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}}))}{const e=this.cursor(n),t=[];return this.G(e,((e,n)=>{t.push(n)})).next((()=>t))}}j(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new Zo(((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}}))}H(e,t){lo("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.J=!1;const r=this.cursor(n);return this.G(r,((e,t,n)=>n.delete()))}Y(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.G(r,t)}Z(e){const t=this.cursor({});return new Zo(((n,r)=>{t.onerror=e=>{const t=ca(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next((e=>{e?r.continue():n()})):n()}}))}G(e,t){const n=[];return new Zo(((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i)return void r();const s=new na(i),o=t(i.primaryKey,i.value,s);if(o instanceof Zo){const e=o.catch((e=>(s.done(),Zo.reject(e))));n.push(e)}s.isDone?r():null===s.$?i.continue():i.continue(s.$)}})).next((()=>Zo.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.J?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function oa(e){return new Zo(((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=ca(e.target.error);n(t)}}))}let aa=!1;function ca(e){const t=ta.S(u());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new _o("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return aa||(aa=!0,setTimeout((()=>{throw e}),0)),e}}return e}class ua{constructor(e,t){this.asyncQueue=e,this.X=t,this.task=null}start(){this.ee(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}ee(e){lo("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{lo("IndexBackfiller",`Documents written: ${await this.X.te()}`)}catch(e){ia(e)?lo("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",e):await Xo(e)}await this.ee(6e4)}))}}class ha{constructor(e,t){this.localStore=e,this.persistence=t}async te(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.ne(t,e)))}ne(e,t){const n=new Set;let r=t,i=!0;return Zo.doWhile((()=>!0===i&&r>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((t=>{if(null!==t&&!n.has(t))return lo("IndexBackfiller",`Processing collection: ${t}`),this.re(e,t,r).next((e=>{r-=e,n.add(t)}));i=!1})))).next((()=>t-r))}re(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next((n=>{const i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next((()=>this.ie(r,n))).next((n=>(lo("IndexBackfiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n)))).next((()=>i.size))}))))}ie(e,t){let n=e;return t.changes.forEach(((e,t)=>{const r=Ho(t);Wo(r,n)>0&&(n=r)})),new Qo(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class la{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.se(e),this.oe=e=>t.writeSequenceNumber(e))}se(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.oe&&this.oe(e),e}}function da(e){return null==e}function fa(e){return 0===e&&1/e==-1/0}function pa(e){return"number"==typeof e&&Number.isInteger(e)&&!fa(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function ga(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=ya(t)),t=ma(e.get(n),t);return ya(t)}function ma(e,t){let n=t;const r=e.length;for(let t=0;t<r;t++){const r=e.charAt(t);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function ya(e){return e+""}function va(e){const t=e.length;if(yo(t>=2),2===t)return yo(""===e.charAt(0)&&""===e.charAt(1)),Uo.emptyPath();const n=t-2,r=[];let i="";for(let s=0;s<t;){const t=e.indexOf("",s);switch((t<0||t>n)&&mo(),e.charAt(t+1)){case"":const n=e.substring(s,t);let o;0===i.length?o=n:(i+=n,o=i,i=""),r.push(o);break;case"":i+=e.substring(s,t),i+="\0";break;case"":i+=e.substring(s,t+1);break;default:mo()}s=t+2}return new Uo(r)}la._e=-1;const wa=["userId","batchId"];function _a(e,t){return[e,ga(t)]}function Ia(e,t,n){return[e,ga(t),n]}const ba={},Ea=["prefixPath","collectionGroup","readTime","documentId"],Ta=["prefixPath","collectionGroup","documentId"],Sa=["collectionGroup","readTime","prefixPath","documentId"],Ca=["canonicalId","targetId"],Aa=["targetId","path"],ka=["path","targetId"],Na=["collectionId","parent"],Da=["indexId","uid"],xa=["uid","sequenceNumber"],Ra=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Oa=["indexId","uid","orderedDocumentKey"],Pa=["userId","collectionPath","documentId"],La=["userId","collectionPath","largestBatchId"],Ma=["userId","collectionGroup","largestBatchId"],Ua=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Fa=[...Ua,"documentOverlays"],Va=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Ba=Va,qa=[...Ba,"indexConfiguration","indexState","indexEntries"];class ja extends Jo{constructor(e,t){super(),this.ae=e,this.currentSequenceNumber=t}}function za(e,t){const n=vo(e);return ta.M(n.ae,t)}function Ka(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function $a(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Ga(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Ha{constructor(e,t){this.comparator=e,this.root=t||Wa.EMPTY}insert(e,t){return new Ha(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Wa.BLACK,null,null))}remove(e){return new Ha(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Wa.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Qa(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Qa(this.root,e,this.comparator,!1)}getReverseIterator(){return new Qa(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Qa(this.root,e,this.comparator,!0)}}class Qa{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Wa{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Wa.RED,this.left=null!=r?r:Wa.EMPTY,this.right=null!=i?i:Wa.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new Wa(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Wa.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Wa.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Wa.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Wa.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw mo();if(this.right.isRed())throw mo();const e=this.left.check();if(e!==this.right.check())throw mo();return e+(this.isRed()?0:1)}}Wa.EMPTY=null,Wa.RED=!0,Wa.BLACK=!1,Wa.EMPTY=new class{constructor(){this.size=0}get key(){throw mo()}get value(){throw mo()}get color(){throw mo()}get left(){throw mo()}get right(){throw mo()}copy(e,t,n,r,i){return this}insert(e,t,n){return new Wa(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ya{constructor(e){this.comparator=e,this.data=new Ha(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ja(this.data.getIterator())}getIteratorFrom(e){return new Ja(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof Ya))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Ya(this.comparator);return t.data=e,t}}class Ja{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Xa(e){return e.hasNext()?e.getNext():void 0}class Za{constructor(e){this.fields=e,e.sort(Vo.comparator)}static empty(){return new Za([])}unionWith(e){let t=new Ya(Vo.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new Za(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ro(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class ec extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class tc{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new ec("Invalid base64 string: "+e):e}}(e);return new tc(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new tc(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return xo(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}tc.EMPTY_BYTE_STRING=new tc("");const nc=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function rc(e){if(yo(!!e),"string"==typeof e){let t=0;const n=nc.exec(e);if(yo(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:ic(e.seconds),nanos:ic(e.nanos)}}function ic(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function sc(e){return"string"==typeof e?tc.fromBase64String(e):tc.fromUint8Array(e)}function oc(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ac(e){const t=e.mapValue.fields.__previous_value__;return oc(t)?ac(t):t}function cc(e){const t=rc(e.mapValue.fields.__local_write_time__.timestampValue);return new Po(t.seconds,t.nanos)}class uc{constructor(e,t,n,r,i,s,o,a,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class hc{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new hc("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof hc&&e.projectId===this.projectId&&e.database===this.database}}const lc={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},dc={nullValue:"NULL_VALUE"};function fc(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?oc(e)?4:Ac(e)?9007199254740991:10:mo()}function pc(e,t){if(e===t)return!0;const n=fc(e);if(n!==fc(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return cc(e).isEqual(cc(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=rc(e.timestampValue),r=rc(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return sc(e.bytesValue).isEqual(sc(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return ic(e.geoPointValue.latitude)===ic(t.geoPointValue.latitude)&&ic(e.geoPointValue.longitude)===ic(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return ic(e.integerValue)===ic(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=ic(e.doubleValue),r=ic(t.doubleValue);return n===r?fa(n)===fa(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return Ro(e.arrayValue.values||[],t.arrayValue.values||[],pc);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(Ka(n)!==Ka(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!pc(n[e],r[e])))return!1;return!0}(e,t);default:return mo()}}function gc(e,t){return void 0!==(e.values||[]).find((e=>pc(e,t)))}function mc(e,t){if(e===t)return 0;const n=fc(e),r=fc(t);if(n!==r)return xo(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return xo(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=ic(e.integerValue||e.doubleValue),r=ic(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return yc(e.timestampValue,t.timestampValue);case 4:return yc(cc(e),cc(t));case 5:return xo(e.stringValue,t.stringValue);case 6:return function(e,t){const n=sc(e),r=sc(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=xo(n[e],r[e]);if(0!==t)return t}return xo(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=xo(ic(e.latitude),ic(t.latitude));return 0!==n?n:xo(ic(e.longitude),ic(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=mc(n[e],r[e]);if(t)return t}return xo(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===lc.mapValue&&t===lc.mapValue)return 0;if(e===lc.mapValue)return 1;if(t===lc.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=xo(r[e],s[e]);if(0!==t)return t;const o=mc(n[r[e]],i[s[e]]);if(0!==o)return o}return xo(r.length,s.length)}(e.mapValue,t.mapValue);default:throw mo()}}function yc(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return xo(e,t);const n=rc(e),r=rc(t),i=xo(n.seconds,r.seconds);return 0!==i?i:xo(n.nanos,r.nanos)}function vc(e){return wc(e)}function wc(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=rc(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return sc(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return Bo.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=wc(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${wc(e.fields[i])}`;return n+"}"}(e.mapValue):mo()}function _c(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Ic(e){return!!e&&"integerValue"in e}function bc(e){return!!e&&"arrayValue"in e}function Ec(e){return!!e&&"nullValue"in e}function Tc(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Sc(e){return!!e&&"mapValue"in e}function Cc(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return $a(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=Cc(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Cc(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Ac(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function kc(e){return"nullValue"in e?dc:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?_c(hc.empty(),Bo.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?{mapValue:{}}:mo()}function Nc(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?_c(hc.empty(),Bo.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?{mapValue:{}}:"mapValue"in e?lc:mo()}function Dc(e,t){const n=mc(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function xc(e,t){const n=mc(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class Rc{constructor(e){this.value=e}static empty(){return new Rc({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Sc(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Cc(t)}setAll(e){let t=Vo.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=Cc(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());Sc(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return pc(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Sc(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){$a(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new Rc(Cc(this.value))}}function Oc(e){const t=[];return $a(e.fields,((e,n)=>{const r=new Vo([e]);if(Sc(n)){const e=Oc(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new Za(t)}class Pc{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new Pc(e,0,Lo.min(),Lo.min(),Lo.min(),Rc.empty(),0)}static newFoundDocument(e,t,n,r){return new Pc(e,1,t,Lo.min(),n,r,0)}static newNoDocument(e,t){return new Pc(e,2,t,Lo.min(),Lo.min(),Rc.empty(),0)}static newUnknownDocument(e,t){return new Pc(e,3,t,Lo.min(),Lo.min(),Rc.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Lo.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Rc.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Rc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Lo.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Pc&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Pc(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Lc{constructor(e,t){this.position=e,this.inclusive=t}}function Mc(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?Bo.comparator(Bo.fromName(o.referenceValue),n.key):mc(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function Uc(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!pc(e.position[n],t.position[n]))return!1;return!0}class Fc{constructor(e,t="asc"){this.field=e,this.dir=t}}function Vc(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class Bc{}class qc extends Bc{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Jc(e,t,n):"array-contains"===t?new tu(e,n):"in"===t?new nu(e,n):"not-in"===t?new ru(e,n):"array-contains-any"===t?new iu(e,n):new qc(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Xc(e,n):new Zc(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(mc(t,this.value)):null!==t&&fc(this.value)===fc(t)&&this.matchesComparison(mc(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return mo()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class jc extends Bc{constructor(e,t){super(),this.filters=e,this.op=t,this.ue=null}static create(e,t){return new jc(e,t)}matches(e){return zc(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function zc(e){return"and"===e.op}function Kc(e){return"or"===e.op}function $c(e){return Gc(e)&&zc(e)}function Gc(e){for(const t of e.filters)if(t instanceof jc)return!1;return!0}function Hc(e){if(e instanceof qc)return e.field.canonicalString()+e.op.toString()+vc(e.value);if($c(e))return e.filters.map((e=>Hc(e))).join(",");{const t=e.filters.map((e=>Hc(e))).join(",");return`${e.op}(${t})`}}function Qc(e,t){return e instanceof qc?function(e,t){return t instanceof qc&&e.op===t.op&&e.field.isEqual(t.field)&&pc(e.value,t.value)}(e,t):e instanceof jc?function(e,t){return t instanceof jc&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&Qc(n,t.filters[r])),!0)}(e,t):void mo()}function Wc(e,t){const n=e.filters.concat(t);return jc.create(n,e.op)}function Yc(e){return e instanceof qc?function(e){return`${e.field.canonicalString()} ${e.op} ${vc(e.value)}`}(e):e instanceof jc?function(e){return e.op.toString()+" {"+e.getFilters().map(Yc).join(" ,")+"}"}(e):"Filter"}class Jc extends qc{constructor(e,t,n){super(e,t,n),this.key=Bo.fromName(n.referenceValue)}matches(e){const t=Bo.comparator(e.key,this.key);return this.matchesComparison(t)}}class Xc extends qc{constructor(e,t){super(e,"in",t),this.keys=eu(0,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Zc extends qc{constructor(e,t){super(e,"not-in",t),this.keys=eu(0,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function eu(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>Bo.fromName(e.referenceValue)))}class tu extends qc{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return bc(t)&&gc(t.arrayValue,this.value)}}class nu extends qc{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&gc(this.value.arrayValue,t)}}class ru extends qc{constructor(e,t){super(e,"not-in",t)}matches(e){if(gc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!gc(this.value.arrayValue,t)}}class iu extends qc{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!bc(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>gc(this.value.arrayValue,e)))}}class su{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.ce=null}}function ou(e,t=null,n=[],r=[],i=null,s=null,o=null){return new su(e,t,n,r,i,s,o)}function au(e){const t=vo(e);if(null===t.ce){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>Hc(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),da(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>vc(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>vc(e))).join(",")),t.ce=e}return t.ce}function cu(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Vc(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Qc(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Uc(e.startAt,t.startAt)&&Uc(e.endAt,t.endAt)}function uu(e){return Bo.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function hu(e,t){return e.filters.filter((e=>e instanceof qc&&e.field.isEqual(t)))}function lu(e,t,n){let r=dc,i=!0;for(const n of hu(e,t)){let e=dc,t=!0;switch(n.op){case"<":case"<=":e=kc(n.value);break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=dc}Dc({value:r,inclusive:i},{value:e,inclusive:t})<0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];Dc({value:r,inclusive:i},{value:e,inclusive:n.inclusive})<0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}function du(e,t,n){let r=lc,i=!0;for(const n of hu(e,t)){let e=lc,t=!0;switch(n.op){case">=":case">":e=Nc(n.value),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=lc}xc({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];xc({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}class fu{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}}function pu(e,t,n,r,i,s,o,a){return new fu(e,t,n,r,i,s,o,a)}function gu(e){return new fu(e)}function mu(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function yu(e){return null!==e.collectionGroup}function vu(e){const t=vo(e);if(null===t.le){t.le=[];const e=new Set;for(const n of t.explicitOrderBy)t.le.push(n),e.add(n.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new Ya(Vo.comparator);return e.filters.forEach((e=>{e.getFlattenedFilters().forEach((e=>{e.isInequality()&&(t=t.add(e.field))}))})),t}(t);r.forEach((r=>{e.has(r.canonicalString())||r.isKeyField()||t.le.push(new Fc(r,n))})),e.has(Vo.keyField().canonicalString())||t.le.push(new Fc(Vo.keyField(),n))}return t.le}function wu(e){const t=vo(e);return t.he||(t.he=function(e,t){if("F"===e.limitType)return ou(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((e=>{const t="desc"===e.dir?"asc":"desc";return new Fc(e.field,t)}));const n=e.endAt?new Lc(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new Lc(e.startAt.position,e.startAt.inclusive):null;return ou(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}(t,vu(e))),t.he}function _u(e,t){const n=e.filters.concat([t]);return new fu(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Iu(e,t,n){return new fu(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function bu(e,t){return cu(wu(e),wu(t))&&e.limitType===t.limitType}function Eu(e){return`${au(wu(e))}|lt:${e.limitType}`}function Tu(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>Yc(e))).join(", ")}]`),da(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>vc(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>vc(e))).join(",")),`Target(${t})`}(wu(e))}; limitType=${e.limitType})`}function Su(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Bo.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of vu(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=Mc(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,vu(e),t)||e.endAt&&!function(e,t,n){const r=Mc(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,vu(e),t))}(e,t)}function Cu(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Au(e){return(t,n)=>{let r=!1;for(const i of vu(e)){const e=ku(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function ku(e,t,n){const r=e.field.isKeyField()?Bo.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?mc(r,i):mo()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return mo()}}class Nu{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){$a(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return Ga(this.inner)}size(){return this.innerSize}}const Du=new Ha(Bo.comparator);function xu(){return Du}const Ru=new Ha(Bo.comparator);function Ou(...e){let t=Ru;for(const n of e)t=t.insert(n.key,n);return t}function Pu(e){let t=Ru;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function Lu(){return Uu()}function Mu(){return Uu()}function Uu(){return new Nu((e=>e.toString()),((e,t)=>e.isEqual(t)))}const Fu=new Ha(Bo.comparator),Vu=new Ya(Bo.comparator);function Bu(...e){let t=Vu;for(const n of e)t=t.add(n);return t}const qu=new Ya(xo);function ju(){return qu}function zu(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:fa(t)?"-0":t}}function Ku(e){return{integerValue:""+e}}class $u{constructor(){this._=void 0}}function Gu(e,t,n){return e instanceof Wu?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&oc(t)&&(t=ac(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Yu?Ju(e,t):e instanceof Xu?Zu(e,t):function(e,t){const n=Qu(e,t),r=th(n)+th(e.Ie);return Ic(n)&&Ic(e.Ie)?Ku(r):zu(e.serializer,r)}(e,t)}function Hu(e,t,n){return e instanceof Yu?Ju(e,t):e instanceof Xu?Zu(e,t):n}function Qu(e,t){return e instanceof eh?function(e){return Ic(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class Wu extends $u{}class Yu extends $u{constructor(e){super(),this.elements=e}}function Ju(e,t){const n=nh(t);for(const t of e.elements)n.some((e=>pc(e,t)))||n.push(t);return{arrayValue:{values:n}}}class Xu extends $u{constructor(e){super(),this.elements=e}}function Zu(e,t){let n=nh(t);for(const t of e.elements)n=n.filter((e=>!pc(e,t)));return{arrayValue:{values:n}}}class eh extends $u{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function th(e){return ic(e.integerValue||e.doubleValue)}function nh(e){return bc(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class rh{constructor(e,t){this.field=e,this.transform=t}}class ih{constructor(e,t){this.version=e,this.transformResults=t}}class sh{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new sh}static exists(e){return new sh(void 0,e)}static updateTime(e){return new sh(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function oh(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class ah{}function ch(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new vh(e.key,sh.none()):new fh(e.key,e.data,sh.none());{const n=e.data,r=Rc.empty();let i=new Ya(Vo.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new ph(e.key,r,new Za(i.toArray()),sh.none())}}function uh(e,t,n){e instanceof fh?function(e,t,n){const r=e.value.clone(),i=mh(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof ph?function(e,t,n){if(!oh(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=mh(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(gh(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function hh(e,t,n,r){return e instanceof fh?function(e,t,n,r){if(!oh(e.precondition,t))return n;const i=e.value.clone(),s=yh(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof ph?function(e,t,n,r){if(!oh(e.precondition,t))return n;const i=yh(e.fieldTransforms,r,t),s=t.data;return s.setAll(gh(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return oh(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function lh(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=Qu(r.transform,e||null);null!=i&&(null===n&&(n=Rc.empty()),n.set(r.field,i))}return n||null}function dh(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&Ro(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Yu&&t instanceof Yu||e instanceof Xu&&t instanceof Xu?Ro(e.elements,t.elements,pc):e instanceof eh&&t instanceof eh?pc(e.Ie,t.Ie):e instanceof Wu&&t instanceof Wu}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class fh extends ah{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class ph extends ah{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function gh(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function mh(e,t,n){const r=new Map;yo(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,Hu(o,a,n[i]))}return r}function yh(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,Gu(e,s,t))}return r}class vh extends ah{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class wh extends ah{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class _h{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&uh(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=hh(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=hh(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Mu();return this.mutations.forEach((r=>{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const a=ch(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(Lo.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Bu())}isEqual(e){return this.batchId===e.batchId&&Ro(this.mutations,e.mutations,((e,t)=>dh(e,t)))&&Ro(this.baseMutations,e.baseMutations,((e,t)=>dh(e,t)))}}class Ih{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){yo(e.mutations.length===n.length);let r=Fu;const i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new Ih(e,t,n,r)}}class bh{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Eh{constructor(e,t){this.count=e,this.unchangedNames=t}}var Th,Sh;function Ch(e){if(void 0===e)return fo("GRPC error has no .code"),wo.UNKNOWN;switch(e){case Th.OK:return wo.OK;case Th.CANCELLED:return wo.CANCELLED;case Th.UNKNOWN:return wo.UNKNOWN;case Th.DEADLINE_EXCEEDED:return wo.DEADLINE_EXCEEDED;case Th.RESOURCE_EXHAUSTED:return wo.RESOURCE_EXHAUSTED;case Th.INTERNAL:return wo.INTERNAL;case Th.UNAVAILABLE:return wo.UNAVAILABLE;case Th.UNAUTHENTICATED:return wo.UNAUTHENTICATED;case Th.INVALID_ARGUMENT:return wo.INVALID_ARGUMENT;case Th.NOT_FOUND:return wo.NOT_FOUND;case Th.ALREADY_EXISTS:return wo.ALREADY_EXISTS;case Th.PERMISSION_DENIED:return wo.PERMISSION_DENIED;case Th.FAILED_PRECONDITION:return wo.FAILED_PRECONDITION;case Th.ABORTED:return wo.ABORTED;case Th.OUT_OF_RANGE:return wo.OUT_OF_RANGE;case Th.UNIMPLEMENTED:return wo.UNIMPLEMENTED;case Th.DATA_LOSS:return wo.DATA_LOSS;default:return mo()}}(Sh=Th||(Th={}))[Sh.OK=0]="OK",Sh[Sh.CANCELLED=1]="CANCELLED",Sh[Sh.UNKNOWN=2]="UNKNOWN",Sh[Sh.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Sh[Sh.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Sh[Sh.NOT_FOUND=5]="NOT_FOUND",Sh[Sh.ALREADY_EXISTS=6]="ALREADY_EXISTS",Sh[Sh.PERMISSION_DENIED=7]="PERMISSION_DENIED",Sh[Sh.UNAUTHENTICATED=16]="UNAUTHENTICATED",Sh[Sh.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Sh[Sh.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Sh[Sh.ABORTED=10]="ABORTED",Sh[Sh.OUT_OF_RANGE=11]="OUT_OF_RANGE",Sh[Sh.UNIMPLEMENTED=12]="UNIMPLEMENTED",Sh[Sh.INTERNAL=13]="INTERNAL",Sh[Sh.UNAVAILABLE=14]="UNAVAILABLE",Sh[Sh.DATA_LOSS=15]="DATA_LOSS";const Ah=new so([4294967295,4294967295],0);function kh(e){const t=(new TextEncoder).encode(e),n=new io;return n.update(t),new Uint8Array(n.digest())}function Nh(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new so([n,r],0),new so([i,s],0)]}class Dh{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new xh(`Invalid padding: ${t}`);if(n<0)throw new xh(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new xh(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new xh(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ee=so.fromNumber(this.Te)}de(e,t,n){let r=e.add(t.multiply(so.fromNumber(n)));return 1===r.compare(Ah)&&(r=new so([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Ee).toNumber()}Ae(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Te)return!1;const t=kh(e),[n,r]=Nh(t);for(let e=0;e<this.hashCount;e++){const t=this.de(n,r,e);if(!this.Ae(t))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new Dh(i,r,t);return n.forEach((e=>s.insert(e))),s}insert(e){if(0===this.Te)return;const t=kh(e),[n,r]=Nh(t);for(let e=0;e<this.hashCount;e++){const t=this.de(n,r,e);this.Re(t)}}Re(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class xh extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Rh{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,Oh.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Rh(Lo.min(),r,new Ha(xo),xu(),Bu())}}class Oh{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Oh(n,t,Bu(),Bu(),Bu())}}class Ph{constructor(e,t,n,r){this.Ve=e,this.removedTargetIds=t,this.key=n,this.me=r}}class Lh{constructor(e,t){this.targetId=e,this.fe=t}}class Mh{constructor(e,t,n=tc.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Uh{constructor(){this.ge=0,this.pe=Bh(),this.ye=tc.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=Bu(),t=Bu(),n=Bu();return this.pe.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:mo()}})),new Oh(this.ye,this.we,e,t,n)}Fe(){this.Se=!1,this.pe=Bh()}Me(e,t){this.Se=!0,this.pe=this.pe.insert(e,t)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1,yo(this.ge>=0)}Be(){this.Se=!0,this.we=!0}}class Fh{constructor(e){this.Le=e,this.ke=new Map,this.qe=xu(),this.Qe=Vh(),this.Ke=new Ha(xo)}$e(e){for(const t of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(t,e.me):this.We(t,e.key,e.me);for(const t of e.removedTargetIds)this.We(t,e.key,e.me)}Ge(e){this.forEachTarget(e,(t=>{const n=this.ze(t);switch(e.state){case 0:this.je(t)&&n.Ce(e.resumeToken);break;case 1:n.Ne(),n.be||n.Fe(),n.Ce(e.resumeToken);break;case 2:n.Ne(),n.be||this.removeTarget(t);break;case 3:this.je(t)&&(n.Be(),n.Ce(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),n.Ce(e.resumeToken));break;default:mo()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ke.forEach(((e,n)=>{this.je(n)&&t(n)}))}Je(e){const t=e.targetId,n=e.fe.count,r=this.Ye(t);if(r){const i=r.target;if(uu(i))if(0===n){const e=new Bo(i.path);this.We(t,e,Pc.newNoDocument(e,Lo.min()))}else yo(1===n);else{const r=this.Ze(t);if(r!==n){const n=this.Xe(e),i=n?this.et(n,e,r):1;if(0!==i){this.He(t);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,e)}}}}}Xe(e){const t=e.fe.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=t;let s,o;try{s=sc(n).toUint8Array()}catch(e){if(e instanceof ec)return po("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{o=new Dh(s,r,i)}catch(e){return po(e instanceof xh?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===o.Te?null:o}et(e,t,n){return t.fe.count===n-this.rt(e,t.targetId)?0:2}rt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let r=0;return n.forEach((n=>{const i=this.Le.nt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.We(t,n,null),r++)})),r}it(e){const t=new Map;this.ke.forEach(((n,r)=>{const i=this.Ye(r);if(i){if(n.current&&uu(i.target)){const t=new Bo(i.target.path);null!==this.qe.get(t)||this.st(r,t)||this.We(r,t,Pc.newNoDocument(t,e))}n.De&&(t.set(r,n.ve()),n.Fe())}}));let n=Bu();this.Qe.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.Ye(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.qe.forEach(((t,n)=>n.setReadTime(e)));const r=new Rh(e,t,this.Ke,this.qe,n);return this.qe=xu(),this.Qe=Vh(),this.Ke=new Ha(xo),r}Ue(e,t){if(!this.je(e))return;const n=this.st(e,t.key)?2:0;this.ze(e).Me(t.key,n),this.qe=this.qe.insert(t.key,t),this.Qe=this.Qe.insert(t.key,this.ot(t.key).add(e))}We(e,t,n){if(!this.je(e))return;const r=this.ze(e);this.st(e,t)?r.Me(t,1):r.xe(t),this.Qe=this.Qe.insert(t,this.ot(t).delete(e)),n&&(this.qe=this.qe.insert(t,n))}removeTarget(e){this.ke.delete(e)}Ze(e){const t=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let t=this.ke.get(e);return t||(t=new Uh,this.ke.set(e,t)),t}ot(e){let t=this.Qe.get(e);return t||(t=new Ya(xo),this.Qe=this.Qe.insert(e,t)),t}je(e){const t=null!==this.Ye(e);return t||lo("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){const t=this.ke.get(e);return t&&t.be?null:this.Le._t(e)}He(e){this.ke.set(e,new Uh),this.Le.getRemoteKeysForTarget(e).forEach((t=>{this.We(e,t,null)}))}st(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Vh(){return new Ha(Bo.comparator)}function Bh(){return new Ha(Bo.comparator)}const qh={asc:"ASCENDING",desc:"DESCENDING"},jh={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},zh={and:"AND",or:"OR"};class Kh{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function $h(e,t){return e.useProto3Json||da(t)?t:{value:t}}function Gh(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Hh(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Qh(e,t){return Gh(e,t.toTimestamp())}function Wh(e){return yo(!!e),Lo.fromTimestamp(function(e){const t=rc(e);return new Po(t.seconds,t.nanos)}(e))}function Yh(e,t){return Jh(e,t).canonicalString()}function Jh(e,t){const n=function(e){return new Uo(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function Xh(e){const t=Uo.fromString(e);return yo(wl(t)),t}function Zh(e,t){return Yh(e.databaseId,t.path)}function el(e,t){const n=Xh(t);if(n.get(1)!==e.databaseId.projectId)throw new _o(wo.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new _o(wo.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Bo(il(n))}function tl(e,t){return Yh(e.databaseId,t)}function nl(e){const t=Xh(e);return 4===t.length?Uo.emptyPath():il(t)}function rl(e){return new Uo(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function il(e){return yo(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function sl(e,t,n){return{name:Zh(e,t),fields:n.value.mapValue.fields}}function ol(e,t){let n;if(t instanceof fh)n={update:sl(e,t.key,t.value)};else if(t instanceof vh)n={delete:Zh(e,t.key)};else if(t instanceof ph)n={update:sl(e,t.key,t.data),updateMask:vl(t.fieldMask)};else{if(!(t instanceof wh))return mo();n={verify:Zh(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof Wu)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Yu)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Xu)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof eh)return{fieldPath:t.field.canonicalString(),increment:n.Ie};throw mo()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Qh(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:mo()}(e,t.precondition)),n}function al(e,t){const n=t.currentDocument?function(e){return void 0!==e.updateTime?sh.updateTime(Wh(e.updateTime)):void 0!==e.exists?sh.exists(e.exists):sh.none()}(t.currentDocument):sh.none(),r=t.updateTransforms?t.updateTransforms.map((t=>function(e,t){let n=null;if("setToServerValue"in t)yo("REQUEST_TIME"===t.setToServerValue),n=new Wu;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new Yu(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new Xu(e)}else"increment"in t?n=new eh(e,t.increment):mo();const r=Vo.fromServerFormat(t.fieldPath);return new rh(r,n)}(e,t))):[];if(t.update){t.update.name;const i=el(e,t.update.name),s=new Rc({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new Za(t.map((e=>Vo.fromServerFormat(e))))}(t.updateMask);return new ph(i,s,e,n,r)}return new fh(i,s,n,r)}if(t.delete){const r=el(e,t.delete);return new vh(r,n)}if(t.verify){const r=el(e,t.verify);return new wh(r,n)}return mo()}function cl(e,t){return{documents:[tl(e,t.path)]}}function ul(e,t){const n={structuredQuery:{}},r=t.path;let i;null!==t.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=tl(e,i);const s=function(e){if(0!==e.length)return yl(jc.create(e,"and"))}(t.filters);s&&(n.structuredQuery.where=s);const o=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:gl(e.field),direction:dl(e.dir)}}(e)))}(t.orderBy);o&&(n.structuredQuery.orderBy=o);const a=$h(e,t.limit);return null!==a&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ut:n,parent:i}}function hl(e){let t=nl(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){yo(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=ll(e);return t instanceof jc&&$c(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=function(e){return e.map((e=>function(e){return new Fc(ml(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)))}(n.orderBy));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,da(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new Lc(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new Lc(n,t)}(n.endAt)),pu(t,i,o,s,a,"F",c,u)}function ll(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=ml(e.unaryFilter.field);return qc.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=ml(e.unaryFilter.field);return qc.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=ml(e.unaryFilter.field);return qc.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=ml(e.unaryFilter.field);return qc.create(i,"!=",{nullValue:"NULL_VALUE"});default:return mo()}}(e):void 0!==e.fieldFilter?function(e){return qc.create(ml(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return mo()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return jc.create(e.compositeFilter.filters.map((e=>ll(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return mo()}}(e.compositeFilter.op))}(e):mo()}function dl(e){return qh[e]}function fl(e){return jh[e]}function pl(e){return zh[e]}function gl(e){return{fieldPath:e.canonicalString()}}function ml(e){return Vo.fromServerFormat(e.fieldPath)}function yl(e){return e instanceof qc?function(e){if("=="===e.op){if(Tc(e.value))return{unaryFilter:{field:gl(e.field),op:"IS_NAN"}};if(Ec(e.value))return{unaryFilter:{field:gl(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Tc(e.value))return{unaryFilter:{field:gl(e.field),op:"IS_NOT_NAN"}};if(Ec(e.value))return{unaryFilter:{field:gl(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:gl(e.field),op:fl(e.op),value:e.value}}}(e):e instanceof jc?function(e){const t=e.getFilters().map((e=>yl(e)));return 1===t.length?t[0]:{compositeFilter:{op:pl(e.op),filters:t}}}(e):mo()}function vl(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function wl(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class _l{constructor(e,t,n,r,i=Lo.min(),s=Lo.min(),o=tc.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new _l(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new _l(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new _l(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new _l(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Il{constructor(e){this.ct=e}}function bl(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:El(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:Zh(e,t.key),fields:t.data.value.mapValue.fields,updateTime:Gh(e,t.version.toTimestamp()),createTime:Gh(e,t.createTime.toTimestamp())}}(e.ct,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Tl(t.version)};else{if(!t.isUnknownDocument())return mo();r.unknownDocument={path:n.path.toArray(),version:Tl(t.version)}}return r}function El(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Tl(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Sl(e){const t=new Po(e.seconds,e.nanoseconds);return Lo.fromTimestamp(t)}function Cl(e,t){const n=(t.baseMutations||[]).map((t=>al(e.ct,t)));for(let e=0;e<t.mutations.length-1;++e){const n=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){const r=t.mutations[e+1];n.updateTransforms=r.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}const r=t.mutations.map((t=>al(e.ct,t))),i=Po.fromMillis(t.localWriteTimeMs);return new _h(t.batchId,i,n,r)}function Al(e){const t=Sl(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?Sl(e.lastLimboFreeSnapshotVersion):Lo.min();let r;return r=function(e){return void 0!==e.documents}(e.query)?function(e){return yo(1===e.documents.length),wu(gu(nl(e.documents[0])))}(e.query):function(e){return wu(hl(e))}(e.query),new _l(r,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,t,n,tc.fromBase64String(e.resumeToken))}function kl(e,t){const n=Tl(t.snapshotVersion),r=Tl(t.lastLimboFreeSnapshotVersion);let i;i=uu(t.target)?cl(e.ct,t.target):ul(e.ct,t.target).ut;const s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:au(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Nl(e){const t=hl({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Iu(t,t.limit,"L"):t}function Dl(e,t){return new bh(t.largestBatchId,al(e.ct,t.overlayMutation))}function xl(e,t){const n=t.path.lastSegment();return[e,ga(t.path.popLast()),n]}function Rl(e,t,n,r){return{indexId:e,uid:t,sequenceNumber:n,readTime:Tl(r.readTime),documentKey:ga(r.documentKey.path),largestBatchId:r.largestBatchId}}class Ol{getBundleMetadata(e,t){return Pl(e).get(t).next((e=>{if(e)return function(e){return{id:e.bundleId,createTime:Sl(e.createTime),version:e.version}}(e)}))}saveBundleMetadata(e,t){return Pl(e).put(function(e){return{bundleId:e.id,createTime:Tl(Wh(e.createTime)),version:e.version}}(t))}getNamedQuery(e,t){return Ll(e).get(t).next((e=>{if(e)return function(e){return{name:e.name,query:Nl(e.bundledQuery),readTime:Sl(e.readTime)}}(e)}))}saveNamedQuery(e,t){return Ll(e).put(function(e){return{name:e.name,readTime:Tl(Wh(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function Pl(e){return za(e,"bundles")}function Ll(e){return za(e,"namedQueries")}class Ml{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const n=t.uid||"";return new Ml(e,n)}getOverlay(e,t){return Ul(e).get(xl(this.userId,t)).next((e=>e?Dl(this.serializer,e):null))}getOverlays(e,t){const n=Lu();return Zo.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){const r=[];return n.forEach(((n,i)=>{const s=new bh(t,i);r.push(this.ht(e,s))})),Zo.waitFor(r)}removeOverlaysForBatchId(e,t,n){const r=new Set;t.forEach((e=>r.add(ga(e.getCollectionPath()))));const i=[];return r.forEach((t=>{const r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(Ul(e).H("collectionPathOverlayIndex",r))})),Zo.waitFor(i)}getOverlaysForCollection(e,t,n){const r=Lu(),i=ga(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Ul(e).W("collectionPathOverlayIndex",s).next((e=>{for(const t of e){const e=Dl(this.serializer,t);r.set(e.getKey(),e)}return r}))}getOverlaysForCollectionGroup(e,t,n,r){const i=Lu();let s;const o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Ul(e).Y({index:"collectionGroupOverlayIndex",range:o},((e,t,n)=>{const o=Dl(this.serializer,t);i.size()<r||o.largestBatchId===s?(i.set(o.getKey(),o),s=o.largestBatchId):n.done()})).next((()=>i))}ht(e,t){return Ul(e).put(function(e,t,n){const[r,i,s]=xl(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:ol(e.ct,n.mutation)}}(this.serializer,this.userId,t))}}function Ul(e){return za(e,"documentOverlays")}class Fl{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(ic(e.integerValue));else if("doubleValue"in e){const n=ic(e.doubleValue);isNaN(n)?this.Et(t,13):(this.Et(t,15),fa(n)?t.dt(0):t.dt(n))}else if("timestampValue"in e){const n=e.timestampValue;this.Et(t,20),"string"==typeof n?t.At(n):(t.At(`${n.seconds||""}`),t.dt(n.nanos||0))}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(sc(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Et(t,45),t.dt(n.latitude||0),t.dt(n.longitude||0)}else"mapValue"in e?Ac(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):mo()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){const n=e.fields||{};this.Et(t,55);for(const e of Object.keys(n))this.Rt(e,t),this.It(n[e],t)}wt(e,t){const n=e.values||[];this.Et(t,50);for(const e of n)this.It(e,t)}gt(e,t){this.Et(t,37),Bo.fromName(e).path.forEach((e=>{this.Et(t,60),this.St(e,t)}))}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}}function Vl(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function Bl(e){const t=64-function(e){let t=0;for(let n=0;n<8;++n){const r=Vl(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}Fl.bt=new Fl;class ql{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ct(n.value),n=t.next();this.vt()}Ft(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Mt(n.value),n=t.next();this.xt()}Ot(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ct(e);else if(e<2048)this.Ct(960|e>>>6),this.Ct(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ct(480|e>>>12),this.Ct(128|63&e>>>6),this.Ct(128|63&e);else{const e=t.codePointAt(0);this.Ct(240|e>>>18),this.Ct(128|63&e>>>12),this.Ct(128|63&e>>>6),this.Ct(128|63&e)}}this.vt()}Nt(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Mt(e);else if(e<2048)this.Mt(960|e>>>6),this.Mt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Mt(480|e>>>12),this.Mt(128|63&e>>>6),this.Mt(128|63&e);else{const e=t.codePointAt(0);this.Mt(240|e>>>18),this.Mt(128|63&e>>>12),this.Mt(128|63&e>>>6),this.Mt(128|63&e)}}this.xt()}Bt(e){const t=this.Lt(e),n=Bl(t);this.kt(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}qt(e){const t=this.Lt(e),n=Bl(t);this.kt(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(e){this.kt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Wt(){return this.buffer.slice(0,this.position)}Lt(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}Ct(e){const t=255&e;0===t?(this.Kt(0),this.Kt(255)):255===t?(this.Kt(255),this.Kt(0)):this.Kt(t)}Mt(e){const t=255&e;0===t?(this.Ut(0),this.Ut(255)):255===t?(this.Ut(255),this.Ut(0)):this.Ut(e)}vt(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(e){this.kt(1),this.buffer[this.position++]=e}Ut(e){this.kt(1),this.buffer[this.position++]=~e}kt(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class jl{constructor(e){this.Gt=e}ft(e){this.Gt.Dt(e)}At(e){this.Gt.Ot(e)}dt(e){this.Gt.Bt(e)}Tt(){this.Gt.Qt()}}class zl{constructor(e){this.Gt=e}ft(e){this.Gt.Ft(e)}At(e){this.Gt.Nt(e)}dt(e){this.Gt.qt(e)}Tt(){this.Gt.$t()}}class Kl{constructor(){this.Gt=new ql,this.zt=new jl(this.Gt),this.jt=new zl(this.Gt)}seed(e){this.Gt.seed(e)}Ht(e){return 0===e?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}}class $l{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Jt(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new $l(this.indexId,this.documentKey,this.arrayValue,n)}}function Gl(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=Hl(e.arrayValue,t.arrayValue),0!==n?n:(n=Hl(e.directionalValue,t.directionalValue),0!==n?n:Bo.comparator(e.documentKey,t.documentKey)))}function Hl(e,t){for(let n=0;n<e.length&&n<t.length;++n){const r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}class Ql{constructor(e){this.Yt=new Ya(((e,t)=>Vo.comparator(e.field,t.field))),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Zt=e.orderBy,this.Xt=[];for(const t of e.filters){const e=t;e.isInequality()?this.Yt=this.Yt.add(e):this.Xt.push(e)}}get en(){return this.Yt.size>1}tn(e){if(yo(e.collectionGroup===this.collectionId),this.en)return!1;const t=jo(e);if(void 0!==t&&!this.nn(t))return!1;const n=zo(e);let r=new Set,i=0,s=0;for(;i<n.length&&this.nn(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.Yt.size>0){const e=this.Yt.getIterator().getNext();if(!r.has(e.field.canonicalString())){const t=n[i];if(!this.rn(e,t)||!this.sn(this.Zt[s++],t))return!1}++i}for(;i<n.length;++i){const e=n[i];if(s>=this.Zt.length||!this.sn(this.Zt[s++],e))return!1}return!0}on(){if(this.en)return null;let e=new Ya(Vo.comparator);const t=[];for(const n of this.Xt)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new Ko(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new Ko(n.field,0))}for(const n of this.Zt)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new Ko(n.field,"asc"===n.dir?0:1)));return new qo(qo.UNKNOWN_ID,this.collectionId,t,$o.empty())}nn(e){for(const t of this.Xt)if(this.rn(t,e))return!0;return!1}rn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Wl(e){var t,n;if(yo(e instanceof qc||e instanceof jc),e instanceof qc){if(e instanceof nu){const r=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map((t=>qc.create(e.field,"==",t))))||[];return jc.create(r,"or")}return e}const r=e.filters.map((e=>Wl(e)));return jc.create(r,e.op)}function Yl(e){if(0===e.getFilters().length)return[];const t=ed(Wl(e));return yo(Zl(t)),Jl(t)||Xl(t)?[t]:t.getFilters()}function Jl(e){return e instanceof qc}function Xl(e){return e instanceof jc&&$c(e)}function Zl(e){return Jl(e)||Xl(e)||function(e){if(e instanceof jc&&Kc(e)){for(const t of e.getFilters())if(!Jl(t)&&!Xl(t))return!1;return!0}return!1}(e)}function ed(e){if(yo(e instanceof qc||e instanceof jc),e instanceof qc)return e;if(1===e.filters.length)return ed(e.filters[0]);const t=e.filters.map((e=>ed(e)));let n=jc.create(t,e.op);return n=rd(n),Zl(n)?n:(yo(n instanceof jc),yo(zc(n)),yo(n.filters.length>1),n.filters.reduce(((e,t)=>td(e,t))))}function td(e,t){let n;return yo(e instanceof qc||e instanceof jc),yo(t instanceof qc||t instanceof jc),n=e instanceof qc?t instanceof qc?function(e,t){return jc.create([e,t],"and")}(e,t):nd(e,t):t instanceof qc?nd(t,e):function(e,t){if(yo(e.filters.length>0&&t.filters.length>0),zc(e)&&zc(t))return Wc(e,t.getFilters());const n=Kc(e)?e:t,r=Kc(e)?t:e,i=n.filters.map((e=>td(e,r)));return jc.create(i,"or")}(e,t),rd(n)}function nd(e,t){if(zc(t))return Wc(t,e.getFilters());{const n=t.filters.map((t=>td(e,t)));return jc.create(n,"or")}}function rd(e){if(yo(e instanceof qc||e instanceof jc),e instanceof qc)return e;const t=e.getFilters();if(1===t.length)return rd(t[0]);if(Gc(e))return e;const n=t.map((e=>rd(e))),r=[];return n.forEach((t=>{t instanceof qc?r.push(t):t instanceof jc&&(t.op===e.op?r.push(...t.filters):r.push(t))})),1===r.length?r[0]:jc.create(r,e.op)}class id{constructor(){this._n=new sd}addToCollectionParentIndex(e,t){return this._n.add(t),Zo.resolve()}getCollectionParents(e,t){return Zo.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return Zo.resolve()}deleteFieldIndex(e,t){return Zo.resolve()}deleteAllFieldIndexes(e){return Zo.resolve()}createTargetIndexes(e,t){return Zo.resolve()}getDocumentsMatchingTarget(e,t){return Zo.resolve(null)}getIndexType(e,t){return Zo.resolve(0)}getFieldIndexes(e,t){return Zo.resolve([])}getNextCollectionGroupToUpdate(e){return Zo.resolve(null)}getMinOffset(e,t){return Zo.resolve(Qo.min())}getMinOffsetFromCollectionGroup(e,t){return Zo.resolve(Qo.min())}updateCollectionGroup(e,t,n){return Zo.resolve()}updateIndexEntries(e,t){return Zo.resolve()}}class sd{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Ya(Uo.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Ya(Uo.comparator)).toArray()}}const od=new Uint8Array(0);class ad{constructor(e,t){this.databaseId=t,this.an=new sd,this.un=new Nu((e=>au(e)),((e,t)=>cu(e,t))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.an.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener((()=>{this.an.add(t)}));const i={collectionId:n,parent:ga(r)};return cd(e).put(i)}return Zo.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[Oo(t),""],!1,!0);return cd(e).W(r).next((e=>{for(const r of e){if(r.collectionId!==t)break;n.push(va(r.parent))}return n}))}addFieldIndex(e,t){const n=hd(e),r=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map((e=>[e.fieldPath.canonicalString(),e.kind]))}}(t);delete r.indexId;const i=n.add(r);if(t.indexState){const n=ld(e);return i.next((e=>{n.put(Rl(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return i.next()}deleteFieldIndex(e,t){const n=hd(e),r=ld(e),i=ud(e);return n.delete(t.indexId).next((()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}deleteAllFieldIndexes(e){const t=hd(e),n=ud(e),r=ld(e);return t.H().next((()=>n.H())).next((()=>r.H()))}createTargetIndexes(e,t){return Zo.forEach(this.cn(t),(t=>this.getIndexType(e,t).next((n=>{if(0===n||1===n){const n=new Ql(t).on();if(null!=n)return this.addFieldIndex(e,n)}}))))}getDocumentsMatchingTarget(e,t){const n=ud(e);let r=!0;const i=new Map;return Zo.forEach(this.cn(t),(t=>this.ln(e,t).next((e=>{r&&(r=!!e),i.set(t,e)})))).next((()=>{if(r){let e=Bu();const r=[];return Zo.forEach(i,((i,s)=>{lo("IndexedDbIndexManager",`Using index ${function(e){return`id=${e.indexId}|cg=${e.collectionGroup}|f=${e.fields.map((e=>`${e.fieldPath}:${e.kind}`)).join(",")}`}(i)} to execute ${au(t)}`);const o=function(e,t){const n=jo(t);if(void 0===n)return null;for(const t of hu(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),a=function(e,t){const n=new Map;for(const r of zo(t))for(const t of hu(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),c=function(e,t){const n=[];let r=!0;for(const i of zo(t)){const t=0===i.kind?lu(e,i.fieldPath,e.startAt):du(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new Lc(n,r)}(s,i),u=function(e,t){const n=[];let r=!0;for(const i of zo(t)){const t=0===i.kind?du(e,i.fieldPath,e.endAt):lu(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new Lc(n,r)}(s,i),h=this.hn(i,s,c),l=this.hn(i,s,u),d=this.Pn(i,s,a),f=this.In(i.indexId,o,h,c.inclusive,l,u.inclusive,d);return Zo.forEach(f,(i=>n.j(i,t.limit).next((t=>{t.forEach((t=>{const n=Bo.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))}))}))))})).next((()=>r))}return Zo.resolve(null)}))}cn(e){let t=this.un.get(e);return t||(t=0===e.filters.length?[e]:Yl(jc.create(e.filters,"and")).map((t=>ou(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt))),this.un.set(e,t),t)}In(e,t,n,r,i,s,o){const a=(null!=t?t.length:1)*Math.max(n.length,i.length),c=a/(null!=t?t.length:1),u=[];for(let h=0;h<a;++h){const a=t?this.Tn(t[h/c]):od,l=this.En(e,a,n[h%c],r),d=this.dn(e,a,i[h%c],s),f=o.map((t=>this.En(e,a,t,!0)));u.push(...this.createRange(l,d,f))}return u}En(e,t,n,r){const i=new $l(e,Bo.empty(),t,n);return r?i:i.Jt()}dn(e,t,n,r){const i=new $l(e,Bo.empty(),t,n);return r?i.Jt():i}ln(e,t){const n=new Ql(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((e=>{let t=null;for(const r of e)n.tn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t}))}getIndexType(e,t){let n=2;const r=this.cn(t);return Zo.forEach(r,(t=>this.ln(e,t).next((e=>{e?0!==n&&e.fields.length<function(e){let t=new Ya(Vo.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})))).next((()=>function(e){return null!==e.limit}(t)&&r.length>1&&2===n?1:n))}An(e,t){const n=new Kl;for(const r of zo(e)){const e=t.data.field(r.fieldPath);if(null==e)return null;const i=n.Ht(r.kind);Fl.bt.Pt(e,i)}return n.Wt()}Tn(e){const t=new Kl;return Fl.bt.Pt(e,t.Ht(0)),t.Wt()}Rn(e,t){const n=new Kl;return Fl.bt.Pt(_c(this.databaseId,t),n.Ht(function(e){const t=zo(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.Wt()}Pn(e,t,n){if(null===n)return[];let r=[];r.push(new Kl);let i=0;for(const s of zo(e)){const e=n[i++];for(const n of r)if(this.Vn(t,s.fieldPath)&&bc(e))r=this.mn(r,s,e);else{const t=n.Ht(s.kind);Fl.bt.Pt(e,t)}}return this.fn(r)}hn(e,t,n){return this.Pn(e,t,n.position)}fn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Wt();return t}mn(e,t,n){const r=[...e],i=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new Kl;r.seed(n.Wt()),Fl.bt.Pt(e,r.Ht(t.kind)),i.push(r)}return i}Vn(e,t){return!!e.filters.find((e=>e instanceof qc&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)))}getFieldIndexes(e,t){const n=hd(e),r=ld(e);return(t?n.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.W()).next((e=>{const t=[];return Zo.forEach(e,(e=>r.get([e.indexId,this.uid]).next((n=>{t.push(function(e,t){const n=t?new $o(t.sequenceNumber,new Qo(Sl(t.readTime),new Bo(va(t.documentKey)),t.largestBatchId)):$o.empty(),r=e.fields.map((([e,t])=>new Ko(Vo.fromServerFormat(e),t)));return new qo(e.indexId,e.collectionGroup,r,n)}(e,n))})))).next((()=>t))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((e=>0===e.length?null:(e.sort(((e,t)=>{const n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:xo(e.collectionGroup,t.collectionGroup)})),e[0].collectionGroup)))}updateCollectionGroup(e,t,n){const r=hd(e),i=ld(e);return this.gn(e).next((e=>r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next((t=>Zo.forEach(t,(t=>i.put(Rl(t.indexId,this.uid,e,n))))))))}updateIndexEntries(e,t){const n=new Map;return Zo.forEach(t,((t,r)=>{const i=n.get(t.collectionGroup);return(i?Zo.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next((i=>(n.set(t.collectionGroup,i),Zo.forEach(i,(n=>this.pn(e,t,n).next((t=>{const i=this.yn(r,n);return t.isEqual(i)?Zo.resolve():this.wn(e,r,n,t,i)})))))))}))}Sn(e,t,n,r){return ud(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.Rn(n,t.key),documentKey:t.key.path.toArray()})}bn(e,t,n,r){return ud(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.Rn(n,t.key),t.key.path.toArray()])}pn(e,t,n){const r=ud(e);let i=new Ya(Gl);return r.Y({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.Rn(n,t)])},((e,r)=>{i=i.add(new $l(n.indexId,t,r.arrayValue,r.directionalValue))})).next((()=>i))}yn(e,t){let n=new Ya(Gl);const r=this.An(t,e);if(null==r)return n;const i=jo(t);if(null!=i){const s=e.data.field(i.fieldPath);if(bc(s))for(const i of s.arrayValue.values||[])n=n.add(new $l(t.indexId,e.key,this.Tn(i),r))}else n=n.add(new $l(t.indexId,e.key,od,r));return n}wn(e,t,n,r,i){lo("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const s=[];return function(e,t,n,r,i){const s=e.getIterator(),o=t.getIterator();let a=Xa(s),c=Xa(o);for(;a||c;){let e=!1,t=!1;if(a&&c){const r=n(a,c);r<0?t=!0:r>0&&(e=!0)}else null!=a?t=!0:e=!0;e?(r(c),c=Xa(o)):t?(i(a),a=Xa(s)):(a=Xa(s),c=Xa(o))}}(r,i,Gl,(r=>{s.push(this.Sn(e,t,n,r))}),(r=>{s.push(this.bn(e,t,n,r))})),Zo.waitFor(s)}gn(e){let t=1;return ld(e).Y({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((e,n,r)=>{r.done(),t=n.sequenceNumber+1})).next((()=>t))}createRange(e,t,n){n=n.sort(((e,t)=>Gl(e,t))).filter(((e,t,n)=>!t||0!==Gl(e,n[t-1])));const r=[];r.push(e);for(const i of n){const n=Gl(i,e),s=Gl(i,t);if(0===n)r[0]=e.Jt();else if(n>0&&s<0)r.push(i),r.push(i.Jt());else if(s>0)break}r.push(t);const i=[];for(let e=0;e<r.length;e+=2){if(this.Dn(r[e],r[e+1]))return[];const t=[r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,od,[]],n=[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,od,[]];i.push(IDBKeyRange.bound(t,n))}return i}Dn(e,t){return Gl(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(dd)}getMinOffset(e,t){return Zo.mapArray(this.cn(t),(t=>this.ln(e,t).next((e=>e||mo())))).next(dd)}}function cd(e){return za(e,"collectionParents")}function ud(e){return za(e,"indexEntries")}function hd(e){return za(e,"indexConfiguration")}function ld(e){return za(e,"indexState")}function dd(e){yo(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){const i=e[r].indexState.offset;Wo(i,t)<0&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new Qo(t.readTime,t.documentKey,n)}const fd={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class pd{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new pd(e,pd.DEFAULT_COLLECTION_PERCENTILE,pd.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function gd(e,t,n){const r=e.store("mutations"),i=e.store("documentMutations"),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.Y({range:o},((e,t,n)=>(a++,n.delete())));s.push(c.next((()=>{yo(1===a)})));const u=[];for(const e of n.mutations){const r=Ia(t,e.key.path,n.batchId);s.push(i.delete(r)),u.push(e.key)}return Zo.waitFor(s).next((()=>u))}function md(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw mo();t=e.noDocument}return JSON.stringify(t).length}pd.DEFAULT_COLLECTION_PERCENTILE=10,pd.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,pd.DEFAULT=new pd(41943040,pd.DEFAULT_COLLECTION_PERCENTILE,pd.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),pd.DISABLED=new pd(-1,0,0);class yd{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Cn={}}static lt(e,t,n,r){yo(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new yd(i,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return wd(e).Y({index:"userMutationsIndex",range:n},((e,n,r)=>{t=!1,r.done()})).next((()=>t))}addMutationBatch(e,t,n,r){const i=_d(e),s=wd(e);return s.add({}).next((o=>{yo("number"==typeof o);const a=new _h(o,t,n,r),c=function(e,t,n){const r=n.baseMutations.map((t=>ol(e.ct,t))),i=n.mutations.map((t=>ol(e.ct,t)));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(this.serializer,this.userId,a),u=[];let h=new Ya(((e,t)=>xo(e.canonicalString(),t.canonicalString())));for(const e of r){const t=Ia(this.userId,e.key.path,o);h=h.add(e.key.path.popLast()),u.push(s.put(c)),u.push(i.put(t,ba))}return h.forEach((t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((()=>{this.Cn[o]=a.keys()})),Zo.waitFor(u).next((()=>a))}))}lookupMutationBatch(e,t){return wd(e).get(t).next((e=>e?(yo(e.userId===this.userId),Cl(this.serializer,e)):null))}vn(e,t){return this.Cn[t]?Zo.resolve(this.Cn[t]):this.lookupMutationBatch(e,t).next((e=>{if(e){const n=e.keys();return this.Cn[t]=n,n}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return wd(e).Y({index:"userMutationsIndex",range:r},((e,t,r)=>{t.userId===this.userId&&(yo(t.batchId>=n),i=Cl(this.serializer,t)),r.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return wd(e).Y({index:"userMutationsIndex",range:t,reverse:!0},((e,t,r)=>{n=t.batchId,r.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return wd(e).W("userMutationsIndex",t).next((e=>e.map((e=>Cl(this.serializer,e)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=_a(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return _d(e).Y({range:r},((n,r,s)=>{const[o,a,c]=n,u=va(a);if(o===this.userId&&t.path.isEqual(u))return wd(e).get(c).next((e=>{if(!e)throw mo();yo(e.userId===this.userId),i.push(Cl(this.serializer,e))}));s.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Ya(xo);const r=[];return t.forEach((t=>{const i=_a(this.userId,t.path),s=IDBKeyRange.lowerBound(i),o=_d(e).Y({range:s},((e,r,i)=>{const[s,o,a]=e,c=va(o);s===this.userId&&t.path.isEqual(c)?n=n.add(a):i.done()}));r.push(o)})),Zo.waitFor(r).next((()=>this.Fn(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,i=_a(this.userId,n),s=IDBKeyRange.lowerBound(i);let o=new Ya(xo);return _d(e).Y({range:s},((e,t,i)=>{const[s,a,c]=e,u=va(a);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):i.done()})).next((()=>this.Fn(e,o)))}Fn(e,t){const n=[],r=[];return t.forEach((t=>{r.push(wd(e).get(t).next((e=>{if(null===e)throw mo();yo(e.userId===this.userId),n.push(Cl(this.serializer,e))})))})),Zo.waitFor(r).next((()=>n))}removeMutationBatch(e,t){return gd(e.ae,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.Mn(t.batchId)})),Zo.forEach(n,(t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))))}Mn(e){delete this.Cn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return Zo.resolve();const n=IDBKeyRange.lowerBound(function(e){return[e]}(this.userId)),r=[];return _d(e).Y({range:n},((e,t,n)=>{if(e[0]===this.userId){const t=va(e[1]);r.push(t)}else n.done()})).next((()=>{yo(0===r.length)}))}))}containsKey(e,t){return vd(e,this.userId,t)}xn(e){return Id(e).get(this.userId).next((e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}))}}function vd(e,t,n){const r=_a(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return _d(e).Y({range:s,J:!0},((e,n,r)=>{const[s,a,c]=e;s===t&&a===i&&(o=!0),r.done()})).next((()=>o))}function wd(e){return za(e,"mutations")}function _d(e){return za(e,"documentMutations")}function Id(e){return za(e,"mutationQueues")}class bd{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new bd(0)}static Bn(){return new bd(-1)}}class Ed{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Ln(e).next((t=>{const n=new bd(t.highestTargetId);return t.highestTargetId=n.next(),this.kn(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.Ln(e).next((e=>Lo.fromTimestamp(new Po(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.Ln(e).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.Ln(e).next((r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.kn(e,r))))}addTargetData(e,t){return this.qn(e,t).next((()=>this.Ln(e).next((n=>(n.targetCount+=1,this.Qn(t,n),this.kn(e,n))))))}updateTargetData(e,t){return this.qn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>Td(e).delete(t.targetId))).next((()=>this.Ln(e))).next((t=>(yo(t.targetCount>0),t.targetCount-=1,this.kn(e,t))))}removeTargets(e,t,n){let r=0;const i=[];return Td(e).Y(((s,o)=>{const a=Al(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r++,i.push(this.removeTargetData(e,a)))})).next((()=>Zo.waitFor(i))).next((()=>r))}forEachTarget(e,t){return Td(e).Y(((e,n)=>{const r=Al(n);t(r)}))}Ln(e){return Sd(e).get("targetGlobalKey").next((e=>(yo(null!==e),e)))}kn(e,t){return Sd(e).put("targetGlobalKey",t)}qn(e,t){return Td(e).put(kl(this.serializer,t))}Qn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Ln(e).next((e=>e.targetCount))}getTargetData(e,t){const n=au(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return Td(e).Y({range:r,index:"queryTargetsIndex"},((e,n,r)=>{const s=Al(n);cu(t,s.target)&&(i=s,r.done())})).next((()=>i))}addMatchingKeys(e,t,n){const r=[],i=Cd(e);return t.forEach((t=>{const s=ga(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))})),Zo.waitFor(r)}removeMatchingKeys(e,t,n){const r=Cd(e);return Zo.forEach(t,(t=>{const i=ga(t.path);return Zo.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])}))}removeMatchingKeysForTargetId(e,t){const n=Cd(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Cd(e);let i=Bu();return r.Y({range:n,J:!0},((e,t,n)=>{const r=va(e[1]),s=new Bo(r);i=i.add(s)})).next((()=>i))}containsKey(e,t){const n=ga(t.path),r=IDBKeyRange.bound([n],[Oo(n)],!1,!0);let i=0;return Cd(e).Y({index:"documentTargetsIndex",J:!0,range:r},(([e,t],n,r)=>{0!==e&&(i++,r.done())})).next((()=>i>0))}_t(e,t){return Td(e).get(t).next((e=>e?Al(e):null))}}function Td(e){return za(e,"targets")}function Sd(e){return za(e,"targetGlobal")}function Cd(e){return za(e,"targetDocuments")}function Ad([e,t],[n,r]){const i=xo(e,n);return 0===i?xo(t,r):i}class kd{constructor(e){this.Kn=e,this.buffer=new Ya(Ad),this.$n=0}Un(){return++this.$n}Wn(e){const t=[e,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Ad(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Nd{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Gn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return null!==this.Gn}zn(e){lo("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Gn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){ia(e)?lo("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await Xo(e)}await this.zn(3e5)}))}}class Dd{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.Hn(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return Zo.resolve(la._e);const n=new kd(t);return this.jn.forEachTarget(e,(e=>n.Wn(e.sequenceNumber))).next((()=>this.jn.Jn(e,(e=>n.Wn(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(lo("LruGarbageCollector","Garbage collection skipped; disabled"),Zo.resolve(fd)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(lo("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),fd):this.Yn(e,t)))}getCacheSize(e){return this.jn.getCacheSize(e)}Yn(e,t){let n,r,i,s,o,a,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(lo("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(e,n,t)))).next((t=>(i=t,a=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(c=Date.now(),ho()<=A.DEBUG&&lo("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-u}ms\n\tDetermined least recently used ${r} in `+(o-s)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${e} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-u}ms`),Zo.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e}))))}}class xd{constructor(e,t){this.db=e,this.garbageCollector=function(e,t){return new Dd(e,t)}(this,t)}Hn(e){const t=this.Zn(e);return this.db.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}Zn(e){let t=0;return this.Jn(e,(e=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Jn(e,t){return this.Xn(e,((e,n)=>t(n)))}addReference(e,t,n){return Rd(e,n)}removeReference(e,t,n){return Rd(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Rd(e,t)}er(e,t){return function(e,t){let n=!1;return Id(e).Z((r=>vd(e,r,t).next((e=>(e&&(n=!0),Zo.resolve(!e)))))).next((()=>n))}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.Xn(e,((s,o)=>{if(o<=t){const t=this.er(e,s).next((t=>{if(!t)return i++,n.getEntry(e,s).next((()=>(n.removeEntry(s,Lo.min()),Cd(e).delete(function(e){return[0,ga(e.path)]}(s)))))}));r.push(t)}})).next((()=>Zo.waitFor(r))).next((()=>n.apply(e))).next((()=>i))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Rd(e,t)}Xn(e,t){const n=Cd(e);let r,i=la._e;return n.Y({index:"documentTargetsIndex"},(([e,n],{path:s,sequenceNumber:o})=>{0===e?(i!==la._e&&t(new Bo(va(r)),i),i=o,r=s):i=la._e})).next((()=>{i!==la._e&&t(new Bo(va(r)),i)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Rd(e,t){return Cd(e).put(function(e,t){return{targetId:0,path:ga(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}class Od{constructor(){this.changes=new Nu((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Pc.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Zo.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Pd{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return Fd(e).put(n)}removeEntry(e,t,n){return Fd(e).delete(function(e,t){const n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],El(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.tr(e,n))))}getEntry(e,t){let n=Pc.newInvalidDocument(t);return Fd(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(Vd(t))},((e,r)=>{n=this.nr(t,r)})).next((()=>n))}rr(e,t){let n={size:0,document:Pc.newInvalidDocument(t)};return Fd(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(Vd(t))},((e,r)=>{n={document:this.nr(t,r),size:md(r)}})).next((()=>n))}getEntries(e,t){let n=xu();return this.ir(e,t,((e,t)=>{const r=this.nr(e,t);n=n.insert(e,r)})).next((()=>n))}sr(e,t){let n=xu(),r=new Ha(Bo.comparator);return this.ir(e,t,((e,t)=>{const i=this.nr(e,t);n=n.insert(e,i),r=r.insert(e,md(t))})).next((()=>({documents:n,_r:r})))}ir(e,t,n){if(t.isEmpty())return Zo.resolve();let r=new Ya(qd);t.forEach((e=>r=r.add(e)));const i=IDBKeyRange.bound(Vd(r.first()),Vd(r.last())),s=r.getIterator();let o=s.getNext();return Fd(e).Y({index:"documentKeyIndex",range:i},((e,t,r)=>{const i=Bo.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;o&&qd(o,i)<0;)n(o,null),o=s.getNext();o&&o.isEqual(i)&&(n(o,t),o=s.hasNext()?s.getNext():null),o?r.U(Vd(o)):r.done()})).next((()=>{for(;o;)n(o,null),o=s.hasNext()?s.getNext():null}))}getDocumentsMatchingQuery(e,t,n,r,i){const s=t.path,o=[s.popLast().toArray(),s.lastSegment(),El(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],a=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Fd(e).W(IDBKeyRange.bound(o,a,!0)).next((e=>{null==i||i.incrementDocumentReadCount(e.length);let n=xu();for(const i of e){const e=this.nr(Bo.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(Su(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n}))}getAllFromCollectionGroup(e,t,n,r){let i=xu();const s=Bd(t,n),o=Bd(t,Qo.max());return Fd(e).Y({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,o,!0)},((e,t,n)=>{const s=this.nr(Bo.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);i=i.insert(s.key,s),i.size===r&&n.done()})).next((()=>i))}newChangeBuffer(e){return new Md(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((e=>e.byteSize))}getMetadata(e){return Ud(e).get("remoteDocumentGlobalKey").next((e=>(yo(!!e),e)))}tr(e,t){return Ud(e).put("remoteDocumentGlobalKey",t)}nr(e,t){if(t){const e=function(e,t){let n;if(t.document)n=function(e,t,n){const r=el(e,t.name),i=Wh(t.updateTime),s=t.createTime?Wh(t.createTime):Lo.min(),o=new Rc({mapValue:{fields:t.fields}}),a=Pc.newFoundDocument(r,i,s,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}(e.ct,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=Bo.fromSegments(t.noDocument.path),r=Sl(t.noDocument.readTime);n=Pc.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return mo();{const e=Bo.fromSegments(t.unknownDocument.path),r=Sl(t.unknownDocument.version);n=Pc.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){const t=new Po(e[0],e[1]);return Lo.fromTimestamp(t)}(t.readTime)),n}(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(Lo.min()))return e}return Pc.newInvalidDocument(e)}}function Ld(e){return new Pd(e)}class Md extends Od{constructor(e,t){super(),this.ar=e,this.trackRemovals=t,this.ur=new Nu((e=>e.toString()),((e,t)=>e.isEqual(t)))}applyChanges(e){const t=[];let n=0,r=new Ya(((e,t)=>xo(e.canonicalString(),t.canonicalString())));return this.changes.forEach(((i,s)=>{const o=this.ur.get(i);if(t.push(this.ar.removeEntry(e,i,o.readTime)),s.isValidDocument()){const a=bl(this.ar.serializer,s);r=r.add(i.path.popLast());const c=md(a);n+=c-o.size,t.push(this.ar.addEntry(e,i,a))}else if(n-=o.size,this.trackRemovals){const n=bl(this.ar.serializer,s.convertToNoDocument(Lo.min()));t.push(this.ar.addEntry(e,i,n))}})),r.forEach((n=>{t.push(this.ar.indexManager.addToCollectionParentIndex(e,n))})),t.push(this.ar.updateMetadata(e,n)),Zo.waitFor(t)}getFromCache(e,t){return this.ar.rr(e,t).next((e=>(this.ur.set(t,{size:e.size,readTime:e.document.readTime}),e.document)))}getAllFromCache(e,t){return this.ar.sr(e,t).next((({documents:e,_r:t})=>(t.forEach(((t,n)=>{this.ur.set(t,{size:n,readTime:e.get(t).readTime})})),e)))}}function Ud(e){return za(e,"remoteDocumentGlobal")}function Fd(e){return za(e,"remoteDocumentsV14")}function Vd(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Bd(e,t){const n=t.documentKey.path.toArray();return[e,El(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function qd(e,t){const n=e.path.toArray(),r=t.path.toArray();let i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=xo(n[e],r[e]),i)return i;return i=xo(n.length,r.length),i||(i=xo(n[n.length-2],r[r.length-2]),i||xo(n[n.length-1],r[r.length-1]))}class jd{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class zd{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&hh(n.mutation,e,Za.empty(),Po.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,Bu()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=Bu()){const r=Lu();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=Ou();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=Lu();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,Bu())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=xu();const s=Uu(),o=Uu();return t.forEach(((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof ph)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),hh(o.mutation,t,o.mutation.getFieldMask(),Po.now())):s.set(t.key,Za.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>s.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new jd(t,null!==(n=s.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=Uu();let r=new Ha(((e,t)=>e-t)),i=Bu();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||Za.empty();o=i.applyToLocalView(s,o),n.set(e,o);const a=(r.get(i.batchId)||Bu()).add(e);r=r.insert(i.batchId,a)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=Mu();c.forEach((e=>{if(!i.has(e)){const r=ch(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}})),s.push(this.documentOverlayCache.saveOverlays(e,a,u))}return Zo.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return Bo.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):yu(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):Zo.resolve(Lu());let o=-1,a=i;return s.next((t=>Zo.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?Zo.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,a,t,Bu()))).next((e=>({batchId:o,changes:Pu(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Bo(t)).next((e=>{let t=Ou();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const i=t.collectionGroup;let s=Ou();return this.indexManager.getCollectionParents(e,i).next((o=>Zo.forEach(o,(o=>{const a=function(e,t){return new fu(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(i));return this.getDocumentsMatchingCollectionQuery(e,a,n,r).next((e=>{e.forEach(((e,t)=>{s=s.insert(e,t)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r)))).next((e=>{i.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,Pc.newInvalidDocument(r)))}));let n=Ou();return e.forEach(((e,r)=>{const s=i.get(e);void 0!==s&&hh(s.mutation,r,Za.empty(),Po.now()),Su(t,r)&&(n=n.insert(e,r))})),n}))}}class Kd{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return Zo.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:Wh(e.createTime)}}(t)),Zo.resolve()}getNamedQuery(e,t){return Zo.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,function(e){return{name:e.name,query:Nl(e.bundledQuery),readTime:Wh(e.readTime)}}(t)),Zo.resolve()}}class $d{constructor(){this.overlays=new Ha(Bo.comparator),this.hr=new Map}getOverlay(e,t){return Zo.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Lu();return Zo.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.ht(e,t,r)})),Zo.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.hr.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.hr.delete(n)),Zo.resolve()}getOverlaysForCollection(e,t,n){const r=Lu(),i=t.length+1,s=new Bo(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return Zo.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new Ha(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=Lu(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=Lu(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return Zo.resolve(o)}ht(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.hr.get(r.largestBatchId).delete(n.key);this.hr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new bh(t,n));let i=this.hr.get(t);void 0===i&&(i=Bu(),this.hr.set(t,i)),this.hr.set(t,i.add(n.key))}}class Gd{constructor(){this.Pr=new Ya(Hd.Ir),this.Tr=new Ya(Hd.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){const n=new Hd(e,t);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.Ar(new Hd(e,t))}Rr(e,t){e.forEach((e=>this.removeReference(e,t)))}Vr(e){const t=new Bo(new Uo([])),n=new Hd(t,e),r=new Hd(t,e+1),i=[];return this.Tr.forEachInRange([n,r],(e=>{this.Ar(e),i.push(e.key)})),i}mr(){this.Pr.forEach((e=>this.Ar(e)))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){const t=new Bo(new Uo([])),n=new Hd(t,e),r=new Hd(t,e+1);let i=Bu();return this.Tr.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new Hd(e,0),n=this.Pr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Hd{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return Bo.comparator(e.key,t.key)||xo(e.pr,t.pr)}static Er(e,t){return xo(e.pr,t.pr)||Bo.comparator(e.key,t.key)}}class Qd{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new Ya(Hd.Ir)}checkEmpty(e){return Zo.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new _h(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.wr=this.wr.add(new Hd(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return Zo.resolve(s)}lookupMutationBatch(e,t){return Zo.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.br(n),i=r<0?0:r;return Zo.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Zo.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(e){return Zo.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Hd(t,0),r=new Hd(t,Number.POSITIVE_INFINITY),i=[];return this.wr.forEachInRange([n,r],(e=>{const t=this.Sr(e.pr);i.push(t)})),Zo.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Ya(xo);return t.forEach((e=>{const t=new Hd(e,0),r=new Hd(e,Number.POSITIVE_INFINITY);this.wr.forEachInRange([t,r],(e=>{n=n.add(e.pr)}))})),Zo.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;Bo.isDocumentKey(i)||(i=i.child(""));const s=new Hd(new Bo(i),0);let o=new Ya(xo);return this.wr.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.pr)),!0)}),s),Zo.resolve(this.Dr(o))}Dr(e){const t=[];return e.forEach((e=>{const n=this.Sr(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){yo(0===this.Cr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.wr;return Zo.forEach(t.mutations,(r=>{const i=new Hd(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.wr=n}))}Mn(e){}containsKey(e,t){const n=new Hd(t,0),r=this.wr.firstAfterOrEqual(n);return Zo.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,Zo.resolve()}Cr(e,t){return this.br(e)}br(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Sr(e){const t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Wd{constructor(e){this.vr=e,this.docs=new Ha(Bo.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.vr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Zo.resolve(n?n.document.mutableCopy():Pc.newInvalidDocument(t))}getEntries(e,t){let n=xu();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Pc.newInvalidDocument(e))})),Zo.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=xu();const s=t.path,o=new Bo(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||Wo(Ho(o),n)<=0||(r.has(o.key)||Su(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return Zo.resolve(i)}getAllFromCollectionGroup(e,t,n,r){mo()}Fr(e,t){return Zo.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new Yd(this)}getSize(e){return Zo.resolve(this.size)}}class Yd extends Od{constructor(e){super(),this.ar=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.ar.addEntry(e,r)):this.ar.removeEntry(n)})),Zo.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}}class Jd{constructor(e){this.persistence=e,this.Mr=new Nu((e=>au(e)),cu),this.lastRemoteSnapshotVersion=Lo.min(),this.highestTargetId=0,this.Or=0,this.Nr=new Gd,this.targetCount=0,this.Br=bd.Nn()}forEachTarget(e,t){return this.Mr.forEach(((e,n)=>t(n))),Zo.resolve()}getLastRemoteSnapshotVersion(e){return Zo.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Zo.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Br.next(),Zo.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Or&&(this.Or=t),Zo.resolve()}qn(e){this.Mr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Br=new bd(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,Zo.resolve()}updateTargetData(e,t){return this.qn(t),Zo.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,Zo.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Mr.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Mr.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),Zo.waitFor(i).next((()=>r))}getTargetCount(e){return Zo.resolve(this.targetCount)}getTargetData(e,t){const n=this.Mr.get(t)||null;return Zo.resolve(n)}addMatchingKeys(e,t,n){return this.Nr.dr(t,n),Zo.resolve()}removeMatchingKeys(e,t,n){this.Nr.Rr(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),Zo.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),Zo.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Nr.gr(t);return Zo.resolve(n)}containsKey(e,t){return Zo.resolve(this.Nr.containsKey(t))}}class Xd{constructor(e,t){this.Lr={},this.overlays={},this.kr=new la(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new Jd(this),this.indexManager=new id,this.remoteDocumentCache=function(e){return new Wd(e)}((e=>this.referenceDelegate.Kr(e))),this.serializer=new Il(t),this.$r=new Kd(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new $d,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Lr[e.toKey()];return n||(n=new Qd(t,this.referenceDelegate),this.Lr[e.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,n){lo("MemoryPersistence","Starting transaction:",e);const r=new Zd(this.kr.next());return this.referenceDelegate.Ur(),n(r).next((e=>this.referenceDelegate.Wr(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Gr(e,t){return Zo.or(Object.values(this.Lr).map((n=>()=>n.containsKey(e,t))))}}class Zd extends Jo{constructor(e){super(),this.currentSequenceNumber=e}}class ef{constructor(e){this.persistence=e,this.zr=new Gd,this.jr=null}static Hr(e){return new ef(e)}get Jr(){if(this.jr)return this.jr;throw mo()}addReference(e,t,n){return this.zr.addReference(n,t),this.Jr.delete(n.toString()),Zo.resolve()}removeReference(e,t,n){return this.zr.removeReference(n,t),this.Jr.add(n.toString()),Zo.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),Zo.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach((e=>this.Jr.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Jr.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Ur(){this.jr=new Set}Wr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Zo.forEach(this.Jr,(n=>{const r=Bo.fromPath(n);return this.Yr(e,r).next((e=>{e||t.removeEntry(r,Lo.min())}))})).next((()=>(this.jr=null,t.apply(e))))}updateLimboDocument(e,t){return this.Yr(e,t).next((e=>{e?this.Jr.delete(t.toString()):this.Jr.add(t.toString())}))}Kr(e){return 0}Yr(e,t){return Zo.or([()=>Zo.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}}class tf{constructor(e){this.serializer=e}N(e,t,n,r){const i=new ea("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore("owner")}(e),function(e){e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",wa,{unique:!0}),e.createObjectStore("documentMutations")}(e),nf(e),function(e){e.createObjectStore("remoteDocuments")}(e));let s=Zo.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal")}(e),nf(e)),s=s.next((()=>function(e){const t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Lo.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)}(i)))),n<4&&r>=4&&(0!==n&&(s=s.next((()=>function(e,t){return t.store("mutations").W().next((n=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",wa,{unique:!0});const r=t.store("mutations"),i=n.map((e=>r.put(e)));return Zo.waitFor(i)}))}(e,i)))),s=s.next((()=>{!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)}))),n<5&&r>=5&&(s=s.next((()=>this.Xr(i)))),n<6&&r>=6&&(s=s.next((()=>(function(e){e.createObjectStore("remoteDocumentGlobal")}(e),this.ei(i))))),n<7&&r>=7&&(s=s.next((()=>this.ti(i)))),n<8&&r>=8&&(s=s.next((()=>this.ni(e,i)))),n<9&&r>=9&&(s=s.next((()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)}))),n<10&&r>=10&&(s=s.next((()=>this.ri(i)))),n<11&&r>=11&&(s=s.next((()=>{!function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})}(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)}))),n<12&&r>=12&&(s=s.next((()=>{!function(e){const t=e.createObjectStore("documentOverlays",{keyPath:Pa});t.createIndex("collectionPathOverlayIndex",La,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",Ma,{unique:!1})}(e)}))),n<13&&r>=13&&(s=s.next((()=>function(e){const t=e.createObjectStore("remoteDocumentsV14",{keyPath:Ea});t.createIndex("documentKeyIndex",Ta),t.createIndex("collectionGroupIndex",Sa)}(e))).next((()=>this.ii(e,i))).next((()=>e.deleteObjectStore("remoteDocuments")))),n<14&&r>=14&&(s=s.next((()=>this.si(e,i)))),n<15&&r>=15&&(s=s.next((()=>function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:Da}).createIndex("sequenceNumberIndex",xa,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:Ra}).createIndex("documentKeyIndex",Oa,{unique:!1})}(e)))),s}ei(e){let t=0;return e.store("remoteDocuments").Y(((e,n)=>{t+=md(n)})).next((()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}Xr(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.W().next((t=>Zo.forEach(t,(t=>{const r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.W("userMutationsIndex",r).next((n=>Zo.forEach(n,(n=>{yo(n.userId===t.userId);const r=Cl(this.serializer,n);return gd(e,t.userId,r).next((()=>{}))}))))}))))}ti(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next((e=>{const r=[];return n.Y(((n,i)=>{const s=new Uo(n),o=function(e){return[0,ga(e)]}(s);r.push(t.get(o).next((n=>n?Zo.resolve():(n=>t.put({targetId:0,path:ga(n),sequenceNumber:e.highestListenSequenceNumber}))(s))))})).next((()=>Zo.waitFor(r)))}))}ni(e,t){e.createObjectStore("collectionParents",{keyPath:Na});const n=t.store("collectionParents"),r=new sd,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:ga(r)})}};return t.store("remoteDocuments").Y({J:!0},((e,t)=>{const n=new Uo(e);return i(n.popLast())})).next((()=>t.store("documentMutations").Y({J:!0},(([e,t,n],r)=>{const s=va(t);return i(s.popLast())}))))}ri(e){const t=e.store("targets");return t.Y(((e,n)=>{const r=Al(n),i=kl(this.serializer,r);return t.put(i)}))}ii(e,t){const n=t.store("remoteDocuments"),r=[];return n.Y(((e,n)=>{const i=t.store("remoteDocumentsV14"),s=function(e){return e.document?new Bo(Uo.fromString(e.document.name).popFirst(5)):e.noDocument?Bo.fromSegments(e.noDocument.path):e.unknownDocument?Bo.fromSegments(e.unknownDocument.path):mo()}(n).path.toArray(),o={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(o))})).next((()=>Zo.waitFor(r)))}si(e,t){const n=t.store("mutations"),r=Ld(this.serializer),i=new Xd(ef.Hr,this.serializer.ct);return n.W().next((e=>{const n=new Map;return e.forEach((e=>{var t;let r=null!==(t=n.get(e.userId))&&void 0!==t?t:Bu();Cl(this.serializer,e).keys().forEach((e=>r=r.add(e))),n.set(e.userId,r)})),Zo.forEach(n,((e,n)=>{const s=new ao(n),o=Ml.lt(this.serializer,s),a=i.getIndexManager(s),c=yd.lt(s,this.serializer,a,i.referenceDelegate);return new zd(r,c,o,a).recalculateAndSaveOverlaysForDocumentKeys(new ja(t,la._e),e).next()}))}))}}function nf(e){e.createObjectStore("targetDocuments",{keyPath:Aa}).createIndex("documentTargetsIndex",ka,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Ca,{unique:!0}),e.createObjectStore("targetGlobal")}const rf="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class sf{constructor(e,t,n,r,i,s,o,a,c,u,h=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.oi=i,this.window=s,this.document=o,this._i=c,this.ai=u,this.ui=h,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=Number.NEGATIVE_INFINITY,this.Ii=e=>Promise.resolve(),!sf.D())throw new _o(wo.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new xd(this,r),this.Ti=t+"main",this.serializer=new Il(a),this.Ei=new ta(this.Ti,this.ui,new tf(this.serializer)),this.Qr=new Ed(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Ld(this.serializer),this.$r=new Ol,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,!1===u&&fo("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new _o(wo.FAILED_PRECONDITION,rf);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Qr.getHighestSequenceNumber(e)))})).then((e=>{this.kr=new la(e,this._i)})).then((()=>{this.qr=!0})).catch((e=>(this.Ei&&this.Ei.close(),Promise.reject(e))))}fi(e){return this.Ii=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ei.L((async t=>{null===t.newVersion&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.oi.enqueueAndForget((async()=>{this.started&&await this.Ai()})))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>af(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.gi(e).next((e=>{e||(this.isPrimary=!1,this.oi.enqueueRetryable((()=>this.Ii(!1))))}))})).next((()=>this.pi(e))).next((t=>this.isPrimary&&!t?this.yi(e).next((()=>!1)):!!t&&this.wi(e).next((()=>!0)))))).catch((e=>{if(ia(e))return lo("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return lo("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.oi.enqueueRetryable((()=>this.Ii(e))),this.isPrimary=e}))}gi(e){return of(e).get("owner").next((e=>Zo.resolve(this.Si(e))))}bi(e){return af(e).delete(this.clientId)}async Di(){if(this.isPrimary&&!this.Ci(this.Pi,18e5)){this.Pi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const t=za(e,"clientMetadata");return t.W().next((e=>{const n=this.vi(e,18e5),r=e.filter((e=>-1===n.indexOf(e)));return Zo.forEach(r,(e=>t.delete(e.clientId))).next((()=>r))}))})).catch((()=>[]));if(this.di)for(const t of e)this.di.removeItem(this.Fi(t.clientId))}}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Ai().then((()=>this.Di())).then((()=>this.mi()))))}Si(e){return!!e&&e.ownerId===this.clientId}pi(e){return this.ai?Zo.resolve(!0):of(e).get("owner").next((t=>{if(null!==t&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)){if(this.Si(t)&&this.networkEnabled)return!0;if(!this.Si(t)){if(!t.allowTabSynchronization)throw new _o(wo.FAILED_PRECONDITION,rf);return!1}}return!(!this.networkEnabled||!this.inForeground)||af(e).W().next((e=>void 0===this.vi(e,5e3).find((e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))))})).next((e=>(this.isPrimary!==e&&lo("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e)))}async shutdown(){this.qr=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Oi(),this.Ni(),await this.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(e=>{const t=new ja(e,la._e);return this.yi(t).next((()=>this.bi(t)))})),this.Ei.close(),this.Bi()}vi(e,t){return e.filter((e=>this.Ci(e.updateTimeMs,t)&&!this.Mi(e.clientId)))}Li(){return this.runTransaction("getActiveClients","readonly",(e=>af(e).W().next((e=>this.vi(e,18e5).map((e=>e.clientId))))))}get started(){return this.qr}getMutationQueue(e,t){return yd.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new ad(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Ml.lt(this.serializer,e)}getBundleCache(){return this.$r}runTransaction(e,t,n){lo("IndexedDbPersistence","Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",i=function(e){return 15===e?qa:14===e?Ba:13===e?Va:12===e?Fa:11===e?Ua:void mo()}(this.ui);let s;return this.Ei.runTransaction(e,r,i,(r=>(s=new ja(r,this.kr?this.kr.next():la._e),"readwrite-primary"===t?this.gi(s).next((e=>!!e||this.pi(s))).next((t=>{if(!t)throw fo(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.oi.enqueueRetryable((()=>this.Ii(!1))),new _o(wo.FAILED_PRECONDITION,Yo);return n(s)})).next((e=>this.wi(s).next((()=>e)))):this.ki(s).next((()=>n(s)))))).then((e=>(s.raiseOnCommittedEvent(),e)))}ki(e){return of(e).get("owner").next((e=>{if(null!==e&&this.Ci(e.leaseTimestampMs,5e3)&&!this.Mi(e.ownerId)&&!this.Si(e)&&!(this.ai||this.allowTabSynchronization&&e.allowTabSynchronization))throw new _o(wo.FAILED_PRECONDITION,rf)}))}wi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return of(e).put("owner",t)}static D(){return ta.D()}yi(e){const t=of(e);return t.get("owner").next((e=>this.Si(e)?(lo("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):Zo.resolve()))}Ci(e,t){const n=Date.now();return!(e<n-t||e>n&&(fo(`Detected an update time that is in the future: ${e} > ${n}`),1))}Ri(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.li=()=>{this.oi.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.Ai())))},this.document.addEventListener("visibilitychange",this.li),this.inForeground="visible"===this.document.visibilityState)}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ci=()=>{this.xi();const e=/(?:Version|Mobile)\/1[456]/;h()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(e){var t;try{const n=null!==(null===(t=this.di)||void 0===t?void 0:t.getItem(this.Fi(e)));return lo("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return fo("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(e){fo("Failed to set zombie client id.",e)}}Bi(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch(e){}}Fi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function of(e){return za(e,"owner")}function af(e){return za(e,"clientMetadata")}function cf(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class uf{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.qi=n,this.Qi=r}static Ki(e,t){let n=Bu(),r=Bu();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new uf(e,t.fromCache,n,r)}}class hf{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class lf{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=h()?8:ta.v(u())>0?6:4}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,n,r){const i={result:null};return this.ji(e,t).next((e=>{i.result=e})).next((()=>{if(!i.result)return this.Hi(e,t,r,n).next((e=>{i.result=e}))})).next((()=>{if(i.result)return;const n=new hf;return this.Ji(e,t,n).next((r=>{if(i.result=r,this.Ui)return this.Yi(e,t,n,r.size)}))})).next((()=>i.result))}Yi(e,t,n,r){return n.documentReadCount<this.Wi?(ho()<=A.DEBUG&&lo("QueryEngine","SDK will not create cache indexes for query:",Tu(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),Zo.resolve()):(ho()<=A.DEBUG&&lo("QueryEngine","Query:",Tu(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Gi*r?(ho()<=A.DEBUG&&lo("QueryEngine","The SDK decides to create cache indexes for query:",Tu(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,wu(t))):Zo.resolve())}ji(e,t){if(mu(t))return Zo.resolve(null);let n=wu(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=Iu(t,null,"F"),n=wu(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const i=Bu(...r);return this.zi.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const s=this.Zi(t,r);return this.Xi(t,s,i,n.readTime)?this.ji(e,Iu(t,null,"F")):this.es(e,s,t,n)}))))})))))}Hi(e,t,n,r){return mu(t)||r.isEqual(Lo.min())?Zo.resolve(null):this.zi.getDocuments(e,n).next((i=>{const s=this.Zi(t,i);return this.Xi(t,s,n,r)?Zo.resolve(null):(ho()<=A.DEBUG&&lo("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Tu(t)),this.es(e,s,t,Go(r,-1)).next((e=>e)))}))}Zi(e,t){let n=new Ya(Au(e));return t.forEach(((t,r)=>{Su(e,r)&&(n=n.add(r))})),n}Xi(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ji(e,t,n){return ho()<=A.DEBUG&&lo("QueryEngine","Using full collection scan to execute query:",Tu(t)),this.zi.getDocumentsMatchingQuery(e,t,Qo.min(),n)}es(e,t,n,r){return this.zi.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class df{constructor(e,t,n,r){this.persistence=e,this.ts=t,this.serializer=r,this.ns=new Ha(xo),this.rs=new Nu((e=>au(e)),cu),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(n)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new zd(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.ns)))}}function ff(e,t,n,r){return new df(e,t,n,r)}async function pf(e,t){const n=vo(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n._s(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],s=[];let o=Bu();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({us:e,removedBatchIds:i,addedBatchIds:s})))}))}))}function gf(e){const t=vo(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Qr.getLastRemoteSnapshotVersion(e)))}function mf(e,t){const n=vo(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}function yf(e,t){const n=vo(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Qr.getTargetData(e,t).next((i=>i?(r=i,Zo.resolve(r)):n.Qr.allocateTargetId(e).next((i=>(r=new _l(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Qr.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.ns.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.ns=n.ns.insert(e.targetId,e),n.rs.set(t,e.targetId)),e}))}async function vf(e,t,n){const r=vo(e),i=r.ns.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!ia(e))throw e;lo("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.ns=r.ns.remove(t),r.rs.delete(i.target)}function wf(e,t,n){const r=vo(e);let i=Lo.min(),s=Bu();return r.persistence.runTransaction("Execute query","readwrite",(e=>function(e,t,n){const r=vo(e),i=r.rs.get(n);return void 0!==i?Zo.resolve(r.ns.get(i)):r.Qr.getTargetData(t,n)}(r,e,wu(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>r.ts.getDocumentsMatchingQuery(e,t,n?i:Lo.min(),n?s:Bu()))).next((e=>(bf(r,Cu(t),e),{documents:e,hs:s})))))}function _f(e,t){const n=vo(e),r=vo(n.Qr),i=n.ns.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(e=>r._t(e,t).next((e=>e?e.target:null))))}function If(e,t){const n=vo(e),r=n.ss.get(t)||Lo.min();return n.persistence.runTransaction("Get new document changes","readonly",(e=>n.os.getAllFromCollectionGroup(e,t,Go(r,-1),Number.MAX_SAFE_INTEGER))).then((e=>(bf(n,t,e),e)))}function bf(e,t,n){let r=e.ss.get(t)||Lo.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.ss.set(t,r)}function Ef(e,t){return`firestore_clients_${e}_${t}`}function Tf(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function Sf(e,t){return`firestore_targets_${e}_${t}`}class Cf{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Es(e,t,n){const r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new _o(r.error.code,r.error.message))),s?new Cf(e,t,r.state,i):(fo("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}ds(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Af{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Es(e,t){const n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new _o(n.error.code,n.error.message))),i?new Af(e,n.state,r):(fo("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}ds(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class kf{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Es(e,t){const n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=ju();for(let e=0;r&&e<n.activeTargetIds.length;++e)r=pa(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new kf(e,i):(fo("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Nf{constructor(e,t){this.clientId=e,this.onlineState=t}static Es(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Nf(t.clientId,t.onlineState):(fo("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Df{constructor(){this.activeTargetIds=ju()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class xf{constructor(e,t,n,r,i){this.window=e,this.oi=t,this.persistenceKey=n,this.Vs=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new Ha(xo),this.started=!1,this.ys=[];const s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.ws=Ef(this.persistenceKey,this.Vs),this.Ss=function(e){return`firestore_sequence_number_${e}`}(this.persistenceKey),this.ps=this.ps.insert(this.Vs,new Df),this.bs=new RegExp(`^firestore_clients_${s}_([^_]*)$`),this.Ds=new RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this.Cs=new RegExp(`^firestore_targets_${s}_(\\d+)$`),this.vs=function(e){return`firestore_online_state_${e}`}(this.persistenceKey),this.Fs=function(e){return`firestore_bundle_loaded_v2_${e}`}(this.persistenceKey),this.window.addEventListener("storage",this.fs)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Li();for(const t of e){if(t===this.Vs)continue;const e=this.getItem(Ef(this.persistenceKey,t));if(e){const n=kf.Es(t,e);n&&(this.ps=this.ps.insert(n.clientId,n))}}this.Ms();const t=this.storage.getItem(this.vs);if(t){const e=this.xs(t);e&&this.Os(e)}for(const e of this.ys)this.gs(e);this.ys=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ss,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ns(this.ps)}isActiveQueryTarget(e){let t=!1;return this.ps.forEach(((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.Bs(e,"pending")}updateMutationState(e,t,n){this.Bs(e,t,n),this.Ls(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem(Sf(this.persistenceKey,e));if(n){const r=Af.Es(e,n);r&&(t=r.state)}}return this.ks.As(e),this.Ms(),t}removeLocalQueryTarget(e){this.ks.Rs(e),this.Ms()}isLocalQueryTarget(e){return this.ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Sf(this.persistenceKey,e))}updateQueryState(e,t,n){this.qs(e,t,n)}handleUserChange(e,t,n){t.forEach((e=>{this.Ls(e)})),this.currentUser=e,n.forEach((e=>{this.addPendingMutation(e)}))}setOnlineState(e){this.Qs(e)}notifyBundleLoaded(e){this.Ks(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return lo("SharedClientState","READ",e,t),t}setItem(e,t){lo("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){lo("SharedClientState","REMOVE",e),this.storage.removeItem(e)}gs(e){const t=e;if(t.storageArea===this.storage){if(lo("SharedClientState","EVENT",t.key,t.newValue),t.key===this.ws)return void fo("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable((async()=>{if(this.started){if(null!==t.key)if(this.bs.test(t.key)){if(null==t.newValue){const e=this.$s(t.key);return this.Us(e,null)}{const e=this.Ws(t.key,t.newValue);if(e)return this.Us(e.clientId,e)}}else if(this.Ds.test(t.key)){if(null!==t.newValue){const e=this.Gs(t.key,t.newValue);if(e)return this.zs(e)}}else if(this.Cs.test(t.key)){if(null!==t.newValue){const e=this.js(t.key,t.newValue);if(e)return this.Hs(e)}}else if(t.key===this.vs){if(null!==t.newValue){const e=this.xs(t.newValue);if(e)return this.Os(e)}}else if(t.key===this.Ss){const e=function(e){let t=la._e;if(null!=e)try{const n=JSON.parse(e);yo("number"==typeof n),t=n}catch(e){fo("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(t.newValue);e!==la._e&&this.sequenceNumberHandler(e)}else if(t.key===this.Fs){const e=this.Js(t.newValue);await Promise.all(e.map((e=>this.syncEngine.Ys(e))))}}else this.ys.push(t)}))}}get ks(){return this.ps.get(this.Vs)}Ms(){this.setItem(this.ws,this.ks.ds())}Bs(e,t,n){const r=new Cf(this.currentUser,e,t,n),i=Tf(this.persistenceKey,this.currentUser,e);this.setItem(i,r.ds())}Ls(e){const t=Tf(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Qs(e){const t={clientId:this.Vs,onlineState:e};this.storage.setItem(this.vs,JSON.stringify(t))}qs(e,t,n){const r=Sf(this.persistenceKey,e),i=new Af(e,t,n);this.setItem(r,i.ds())}Ks(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Fs,t)}$s(e){const t=this.bs.exec(e);return t?t[1]:null}Ws(e,t){const n=this.$s(e);return kf.Es(n,t)}Gs(e,t){const n=this.Ds.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Cf.Es(new ao(i),r,t)}js(e,t){const n=this.Cs.exec(e),r=Number(n[1]);return Af.Es(r,t)}xs(e){return Nf.Es(e)}Js(e){return JSON.parse(e)}async zs(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Zs(e.batchId,e.state,e.error);lo("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Hs(e){return this.syncEngine.Xs(e.targetId,e.state,e.error)}Us(e,t){const n=t?this.ps.insert(e,t):this.ps.remove(e),r=this.Ns(this.ps),i=this.Ns(n),s=[],o=[];return i.forEach((e=>{r.has(e)||s.push(e)})),r.forEach((e=>{i.has(e)||o.push(e)})),this.syncEngine.eo(s,o).then((()=>{this.ps=n}))}Os(e){this.ps.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ns(e){let t=ju();return e.forEach(((e,n)=>{t=t.unionWith(n.activeTargetIds)})),t}}class Rf{constructor(){this.no=new Df,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,n){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new Df,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Of{io(e){}shutdown(){}}class Pf{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){lo("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.uo)e(0)}ao(){lo("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.uo)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Lf=null;function Mf(){return null===Lf?Lf=268435456+Math.round(2147483648*Math.random()):Lf++,"0x"+Lf.toString(16)}const Uf={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Ff{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}onMessage(e){this.Ao=e}close(){this.ho()}send(e){this.lo(e)}Ro(){this.Io()}Vo(e){this.Eo(e)}mo(e){this.Ao(e)}}const Vf="WebChannelConnection";class Bf extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.fo=t+"://"+e.host,this.po=`projects/${n}/databases/${r}`,this.yo="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get wo(){return!1}So(e,t,n,r,i){const s=Mf(),o=this.bo(e,t.toUriEncodedString());lo("RestConnection",`Sending RPC '${e}' ${s}:`,o,n);const a={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(a,r,i),this.Co(e,o,a,n).then((t=>(lo("RestConnection",`Received RPC '${e}' ${s}: `,t),t)),(t=>{throw po("RestConnection",`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t}))}vo(e,t,n,r,i,s){return this.So(e,t,n,r,i)}Do(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+co,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}bo(e,t){const n=Uf[e];return`${this.fo}/v1/${t}:${n}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Co(e,t,n,r){const i=Mf();return new Promise(((s,o)=>{const a=new ro;a.setWithCredentials(!0),a.listenOnce(eo.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case Zs.NO_ERROR:const t=a.getResponseJson();lo(Vf,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case Zs.TIMEOUT:lo(Vf,`RPC '${e}' ${i} timed out`),o(new _o(wo.DEADLINE_EXCEEDED,"Request time out"));break;case Zs.HTTP_ERROR:const n=a.getStatus();if(lo(Vf,`RPC '${e}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(wo).indexOf(t)>=0?t:wo.UNKNOWN}(t.status);o(new _o(e,t.message))}else o(new _o(wo.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new _o(wo.UNAVAILABLE,"Connection failed."));break;default:mo()}}finally{lo(Vf,`RPC '${e}' ${i} completed.`)}}));const c=JSON.stringify(r);lo(Vf,`RPC '${e}' ${i} sending request:`,r),a.send(t,"POST",c,n,15)}))}Fo(e,t,n){const r=Mf(),i=[this.fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=new Ns,o=Ar(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Do(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const u=i.join("");lo(Vf,`Creating RPC '${e}' stream ${r}: ${u}`,a);const h=s.createWebChannel(u,a);let l=!1,d=!1;const f=new Ff({lo:t=>{d?lo(Vf,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(l||(lo(Vf,`Opening RPC '${e}' stream ${r} transport.`),h.open(),l=!0),lo(Vf,`RPC '${e}' stream ${r} sending:`,t),h.send(t))},ho:()=>h.close()}),p=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return p(h,no.EventType.OPEN,(()=>{d||lo(Vf,`RPC '${e}' stream ${r} transport opened.`)})),p(h,no.EventType.CLOSE,(()=>{d||(d=!0,lo(Vf,`RPC '${e}' stream ${r} transport closed`),f.Vo())})),p(h,no.EventType.ERROR,(t=>{d||(d=!0,po(Vf,`RPC '${e}' stream ${r} transport errored:`,t),f.Vo(new _o(wo.UNAVAILABLE,"The operation could not be completed")))})),p(h,no.EventType.MESSAGE,(t=>{var n;if(!d){const i=t.data[0];yo(!!i);const s=i,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){lo(Vf,`RPC '${e}' stream ${r} received error:`,o);const t=o.status;let n=function(e){const t=Th[e];if(void 0!==t)return Ch(t)}(t),i=o.message;void 0===n&&(n=wo.INTERNAL,i="Unknown error status: "+t+" with message "+o.message),d=!0,f.Vo(new _o(n,i)),h.close()}else lo(Vf,`RPC '${e}' stream ${r} received:`,i),f.mo(i)}})),p(o,to.STAT_EVENT,(t=>{10===t.stat?lo(Vf,`RPC '${e}' stream ${r} detected buffering proxy`):11===t.stat&&lo(Vf,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.Ro()}),0),f}}function qf(){return"undefined"!=typeof window?window:null}function jf(){return"undefined"!=typeof document?document:null}function zf(e){return new Kh(e,!0)}class Kf{constructor(e,t,n=1e3,r=1.5,i=6e4){this.oi=e,this.timerId=t,this.Mo=n,this.xo=r,this.Oo=i,this.No=0,this.Bo=null,this.Lo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(e){this.cancel();const t=Math.floor(this.No+this.Qo()),n=Math.max(0,Date.now()-this.Lo),r=Math.max(0,t-n);r>0&&lo("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.No} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Bo=this.oi.enqueueAfterDelay(this.timerId,r,(()=>(this.Lo=Date.now(),e()))),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){null!==this.Bo&&(this.Bo.skipDelay(),this.Bo=null)}cancel(){null!==this.Bo&&(this.Bo.cancel(),this.Bo=null)}Qo(){return(Math.random()-.5)*this.No}}class $f{constructor(e,t,n,r,i,s,o,a){this.oi=e,this.$o=n,this.Uo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new Kf(e,t)}Ho(){return 1===this.state||5===this.state||this.Jo()}Jo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Yo()}async stop(){this.Ho()&&await this.close(0)}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&null===this.Go&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,(()=>this.e_())))}t_(e){this.n_(),this.stream.send(e)}async e_(){if(this.Jo())return this.close(0)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}async close(e,t){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,4!==e?this.jo.reset():t&&t.code===wo.RESOURCE_EXHAUSTED?(fo(t.toString()),fo("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):t&&t.code===wo.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.i_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.To(t)}i_(){}auth(){this.state=1;const e=this.s_(this.Wo),t=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.Wo===t&&this.o_(e,n)}),(t=>{e((()=>{const e=new _o(wo.UNKNOWN,"Fetching auth token failed: "+t.message);return this.__(e)}))}))}o_(e,t){const n=this.s_(this.Wo);this.stream=this.a_(e,t),this.stream.Po((()=>{n((()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,(()=>(this.Jo()&&(this.state=3),Promise.resolve()))),this.listener.Po())))})),this.stream.To((e=>{n((()=>this.__(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}Yo(){this.state=5,this.jo.qo((async()=>{this.state=0,this.start()}))}__(e){return lo("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}s_(e){return t=>{this.oi.enqueueAndForget((()=>this.Wo===e?t():(lo("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Gf extends $f{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}a_(e,t){return this.connection.Fo("Listen",e,t)}onMessage(e){this.jo.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:mo()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.useProto3Json?(yo(void 0===t||"string"==typeof t),tc.fromBase64String(t||"")):(yo(void 0===t||t instanceof Uint8Array),tc.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?wo.UNKNOWN:Ch(e.code);return new _o(t,e.message||"")}(o);n=new Mh(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=el(e,r.document.name),s=Wh(r.document.updateTime),o=r.document.createTime?Wh(r.document.createTime):Lo.min(),a=new Rc({mapValue:{fields:r.document.fields}}),c=Pc.newFoundDocument(i,s,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];n=new Ph(u,h,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=el(e,r.document),s=r.readTime?Wh(r.readTime):Lo.min(),o=Pc.newNoDocument(i,s),a=r.removedTargetIds||[];n=new Ph([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=el(e,r.document),s=r.removedTargetIds||[];n=new Ph([],s,i,null)}else{if(!("filter"in t))return mo();{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,s=new Eh(r,i),o=e.targetId;n=new Lh(o,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return Lo.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?Lo.min():t.readTime?Wh(t.readTime):Lo.min()}(e);return this.listener.u_(t,n)}c_(e){const t={};t.database=rl(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=uu(r)?{documents:cl(e,r)}:{query:ul(e,r).ut},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Hh(e,t.resumeToken);const r=$h(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(Lo.min())>0){n.readTime=Gh(e,t.snapshotVersion.toTimestamp());const r=$h(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return mo()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.t_(t)}l_(e){const t={};t.database=rl(this.serializer),t.removeTarget=e,this.t_(t)}}class Hf extends $f{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(e,t){return this.connection.Fo("Write",e,t)}onMessage(e){if(yo(!!e.streamToken),this.lastStreamToken=e.streamToken,this.h_){this.jo.reset();const t=function(e,t){return e&&e.length>0?(yo(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?Wh(e.updateTime):Wh(t);return n.isEqual(Lo.min())&&(n=Wh(t)),new ih(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=Wh(e.commitTime);return this.listener.T_(n,t)}return yo(!e.writeResults||0===e.writeResults.length),this.h_=!0,this.listener.E_()}d_(){const e={};e.database=rl(this.serializer),this.t_(e)}I_(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>ol(this.serializer,e)))};this.t_(t)}}class Qf extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.A_=!1}R_(){if(this.A_)throw new _o(wo.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,t,n,r){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.So(e,Jh(t,n),r,i,s))).catch((e=>{throw"FirebaseError"===e.name?(e.code===wo.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new _o(wo.UNKNOWN,e.toString())}))}vo(e,t,n,r,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,o])=>this.connection.vo(e,Jh(t,n),r,s,o,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===wo.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new _o(wo.UNKNOWN,e.toString())}))}terminate(){this.A_=!0,this.connection.terminate()}}class Wf{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){0===this.m_&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve()))))}S_(e){"Online"===this.state?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.y_("Offline")))}set(e){this.b_(),this.m_=0,"Online"===e&&(this.g_=!1),this.y_(e)}y_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}w_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(fo(t),this.g_=!1):lo("OnlineStateTracker",t)}b_(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}}class Yf{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=i,this.M_.io((e=>{n.enqueueAndForget((async()=>{sp(this)&&(lo("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=vo(e);t.v_.add(4),await Xf(t),t.x_.set("Unknown"),t.v_.delete(4),await Jf(t)}(this))}))})),this.x_=new Wf(n,r)}}async function Jf(e){if(sp(e))for(const t of e.F_)await t(!0)}async function Xf(e){for(const t of e.F_)await t(!1)}function Zf(e,t){const n=vo(e);n.C_.has(t.targetId)||(n.C_.set(t.targetId,t),ip(n)?rp(n):Ep(n).Jo()&&tp(n,t))}function ep(e,t){const n=vo(e),r=Ep(n);n.C_.delete(t),r.Jo()&&np(n,t),0===n.C_.size&&(r.Jo()?r.Xo():sp(n)&&n.x_.set("Unknown"))}function tp(e,t){if(e.O_.Oe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Lo.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}Ep(e).c_(t)}function np(e,t){e.O_.Oe(t),Ep(e).l_(t)}function rp(e){e.O_=new Fh({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),_t:t=>e.C_.get(t)||null,nt:()=>e.datastore.serializer.databaseId}),Ep(e).start(),e.x_.p_()}function ip(e){return sp(e)&&!Ep(e).Ho()&&e.C_.size>0}function sp(e){return 0===vo(e).v_.size}function op(e){e.O_=void 0}async function ap(e){e.C_.forEach(((t,n)=>{tp(e,t)}))}async function cp(e,t){op(e),ip(e)?(e.x_.S_(t),rp(e)):e.x_.set("Unknown")}async function up(e,t,n){if(e.x_.set("Online"),t instanceof Mh&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.C_.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.C_.delete(r),e.O_.removeTarget(r))}(e,t)}catch(n){lo("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await hp(e,n)}else if(t instanceof Ph?e.O_.$e(t):t instanceof Lh?e.O_.Je(t):e.O_.Ge(t),!n.isEqual(Lo.min()))try{const t=await gf(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.O_.it(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.C_.get(r);i&&e.C_.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const r=e.C_.get(t);if(!r)return;e.C_.set(t,r.withResumeToken(tc.EMPTY_BYTE_STRING,r.snapshotVersion)),np(e,t);const i=new _l(r.target,t,n,r.sequenceNumber);tp(e,i)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){lo("RemoteStore","Failed to raise snapshot:",t),await hp(e,t)}}async function hp(e,t,n){if(!ia(t))throw t;e.v_.add(1),await Xf(e),e.x_.set("Offline"),n||(n=()=>gf(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{lo("RemoteStore","Retrying IndexedDB access"),await n(),e.v_.delete(1),await Jf(e)}))}function lp(e,t){return t().catch((n=>hp(e,n,t)))}async function dp(e){const t=vo(e),n=Tp(t);let r=t.D_.length>0?t.D_[t.D_.length-1].batchId:-1;for(;fp(t);)try{const e=await mf(t.localStore,r);if(null===e){0===t.D_.length&&n.Xo();break}r=e.batchId,pp(t,e)}catch(e){await hp(t,e)}gp(t)&&mp(t)}function fp(e){return sp(e)&&e.D_.length<10}function pp(e,t){e.D_.push(t);const n=Tp(e);n.Jo()&&n.P_&&n.I_(t.mutations)}function gp(e){return sp(e)&&!Tp(e).Ho()&&e.D_.length>0}function mp(e){Tp(e).start()}async function yp(e){Tp(e).d_()}async function vp(e){const t=Tp(e);for(const n of e.D_)t.I_(n.mutations)}async function wp(e,t,n){const r=e.D_.shift(),i=Ih.from(r,t,n);await lp(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await dp(e)}async function _p(e,t){t&&Tp(e).P_&&await async function(e,t){if(function(e){return function(e){switch(e){default:return mo();case wo.CANCELLED:case wo.UNKNOWN:case wo.DEADLINE_EXCEEDED:case wo.RESOURCE_EXHAUSTED:case wo.INTERNAL:case wo.UNAVAILABLE:case wo.UNAUTHENTICATED:return!1;case wo.INVALID_ARGUMENT:case wo.NOT_FOUND:case wo.ALREADY_EXISTS:case wo.PERMISSION_DENIED:case wo.FAILED_PRECONDITION:case wo.ABORTED:case wo.OUT_OF_RANGE:case wo.UNIMPLEMENTED:case wo.DATA_LOSS:return!0}}(e)&&e!==wo.ABORTED}(t.code)){const n=e.D_.shift();Tp(e).Zo(),await lp(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await dp(e)}}(e,t),gp(e)&&mp(e)}async function Ip(e,t){const n=vo(e);n.asyncQueue.verifyOperationInProgress(),lo("RemoteStore","RemoteStore received new credentials");const r=sp(n);n.v_.add(3),await Xf(n),r&&n.x_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.v_.delete(3),await Jf(n)}async function bp(e,t){const n=vo(e);t?(n.v_.delete(2),await Jf(n)):t||(n.v_.add(2),await Xf(n),n.x_.set("Unknown"))}function Ep(e){return e.N_||(e.N_=function(e,t,n){const r=vo(e);return r.R_(),new Gf(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Po:ap.bind(null,e),To:cp.bind(null,e),u_:up.bind(null,e)}),e.F_.push((async t=>{t?(e.N_.Zo(),ip(e)?rp(e):e.x_.set("Unknown")):(await e.N_.stop(),op(e))}))),e.N_}function Tp(e){return e.B_||(e.B_=function(e,t,n){const r=vo(e);return r.R_(),new Hf(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Po:yp.bind(null,e),To:_p.bind(null,e),E_:vp.bind(null,e),T_:wp.bind(null,e)}),e.F_.push((async t=>{t?(e.B_.Zo(),await dp(e)):(await e.B_.stop(),e.D_.length>0&&(lo("RemoteStore",`Stopping write stream with ${e.D_.length} pending writes`),e.D_=[]))}))),e.B_}class Sp{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Io,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new Sp(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new _o(wo.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Cp(e,t){if(fo("AsyncQueue",`${t}: ${e}`),ia(e))return new _o(wo.UNAVAILABLE,`${t}: ${e}`);throw e}class Ap{constructor(e){this.comparator=e?(t,n)=>e(t,n)||Bo.comparator(t.key,n.key):(e,t)=>Bo.comparator(e.key,t.key),this.keyedMap=Ou(),this.sortedSet=new Ha(this.comparator)}static emptySet(e){return new Ap(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ap))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Ap;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class kp{constructor(){this.L_=new Ha(Bo.comparator)}track(e){const t=e.doc.key,n=this.L_.get(t);n?0!==e.type&&3===n.type?this.L_=this.L_.insert(t,e):3===e.type&&1!==n.type?this.L_=this.L_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.L_=this.L_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.L_=this.L_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.L_=this.L_.remove(t):1===e.type&&2===n.type?this.L_=this.L_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.L_=this.L_.insert(t,{type:2,doc:e.doc}):mo():this.L_=this.L_.insert(t,e)}k_(){const e=[];return this.L_.inorderTraversal(((t,n)=>{e.push(n)})),e}}class Np{constructor(e,t,n,r,i,s,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new Np(e,t,Ap.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&bu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class Dp{constructor(){this.q_=void 0,this.Q_=[]}}class xp{constructor(){this.queries=new Nu((e=>Eu(e)),bu),this.onlineState="Unknown",this.K_=new Set}}async function Rp(e,t){const n=vo(e),r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new Dp),i)try{s.q_=await n.onListen(r)}catch(e){const n=Cp(e,`Initialization of query '${Tu(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.Q_.push(t),t.U_(n.onlineState),s.q_&&t.W_(s.q_)&&Mp(n)}async function Op(e,t){const n=vo(e),r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.Q_.indexOf(t);e>=0&&(s.Q_.splice(e,1),i=0===s.Q_.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function Pp(e,t){const n=vo(e);let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.Q_)t.W_(e)&&(r=!0);i.q_=e}}r&&Mp(n)}function Lp(e,t,n){const r=vo(e),i=r.queries.get(t);if(i)for(const e of i.Q_)e.onError(n);r.queries.delete(t)}function Mp(e){e.K_.forEach((e=>{e.next()}))}class Up{constructor(e,t,n){this.query=e,this.G_=t,this.z_=!1,this.j_=null,this.onlineState="Unknown",this.options=n||{}}W_(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Np(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.z_?this.H_(e)&&(this.G_.next(e),t=!0):this.J_(e,this.onlineState)&&(this.Y_(e),t=!0),this.j_=e,t}onError(e){this.G_.error(e)}U_(e){this.onlineState=e;let t=!1;return this.j_&&!this.z_&&this.J_(this.j_,e)&&(this.Y_(this.j_),t=!0),t}J_(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return(!this.options.Z_||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}H_(e){if(e.docChanges.length>0)return!0;const t=this.j_&&this.j_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Y_(e){e=Np.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.z_=!0,this.G_.next(e)}}class Fp{constructor(e){this.key=e}}class Vp{constructor(e){this.key=e}}class Bp{constructor(e,t){this.query=e,this.oa=t,this._a=null,this.hasCachedResults=!1,this.current=!1,this.aa=Bu(),this.mutatedKeys=Bu(),this.ua=Au(e),this.ca=new Ap(this.ua)}get la(){return this.oa}ha(e,t){const n=t?t.Pa:new kp,r=t?t.ca:this.ca;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),h=Su(this.query,t)?t:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.Ia(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.ua(h,a)>0||c&&this.ua(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(s=s.add(h),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{ca:s,Pa:n,Xi:o,mutatedKeys:i}}Ia(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const i=this.ca;this.ca=e.ca,this.mutatedKeys=e.mutatedKeys;const s=e.Pa.k_();s.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return mo()}};return n(e)-n(t)}(e.type,t.type)||this.ua(e.doc,t.doc))),this.Ta(n),r=null!=r&&r;const o=t&&!r?this.Ea():[],a=0===this.aa.size&&this.current&&!r?1:0,c=a!==this._a;return this._a=a,0!==s.length||c?{snapshot:new Np(this.query,e.ca,i,s,e.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),da:o}:{da:o}}U_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ca:this.ca,Pa:new kp,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{da:[]}}Aa(e){return!this.oa.has(e)&&!!this.ca.has(e)&&!this.ca.get(e).hasLocalMutations}Ta(e){e&&(e.addedDocuments.forEach((e=>this.oa=this.oa.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.oa=this.oa.delete(e))),this.current=e.current)}Ea(){if(!this.current)return[];const e=this.aa;this.aa=Bu(),this.ca.forEach((e=>{this.Aa(e.key)&&(this.aa=this.aa.add(e.key))}));const t=[];return e.forEach((e=>{this.aa.has(e)||t.push(new Vp(e))})),this.aa.forEach((n=>{e.has(n)||t.push(new Fp(n))})),t}Ra(e){this.oa=e.hs,this.aa=Bu();const t=this.ha(e.documents);return this.applyChanges(t,!0)}Va(){return Np.fromInitialDocuments(this.query,this.ca,this.mutatedKeys,0===this._a,this.hasCachedResults)}}class qp{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class jp{constructor(e){this.key=e,this.ma=!1}}class zp{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.fa={},this.ga=new Nu((e=>Eu(e)),bu),this.pa=new Map,this.ya=new Set,this.wa=new Ha(Bo.comparator),this.Sa=new Map,this.ba=new Gd,this.Da={},this.Ca=new Map,this.va=bd.Bn(),this.onlineState="Unknown",this.Fa=void 0}get isPrimaryClient(){return!0===this.Fa}}async function Kp(e,t){const n=mg(e);let r,i;const s=n.ga.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.Va();else{const e=await yf(n.localStore,wu(t)),s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await $p(n,t,r,"current"===s,e.resumeToken),n.isPrimaryClient&&Zf(n.remoteStore,e)}return i}async function $p(e,t,n,r,i){e.Ma=(t,n,r)=>async function(e,t,n,r){let i=t.view.ha(n);i.Xi&&(i=await wf(e.localStore,t.query,!1).then((({documents:e})=>t.view.ha(e,i))));const s=r&&r.targetChanges.get(t.targetId),o=r&&null!=r.targetMismatches.get(t.targetId),a=t.view.applyChanges(i,e.isPrimaryClient,s,o);return ng(e,t.targetId,a.da),a.snapshot}(e,t,n,r);const s=await wf(e.localStore,t,!0),o=new Bp(t,s.hs),a=o.ha(s.documents),c=Oh.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=o.applyChanges(a,e.isPrimaryClient,c);ng(e,n,u.da);const h=new qp(t,n,o);return e.ga.set(t,h),e.pa.has(n)?e.pa.get(n).push(t):e.pa.set(n,[t]),u.snapshot}async function Gp(e,t){const n=vo(e),r=n.ga.get(t),i=n.pa.get(r.targetId);if(i.length>1)return n.pa.set(r.targetId,i.filter((e=>!bu(e,t)))),void n.ga.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await vf(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),ep(n.remoteStore,r.targetId),eg(n,r.targetId)})).catch(Xo)):(eg(n,r.targetId),await vf(n.localStore,r.targetId,!0))}async function Hp(e,t){const n=vo(e);try{const e=await function(e,t){const n=vo(e),r=t.snapshotVersion;let i=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.os.newChangeBuffer({trackRemovals:!0});i=n.ns;const o=[];t.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Qr.removeMatchingKeys(e,s.removedDocuments,a).next((()=>n.Qr.addMatchingKeys(e,s.addedDocuments,a))));let u=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(tc.EMPTY_BYTE_STRING,Lo.min()).withLastLimboFreeSnapshotVersion(Lo.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.Qr.updateTargetData(e,u))}));let a=xu(),c=Bu();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(function(e,t,n){let r=Bu(),i=Bu();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=xu();return n.forEach(((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(Lo.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):lo("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{cs:r,ls:i}}))}(e,s,t.documentUpdates).next((e=>{a=e.cs,c=e.ls}))),!r.isEqual(Lo.min())){const t=n.Qr.getLastRemoteSnapshotVersion(e).next((t=>n.Qr.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return Zo.waitFor(o).next((()=>s.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,c))).next((()=>a))})).then((e=>(n.ns=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.Sa.get(t);r&&(yo(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.ma=!0:e.modifiedDocuments.size>0?yo(r.ma):e.removedDocuments.size>0&&(yo(r.ma),r.ma=!1))})),await sg(n,e,t)}catch(e){await Xo(e)}}function Qp(e,t,n){const r=vo(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.ga.forEach(((n,r)=>{const i=r.view.U_(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=vo(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.Q_)e.U_(t)&&(r=!0)})),r&&Mp(n)}(r.eventManager,t),e.length&&r.fa.u_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Wp(e,t,n){const r=vo(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Sa.get(t),s=i&&i.key;if(s){let e=new Ha(Bo.comparator);e=e.insert(s,Pc.newNoDocument(s,Lo.min()));const n=Bu().add(s),i=new Rh(Lo.min(),new Map,new Ha(xo),e,n);await Hp(r,i),r.wa=r.wa.remove(s),r.Sa.delete(t),ig(r)}else await vf(r.localStore,t,!1).then((()=>eg(r,t,n))).catch(Xo)}async function Yp(e,t){const n=vo(e),r=t.batch.batchId;try{const e=await function(e,t){const n=vo(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.os.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=Zo.resolve();return s.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);yo(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Bu();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);Zp(n,r,null),Xp(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await sg(n,e)}catch(e){await Xo(e)}}async function Jp(e,t,n){const r=vo(e);try{const e=await function(e,t){const n=vo(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(yo(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);Zp(r,t,n),Xp(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await sg(r,e)}catch(n){await Xo(n)}}function Xp(e,t){(e.Ca.get(t)||[]).forEach((e=>{e.resolve()})),e.Ca.delete(t)}function Zp(e,t,n){const r=vo(e);let i=r.Da[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Da[r.currentUser.toKey()]=i}}function eg(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.pa.get(t))e.ga.delete(r),n&&e.fa.xa(r,n);e.pa.delete(t),e.isPrimaryClient&&e.ba.Vr(t).forEach((t=>{e.ba.containsKey(t)||tg(e,t)}))}function tg(e,t){e.ya.delete(t.path.canonicalString());const n=e.wa.get(t);null!==n&&(ep(e.remoteStore,n),e.wa=e.wa.remove(t),e.Sa.delete(n),ig(e))}function ng(e,t,n){for(const r of n)r instanceof Fp?(e.ba.addReference(r.key,t),rg(e,r)):r instanceof Vp?(lo("SyncEngine","Document no longer in limbo: "+r.key),e.ba.removeReference(r.key,t),e.ba.containsKey(r.key)||tg(e,r.key)):mo()}function rg(e,t){const n=t.key,r=n.path.canonicalString();e.wa.get(n)||e.ya.has(r)||(lo("SyncEngine","New document in limbo: "+n),e.ya.add(r),ig(e))}function ig(e){for(;e.ya.size>0&&e.wa.size<e.maxConcurrentLimboResolutions;){const t=e.ya.values().next().value;e.ya.delete(t);const n=new Bo(Uo.fromString(t)),r=e.va.next();e.Sa.set(r,new jp(n)),e.wa=e.wa.insert(n,r),Zf(e.remoteStore,new _l(wu(gu(n.path)),r,"TargetPurposeLimboResolution",la._e))}}async function sg(e,t,n){const r=vo(e),i=[],s=[],o=[];r.ga.isEmpty()||(r.ga.forEach(((e,a)=>{o.push(r.Ma(a,t,n).then((e=>{if((e||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){i.push(e);const t=uf.Ki(a.targetId,e);s.push(t)}})))})),await Promise.all(o),r.fa.u_(i),await async function(e,t){const n=vo(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>Zo.forEach(t,(t=>Zo.forEach(t.qi,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>Zo.forEach(t.Qi,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!ia(e))throw e;lo("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.ns.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.ns=n.ns.insert(t,i)}}}(r.localStore,s))}async function og(e,t){const n=vo(e);if(!n.currentUser.isEqual(t)){lo("SyncEngine","User change. New user:",t.toKey());const e=await pf(n.localStore,t);n.currentUser=t,function(e,t){e.Ca.forEach((e=>{e.forEach((e=>{e.reject(new _o(wo.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.Ca.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await sg(n,e.us)}}function ag(e,t){const n=vo(e),r=n.Sa.get(t);if(r&&r.ma)return Bu().add(r.key);{let e=Bu();const r=n.pa.get(t);if(!r)return e;for(const t of r){const r=n.ga.get(t);e=e.unionWith(r.view.la)}return e}}async function cg(e,t){const n=vo(e),r=await wf(n.localStore,t.query,!0),i=t.view.Ra(r);return n.isPrimaryClient&&ng(n,t.targetId,i.da),i}async function ug(e,t){const n=vo(e);return If(n.localStore,t).then((e=>sg(n,e)))}async function hg(e,t,n,r){const i=vo(e),s=await function(e,t){const n=vo(e),r=vo(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",(e=>r.vn(e,t).next((t=>t?n.localDocuments.getDocuments(e,t):Zo.resolve(null)))))}(i.localStore,t);null!==s?("pending"===n?await dp(i.remoteStore):"acknowledged"===n||"rejected"===n?(Zp(i,t,r||null),Xp(i,t),function(e,t){vo(vo(e).mutationQueue).Mn(t)}(i.localStore,t)):mo(),await sg(i,s)):lo("SyncEngine","Cannot apply mutation batch with id: "+t)}async function lg(e,t,n){const r=vo(e),i=[],s=[];for(const e of t){let t;const n=r.pa.get(e);if(n&&0!==n.length){t=await yf(r.localStore,wu(n[0]));for(const e of n){const t=r.ga.get(e),n=await cg(r,t);n.snapshot&&s.push(n.snapshot)}}else{const n=await _f(r.localStore,e);t=await yf(r.localStore,n),await $p(r,dg(n),e,!1,t.resumeToken)}i.push(t)}return r.fa.u_(s),i}function dg(e){return pu(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function fg(e){return function(e){return vo(vo(e).persistence).Li()}(vo(e).localStore)}async function pg(e,t,n,r){const i=vo(e);if(i.Fa)return void lo("SyncEngine","Ignoring unexpected query state notification.");const s=i.pa.get(t);if(s&&s.length>0)switch(n){case"current":case"not-current":{const e=await If(i.localStore,Cu(s[0])),r=Rh.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,tc.EMPTY_BYTE_STRING);await sg(i,e,r);break}case"rejected":await vf(i.localStore,t,!0),eg(i,t,r);break;default:mo()}}async function gg(e,t,n){const r=mg(e);if(r.Fa){for(const e of t){if(r.pa.has(e)){lo("SyncEngine","Adding an already active target "+e);continue}const t=await _f(r.localStore,e),n=await yf(r.localStore,t);await $p(r,dg(t),n.targetId,!1,n.resumeToken),Zf(r.remoteStore,n)}for(const e of n)r.pa.has(e)&&await vf(r.localStore,e,!1).then((()=>{ep(r.remoteStore,e),eg(r,e)})).catch(Xo)}}function mg(e){const t=vo(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Hp.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=ag.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Wp.bind(null,t),t.fa.u_=Pp.bind(null,t.eventManager),t.fa.xa=Lp.bind(null,t.eventManager),t}function yg(e){const t=vo(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Yp.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Jp.bind(null,t),t}class vg{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=zf(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return ff(this.persistence,new lf,e.initialUser,this.serializer)}createPersistence(e){return new Xd(ef.Hr,this.serializer)}createSharedClientState(e){return new Rf}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class wg extends vg{constructor(e,t,n){super(),this.Na=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Na.initialize(this,e),await yg(this.Na.syncEngine),await dp(this.Na.remoteStore),await this.persistence.fi((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}createLocalStore(e){return ff(this.persistence,new lf,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new Nd(n,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const n=new ha(t,this.persistence);return new ua(e.asyncQueue,n)}createPersistence(e){const t=cf(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?pd.withCacheSize(this.cacheSizeBytes):pd.DEFAULT;return new sf(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,qf(),jf(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Rf}}class _g extends wg{constructor(e,t){super(e,t,!1),this.Na=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Na.syncEngine;this.sharedClientState instanceof xf&&(this.sharedClientState.syncEngine={Zs:hg.bind(null,t),Xs:pg.bind(null,t),eo:gg.bind(null,t),Li:fg.bind(null,t),Ys:ug.bind(null,t)},await this.sharedClientState.start()),await this.persistence.fi((async e=>{await async function(e,t){const n=vo(e);if(mg(n),yg(n),!0===t&&!0!==n.Fa){const e=n.sharedClientState.getAllActiveQueryTargets(),t=await lg(n,e.toArray());n.Fa=!0,await bp(n.remoteStore,!0);for(const e of t)Zf(n.remoteStore,e)}else if(!1===t&&!1!==n.Fa){const e=[];let t=Promise.resolve();n.pa.forEach(((r,i)=>{n.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then((()=>(eg(n,i),vf(n.localStore,i,!0)))),ep(n.remoteStore,i)})),await t,await lg(n,e),function(e){const t=vo(e);t.Sa.forEach(((e,n)=>{ep(t.remoteStore,n)})),t.ba.mr(),t.Sa=new Map,t.wa=new Ha(Bo.comparator)}(n),n.Fa=!1,await bp(n.remoteStore,!1)}}(this.Na.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())}))}createSharedClientState(e){const t=qf();if(!xf.D(t))throw new _o(wo.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=cf(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new xf(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class Ig{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Qp(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=og.bind(null,this.syncEngine),await bp(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new xp}createDatastore(e){const t=zf(e.databaseInfo.databaseId),n=function(e){return new Bf(e)}(e.databaseInfo);return function(e,t,n,r){return new Qf(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,i){return new Yf(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,(e=>Qp(this.syncEngine,e,0)),Pf.D()?new Pf:new Of)}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new zp(e,t,n,r,i,s);return o&&(a.Fa=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e;await async function(e){const t=vo(e);lo("RemoteStore","RemoteStore shutting down."),t.v_.add(5),await Xf(t),t.M_.shutdown(),t.x_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate()}}class bg{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ba(this.observer.next,e)}error(e){this.observer.error?this.Ba(this.observer.error,e):fo("Uncaught Error in snapshot listener:",e.toString())}La(){this.muted=!0}Ba(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class Eg{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=ao.UNAUTHENTICATED,this.clientId=Do.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{lo("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(lo("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new _o(wo.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Io;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Cp(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function Tg(e,t){e.asyncQueue.verifyOperationInProgress(),lo("FirestoreClient","Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await pf(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function Sg(e,t){e.asyncQueue.verifyOperationInProgress();const n=await async function(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){lo("FirestoreClient","Using user provided OfflineComponentProvider");try{await Tg(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!function(e){return"FirebaseError"===e.name?e.code===wo.FAILED_PRECONDITION||e.code===wo.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;po("Error using user provided cache. Falling back to memory cache: "+n),await Tg(e,new vg)}}else lo("FirestoreClient","Using default OfflineComponentProvider"),await Tg(e,new vg);return e._offlineComponents}(e);lo("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener((e=>Ip(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>Ip(t.remoteStore,n))),e._onlineComponents=t}async function Cg(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(lo("FirestoreClient","Using user provided OnlineComponentProvider"),await Sg(e,e._uninitializedComponentsProvider._online)):(lo("FirestoreClient","Using default OnlineComponentProvider"),await Sg(e,new Ig))),e._onlineComponents}async function Ag(e){const t=await Cg(e),n=t.eventManager;return n.onListen=Kp.bind(null,t.syncEngine),n.onUnlisten=Gp.bind(null,t.syncEngine),n}function kg(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const Ng=new Map;function Dg(e,t,n){if(!n)throw new _o(wo.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function xg(e){if(!Bo.isDocumentKey(e))throw new _o(wo.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Rg(e){if(Bo.isDocumentKey(e))throw new _o(wo.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Og(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":mo()}function Pg(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new _o(wo.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Og(e);throw new _o(wo.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}class Lg{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new _o(wo.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new _o(wo.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new _o(wo.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=kg(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new _o(wo.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new _o(wo.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new _o(wo.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Mg{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Lg({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new _o(wo.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new _o(wo.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Lg(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Eo;switch(e.type){case"firstParty":return new Co(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new _o(wo.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Ng.get(e);t&&(lo("ComponentProvider","Removing Datastore"),Ng.delete(e),t.terminate())}(this),Promise.resolve()}}class Ug{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Ug(this.firestore,e,this._query)}}class Fg{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Vg(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Fg(this.firestore,e,this._key)}}class Vg extends Ug{constructor(e,t,n){super(e,t,gu(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Fg(this.firestore,null,new Bo(e))}withConverter(e){return new Vg(this.firestore,e,this._path)}}class Bg{constructor(){this.Xa=Promise.resolve(),this.eu=[],this.tu=!1,this.nu=[],this.ru=null,this.iu=!1,this.su=!1,this.ou=[],this.jo=new Kf(this,"async_queue_retry"),this._u=()=>{const e=jf();e&&lo("AsyncQueue","Visibility state changed to "+e.visibilityState),this.jo.Ko()};const e=jf();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this._u)}get isShuttingDown(){return this.tu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.au(),this.uu(e)}enterRestrictedMode(e){if(!this.tu){this.tu=!0,this.su=e||!1;const t=jf();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._u)}}enqueue(e){if(this.au(),this.tu)return new Promise((()=>{}));const t=new Io;return this.uu((()=>this.tu&&this.su?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.eu.push(e),this.cu())))}async cu(){if(0!==this.eu.length){try{await this.eu[0](),this.eu.shift(),this.jo.reset()}catch(e){if(!ia(e))throw e;lo("AsyncQueue","Operation failed with retryable error: "+e)}this.eu.length>0&&this.jo.qo((()=>this.cu()))}}uu(e){const t=this.Xa.then((()=>(this.iu=!0,e().catch((e=>{this.ru=e,this.iu=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw fo("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.iu=!1,e))))));return this.Xa=t,t}enqueueAfterDelay(e,t,n){this.au(),this.ou.indexOf(e)>-1&&(t=0);const r=Sp.createAndSchedule(this,e,t,n,(e=>this.lu(e)));return this.nu.push(r),r}au(){this.ru&&mo()}verifyOperationInProgress(){}async hu(){let e;do{e=this.Xa,await e}while(e!==this.Xa)}Pu(e){for(const t of this.nu)if(t.timerId===e)return!0;return!1}Iu(e){return this.hu().then((()=>{this.nu.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.nu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.hu()}))}Tu(e){this.ou.push(e)}lu(e){const t=this.nu.indexOf(e);this.nu.splice(t,1)}}function qg(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of["next","error","complete"])if(e in n&&"function"==typeof n[e])return!0;return!1}(e)}class jg extends Mg{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new Bg,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Kg(this),this._firestoreClient.terminate()}}function zg(e){return e._firestoreClient||Kg(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Kg(e){var t,n,r;const i=e._freezeSettings(),s=function(e,t,n,r){return new uc(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,kg(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._firestoreClient=new Eg(e._authCredentials,e._appCheckCredentials,e._queue,s),(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}class $g{constructor(e){this._byteString=e}static fromBase64String(e){try{return new $g(tc.fromBase64String(e))}catch(e){throw new _o(wo.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new $g(tc.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Gg{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new _o(wo.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Vo(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Hg{constructor(e){this._methodName=e}}class Qg{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new _o(wo.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new _o(wo.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return xo(this._lat,e._lat)||xo(this._long,e._long)}}const Wg=/^__.*__$/;class Yg{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new ph(e,this.data,this.fieldMask,t,this.fieldTransforms):new fh(e,this.data,t,this.fieldTransforms)}}function Jg(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw mo()}}class Xg{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Eu(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get du(){return this.settings.du}Au(e){return new Xg(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ru(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Au({path:n,Vu:!1});return r.mu(e),r}fu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Au({path:n,Vu:!1});return r.Eu(),r}gu(e){return this.Au({path:void 0,Vu:!0})}pu(e){return um(e,this.settings.methodName,this.settings.yu||!1,this.path,this.settings.wu)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}Eu(){if(this.path)for(let e=0;e<this.path.length;e++)this.mu(this.path.get(e))}mu(e){if(0===e.length)throw this.pu("Document fields must not be empty");if(Jg(this.du)&&Wg.test(e))throw this.pu('Document fields cannot begin and end with "__"')}}class Zg{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||zf(e)}Su(e,t,n,r=!1){return new Xg({du:e,methodName:t,wu:n,path:Vo.emptyPath(),Vu:!1,yu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function em(e){const t=e._freezeSettings(),n=zf(e._databaseId);return new Zg(e._databaseId,!!t.ignoreUndefinedProperties,n)}function tm(e,t,n,r,i,s={}){const o=e.Su(s.merge||s.mergeFields?2:0,t,n,i);sm("Data must be an object, but it was:",o,r);const a=rm(r,o);let c,u;if(s.merge)c=new Za(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=om(t,r,n);if(!o.contains(i))throw new _o(wo.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);hm(e,i)||e.push(i)}c=new Za(e),u=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,u=o.fieldTransforms;return new Yg(new Rc(a),c,u)}function nm(e,t){if(im(e=b(e)))return sm("Unsupported field value:",t,e),rm(e,t);if(e instanceof Hg)return function(e,t){if(!Jg(t.du))throw t.pu(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.pu(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Vu&&4!==t.du)throw t.pu("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=nm(i,t.gu(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=b(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return function(e,t){return pa(t)?Ku(t):zu(e,t)}(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=Po.fromDate(e);return{timestampValue:Gh(t.serializer,n)}}if(e instanceof Po){const n=new Po(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Gh(t.serializer,n)}}if(e instanceof Qg)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof $g)return{bytesValue:Hh(t.serializer,e._byteString)};if(e instanceof Fg){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.pu(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Yh(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.pu(`Unsupported field value: ${Og(e)}`)}(e,t)}function rm(e,t){const n={};return Ga(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):$a(e,((e,r)=>{const i=nm(r,t.Ru(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function im(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Po||e instanceof Qg||e instanceof $g||e instanceof Fg||e instanceof Hg)}function sm(e,t,n){if(!im(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=Og(n);throw"an object"===r?t.pu(e+" a custom object"):t.pu(e+" "+r)}}function om(e,t,n){if((t=b(t))instanceof Gg)return t._internalPath;if("string"==typeof t)return cm(e,t);throw um("Field path arguments must be of type string or ",e,!1,void 0,n)}const am=new RegExp("[~\\*/\\[\\]]");function cm(e,t,n){if(t.search(am)>=0)throw um(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Gg(...t.split("."))._internalPath}catch(r){throw um(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function um(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new _o(wo.INVALID_ARGUMENT,a+e+c)}function hm(e,t){return e.some((e=>e.isEqual(t)))}class lm{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Fg(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new dm(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(fm("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class dm extends lm{data(){return super.data()}}function fm(e,t){return"string"==typeof t?cm(e,t):t instanceof Gg?t._internalPath:t._delegate._internalPath}class pm{}class gm extends pm{}class mm extends gm{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new mm(e,t,n)}_apply(e){const t=this._parse(e);return _m(e._query,t),new Ug(e.firestore,e.converter,_u(e._query,t))}_parse(e){const t=em(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new _o(wo.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){wm(o,s);const t=[];for(const n of o)t.push(vm(r,e,n));a={arrayValue:{values:t}}}else a=vm(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||wm(o,s),a=function(e,t,n,r=!1){return nm(n,e.Su(r?4:3,t))}(n,"where",o,"in"===s||"not-in"===s);return qc.create(i,s,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}class ym extends pm{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new ym(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:jc.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const e of r)_m(n,e),n=_u(n,e)}(e._query,t),new Ug(e.firestore,e.converter,_u(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function vm(e,t,n){if("string"==typeof(n=b(n))){if(""===n)throw new _o(wo.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!yu(t)&&-1!==n.indexOf("/"))throw new _o(wo.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(Uo.fromString(n));if(!Bo.isDocumentKey(r))throw new _o(wo.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return _c(e,new Bo(r))}if(n instanceof Fg)return _c(e,n._key);throw new _o(wo.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Og(n)}.`)}function wm(e,t){if(!Array.isArray(e)||0===e.length)throw new _o(wo.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function _m(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new _o(wo.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new _o(wo.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class Im{convertValue(e,t="none"){switch(fc(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ic(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(sc(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw mo()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return $a(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertGeoPoint(e){return new Qg(ic(e.latitude),ic(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=ac(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(cc(e));default:return null}}convertTimestamp(e){const t=rc(e);return new Po(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Uo.fromString(e);yo(wl(n));const r=new hc(n.get(1),n.get(3)),i=new Bo(n.popFirst(5));return r.isEqual(t)||fo(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class bm{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Em extends lm{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Tm(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(fm("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Tm extends Em{data(e={}){return super.data(e)}}class Sm{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new bm(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new Tm(this._firestore,this._userDataWriter,n.key,n,new bm(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new _o(wo.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const r=new Tm(e._firestore,e._userDataWriter,n.doc.key,n.doc,new bm(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new Tm(e._firestore,e._userDataWriter,t.doc.key,t.doc,new bm(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:Cm(t.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Cm(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return mo()}}class Am extends Im{constructor(e){super(),this.firestore=e}convertBytes(e){return new $g(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Fg(this.firestore,null,t)}}function km(e,t,n){const r=n.docs.get(t._key),i=new Am(e);return new Em(e,i,t._key,r,new bm(n.hasPendingWrites,n.fromCache),t.converter)}class Nm{constructor(e){let t;this.kind="persistent",(null==e?void 0:e.tabManager)?(e.tabManager._initialize(e),t=e.tabManager):(t=new Dm(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class Dm{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=new Ig,this._offlineComponentProvider=new wg(this._onlineComponentProvider,null==e?void 0:e.cacheSizeBytes,this.forceOwnership)}}class xm{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=new Ig,this._offlineComponentProvider=new _g(this._onlineComponentProvider,null==e?void 0:e.cacheSizeBytes)}}function Rm(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}!function(e,t=!0){co=ce,ie(new E("firestore",((e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),s=new jg(new To(e.getProvider("auth-internal")),new ko(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new _o(wo.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new hc(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),le(oo,"4.4.2",e),le(oo,"4.4.2","esm2017")}(),"function"==typeof SuppressedError&&SuppressedError;const Om=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},Pm=new f("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Lm=new R("@firebase/auth");function Mm(e,...t){Lm.logLevel<=A.ERROR&&Lm.error(`Auth (${ce}): ${e}`,...t)}function Um(e,...t){throw Vm(e,...t)}function Fm(e,...t){return Vm(e,...t)}function Vm(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return Pm.create(e,...t)}function Bm(e,t,...n){if(!e)throw Vm(t,...n)}function qm(e){const t="INTERNAL ASSERTION FAILED: "+e;throw Mm(t),new Error(t)}function jm(e,t){e||qm(t)}function zm(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class Km{constructor(e,t){this.shortDelay=e,this.longDelay=t,jm(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(u())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===zm()||"https:"===zm()||function(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}class $m{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void qm("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void qm("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void qm("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Gm={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Hm=new Km(3e4,6e4);function Qm(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Wm(e,t,n,r,i={}){return Ym(e,i,(async()=>{let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});const o=y(Object.assign({key:e.config.apiKey},s)).slice(1),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),$m.fetch()(Xm(e,e.config.apiHost,n,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},i))}))}async function Ym(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},Gm),t);try{const t=new ey(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw ty(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw ty(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw ty(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw ty(e,"user-disabled",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw function(e,t,n){const r=Object.assign(Object.assign({},Om()),{[t]:n});return new f("auth","Firebase",r).create(t,{appName:e.name})}(e,a,o);Um(e,a)}}catch(t){if(t instanceof d)throw t;Um(e,"network-request-failed",{message:String(t)})}}async function Jm(e,t,n,r,i={}){const s=await Wm(e,t,n,r,i);return"mfaPendingCredential"in s&&Um(e,"multi-factor-auth-required",{_serverResponse:s}),s}function Xm(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?function(e,t){jm(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}(e.config,i):`${e.config.apiScheme}://${i}`}function Zm(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class ey{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(Fm(this.auth,"network-request-failed"))),Hm.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function ty(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Fm(e,t,r);return i.customData._tokenResponse=n,i}function ny(e){return void 0!==e&&void 0!==e.enterprise}class ry{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Zm(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}}function iy(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function sy(e){return 1e3*Number(e)}function oy(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return Mm("JWT malformed, contained fewer than 3 sections"),null;try{const e=i(n);return e?JSON.parse(e):(Mm("Failed to decode base64 JWT payload"),null)}catch(e){return Mm("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function ay(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof d&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class cy{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class uy{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=iy(this.lastLoginAt),this.creationTime=iy(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function hy(e){var t;const n=e.auth,r=await e.getIdToken(),i=await ay(e,async function(e,t){return Wm(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:r}));Bm(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?s.providerUserInfo.map((e=>{var{providerId:t}=e,n=Rm(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[],a=(c=e.providerData,u=o,[...c.filter((e=>!u.some((t=>t.providerId===e.providerId)))),...u]);var c,u;const h=e.isAnonymous,l=!(e.email&&s.passwordHash||(null==a?void 0:a.length)),d=!!h&&l,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new uy(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,f)}class ly{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Bm(e.idToken,"internal-error"),Bm(void 0!==e.idToken,"internal-error"),Bm(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=oy(e);return Bm(t,"internal-error"),Bm(void 0!==t.exp,"internal-error"),Bm(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return Bm(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await Ym(e,{},(async()=>{const n=y({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=Xm(e,r,"/v1/token",`key=${i}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",$m.fetch()(s,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new ly;return n&&(Bm("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(Bm("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(Bm("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ly,this.toJSON())}_performRefresh(){return qm("not implemented")}}function dy(e,t){Bm("string"==typeof e||void 0===e,"internal-error",{appName:t})}class fy{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=Rm(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new cy(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new uy(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await ay(this,this.stsTokenManager.getToken(this.auth,e));return Bm(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=b(e),r=await n.getIdToken(t),i=oy(r);Bm(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"==typeof i.firebase?i.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:iy(sy(i.auth_time)),issuedAtTime:iy(sy(i.iat)),expirationTime:iy(sy(i.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=b(e);await hy(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(Bm(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new fy(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Bm(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await hy(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await ay(this,async function(e,t){return Wm(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,c,u;const h=null!==(n=t.displayName)&&void 0!==n?n:void 0,l=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:_,providerData:I,stsTokenManager:b}=t;Bm(v&&b,e,"internal-error");const E=ly.fromJSON(this.name,b);Bm("string"==typeof v,e,"internal-error"),dy(h,e.name),dy(l,e.name),Bm("boolean"==typeof w,e,"internal-error"),Bm("boolean"==typeof _,e,"internal-error"),dy(d,e.name),dy(f,e.name),dy(p,e.name),dy(g,e.name),dy(m,e.name),dy(y,e.name);const T=new fy({uid:v,auth:e,email:l,emailVerified:w,displayName:h,isAnonymous:_,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:E,createdAt:m,lastLoginAt:y});return I&&Array.isArray(I)&&(T.providerData=I.map((e=>Object.assign({},e)))),g&&(T._redirectEventId=g),T}static async _fromIdTokenResponse(e,t,n=!1){const r=new ly;r.updateFromServerResponse(t);const i=new fy({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await hy(i),i}}const py=new Map;function gy(e){jm(e instanceof Function,"Expected a class definition");let t=py.get(e);return t?(jm(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,py.set(e,t),t)}class my{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}my.type="NONE";const yy=my;function vy(e,t,n){return`firebase:${e}:${t}:${n}`}class wy{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=vy(this.userKey,r.apiKey,i),this.fullPersistenceKey=vy("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?fy._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new wy(gy(yy),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=r[0]||gy(yy);const s=vy(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(s);if(t){const r=fy._fromJSON(e,t);n!==i&&(o=r),i=n;break}}catch(e){}const a=r.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new wy(i,e,n)):new wy(i,e,n)}}function _y(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(by(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(function(e=u()){return/firefox\//i.test(e)}(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Ty(t))return"Blackberry";if(Sy(t))return"Webos";if(Iy(t))return"Safari";if((t.includes("chrome/")||function(e=u()){return/crios\//i.test(e)}(t))&&!t.includes("edge/"))return"Chrome";if(Ey(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function Iy(e=u()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function by(e=u()){return/iemobile/i.test(e)}function Ey(e=u()){return/android/i.test(e)}function Ty(e=u()){return/blackberry/i.test(e)}function Sy(e=u()){return/webos/i.test(e)}function Cy(e=u()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Ay(e,t=[]){let n;switch(e){case"Browser":n=_y(u());break;case"Worker":n=`${_y(u())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${ce}/${r}`}class ky{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(e){r(e)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class Ny{constructor(e){var t,n,r,i;const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=s.minPasswordLength)&&void 0!==t?t:6,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(r=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==r?r:"",this.forceUpgradeOnSignin=null!==(i=e.forceUpgradeOnSignin)&&void 0!==i&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,i,s,o;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null===(t=a.meetsMinPasswordLength)||void 0===t||t),a.isValid&&(a.isValid=null===(n=a.meetsMaxPasswordLength)||void 0===n||n),a.isValid&&(a.isValid=null===(r=a.containsLowercaseLetter)||void 0===r||r),a.isValid&&(a.isValid=null===(i=a.containsUppercaseLetter)||void 0===i||i),a.isValid&&(a.isValid=null===(s=a.containsNumericCharacter)||void 0===s||s),a.isValid&&(a.isValid=null===(o=a.containsNonAlphanumericCharacter)||void 0===o||o),a}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class Dy{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ry(this),this.idTokenSubscription=new Ry(this),this.beforeStateQueue=new ky(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Pm,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=gy(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await wy.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUser(e){var t;const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==r?void 0:r._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==s||!(null==o?void 0:o.user)||(r=o.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Bm(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await hy(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?b(e):null;return t&&Bm(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Bm(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(gy(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return Wm(e,"GET","/v2/passwordPolicy",Qm(e,t))}(this),t=new Ny(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new f("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise(((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged((()=>{n(),e()}),t)}}))}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return Wm(e,"POST","/v2/accounts:revokeToken",Qm(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&gy(e)||this._popupRedirectResolver;Bm(t,this,"argument-error"),this.redirectPersistenceManager=await wy.create(this,[gy(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t);let s=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(Bm(o,this,"internal-error"),o.then((()=>{s||i(this.currentUser)})),"function"==typeof t){const i=e.addObserver(t,n,r);return()=>{s=!0,i()}}{const n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Bm(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Ay(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){Lm.logLevel<=A.WARN&&Lm.warn(`Auth (${ce}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function xy(e){return b(e)}class Ry{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new _(e,void 0);return n.subscribe.bind(n)}((e=>this.observer=e))}get next(){return Bm(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Oy={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};class Py{constructor(e){this.type="recaptcha-enterprise",this.auth=xy(e)}async verify(e="verify",t=!1){function n(t,n,r){const i=window.grecaptcha;ny(i)?i.enterprise.ready((()=>{i.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n("NO_RECAPTCHA")}))})):r(Error("No reCAPTCHA enterprise script loaded."))}return new Promise(((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{(async function(e,t){return Wm(e,"GET","/v2/recaptchaConfig",Qm(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}))})(e).then((r=>{if(void 0!==r.recaptchaKey){const n=new ry(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((i=>{if(!t&&ny(window.grecaptcha))n(i,e,r);else{if("undefined"==typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=Oy.recaptchaEnterpriseScript;0!==t.length&&(t+=i),function(e){return Oy.loadJS(e)}(t).then((()=>{n(i,e,r)})).catch((e=>{r(e)}))}})).catch((e=>{r(e)}))}))}}async function Ly(e,t,n,r=!1){const i=new Py(e);let s;try{s=await i.verify(n)}catch(e){s=await i.verify(n,!0)}const o=Object.assign({},t);return r?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function My(e,t,n,r){var i;if(null===(i=e._getRecaptchaConfig())||void 0===i?void 0:i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await Ly(e,t,n,"getOobCode"===n);return r(e,i)}return r(e,t).catch((async i=>{if("auth/missing-recaptcha-token"===i.code){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const i=await Ly(e,t,n,"getOobCode"===n);return r(e,i)}return Promise.reject(i)}))}class Uy{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return qm("not implemented")}_getIdTokenResponse(e){return qm("not implemented")}_linkToIdToken(e,t){return qm("not implemented")}_getReauthenticationResolver(e){return qm("not implemented")}}async function Fy(e,t){return Wm(e,"POST","/v1/accounts:signUp",t)}async function Vy(e,t){return Jm(e,"POST","/v1/accounts:signInWithPassword",Qm(e,t))}async function By(e,t){return Wm(e,"POST","/v1/accounts:sendOobCode",Qm(e,t))}async function qy(e,t){return By(e,t)}class jy extends Uy{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new jy(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new jy(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return My(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Vy);case"emailLink":return async function(e,t){return Jm(e,"POST","/v1/accounts:signInWithEmailLink",Qm(e,t))}(e,{email:this._email,oobCode:this._password});default:Um(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return My(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Fy);case"emailLink":return async function(e,t){return Jm(e,"POST","/v1/accounts:signInWithEmailLink",Qm(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Um(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}class zy{constructor(e){var t,n,r,i,s,o;const a=v(w(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,u=null!==(n=a.oobCode)&&void 0!==n?n:null,h=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);Bm(c&&u&&h,"argument-error"),this.apiKey=c,this.operation=h,this.code=u,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=a.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=v(w(e)).link,n=t?v(w(t)).deep_link_id:null,r=v(w(e)).deep_link_id;return(r?v(w(r)).link:null)||r||n||t||e}(e);try{return new zy(t)}catch(e){return null}}}class Ky{constructor(){this.providerId=Ky.PROVIDER_ID}static credential(e,t){return jy._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=zy.parseLink(t);return Bm(n,"argument-error"),jy._fromEmailAndCode(e,n.code,n.tenantId)}}Ky.PROVIDER_ID="password",Ky.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Ky.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class $y{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await fy._fromIdTokenResponse(e,n,r),s=Gy(n);return new $y({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=Gy(n);return new $y({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Gy(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Hy extends d{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,Hy.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new Hy(e,t,n,r)}}function Qy(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw Hy._fromErrorAndOperation(e,n,t,r);throw n}))}function Wy(e,t,n){var r;Bm((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),Bm(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(Bm(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(Bm(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function Yy(e,t,n){const{auth:r}=e,i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);const s=await ay(e,async function(e,t){return Wm(e,"POST","/v1/accounts:update",t)}(r,i));await e._updateTokensIfNecessary(s,!0)}const Jy="__sak";class Xy{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Jy,"1"),this.storage.removeItem(Jy),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Zy extends Xy{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=u();return Iy(e)||Cy(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=function(e=u()){return Cy(e)||Ey(e)||Sy(e)||Ty(e)||/windows phone/i.test(e)||by(e)}(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);!function(){const e=u();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()||10!==document.documentMode||i===e.newValue||e.newValue===e.oldValue?r():setTimeout(r,10)}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Zy.type="LOCAL";const ev=Zy;(class extends Xy{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}).type="SESSION",new Km(3e4,6e4),new Km(2e3,1e4),new Km(3e4,6e4),new Km(5e3,15e3);var tv,nv,rv="@firebase/auth",iv="1.6.0";class sv{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Bm(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}null===(nv=s())||void 0===nv||nv._authIdTokenMaxAge,function(e){Oy=e}({loadJS:e=>new Promise(((t,n)=>{const r=document.createElement("script");var i,s;r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=Fm("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",(null!==(s=null===(i=document.getElementsByTagName("head"))||void 0===i?void 0:i[0])&&void 0!==s?s:document).appendChild(r)})),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="}),tv="Browser",ie(new E("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=n.options;Bm(s&&!s.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:s,authDomain:o,clientPlatform:tv,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ay(tv)},c=new Dy(n,r,i,a);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(gy);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(c,t),c}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),ie(new E("auth-internal",(e=>{return t=xy(e.getProvider("auth").getImmediate()),new sv(t);var t}),"PRIVATE").setInstantiationMode("EXPLICIT")),le(rv,iv,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(tv)),le(rv,iv,"esm2017");var ov={App:{initializeApp:ue},Functions:{getFunctions:function(e=he(),t=De){const n=se(b(e),Ce).getImmediate({identifier:t}),r=o("functions");return r&&function(e,t,n){!function(e,t,n){e.emulatorOrigin=`http://${t}:${n}`}(b(e),t,n)}(n,...r),n},httpsCallable:function(e,t,n){return function(e,t,n){return r=>function(e,t,n,r){const i=e._url(t);return async function(e,t,n,r){const i={data:n=Te(n)},s={},o=await e.contextProvider.getContext(r.limitedUseAppCheckTokens);o.authToken&&(s.Authorization="Bearer "+o.authToken),o.messagingToken&&(s["Firebase-Instance-ID-Token"]=o.messagingToken),null!==o.appCheckToken&&(s["X-Firebase-AppCheck"]=o.appCheckToken);const a=function(e){let t=null;return{promise:new Promise(((n,r)=>{t=setTimeout((()=>{r(new ke("deadline-exceeded","deadline-exceeded"))}),e)})),cancel:()=>{t&&clearTimeout(t)}}}(r.timeout||7e4),c=await Promise.race([Re(t,i,s,e.fetchImpl),a.promise,e.cancelAllRequests]);if(a.cancel(),!c)throw new ke("cancelled","Firebase Functions instance was deleted.");const u=function(e,t){let n,r=function(e){if(e>=200&&e<300)return"ok";switch(e){case 0:case 500:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(e),i=r;try{const e=t&&t.error;if(e){const t=e.status;if("string"==typeof t){if(!Ae[t])return new ke("internal","internal");r=Ae[t],i=t}const s=e.message;"string"==typeof s&&(i=s),n=e.details,void 0!==n&&(n=Se(n))}}catch(e){}return"ok"===r?null:new ke(r,i,n)}(c.status,c.json);if(u)throw u;if(!c.json)throw new ke("internal","Response is not valid JSON object.");let h=c.json.data;if(void 0===h&&(h=c.json.result),void 0===h)throw new ke("internal","Response is missing data field.");return{data:Se(h)}}(e,i,n,r)}(e,t,r,n||{})}(b(e),t,n)}},Storage:{deleteObject:function(e){return function(e){e._throwIfRoot("deleteObject");const t=function(e,t){const n=tt(t.fullServerUrl(),e.host,e._protocol),r=e.maxOperationRetryTime,i=new mt(n,"DELETE",(function(e,t){}),r);return i.successCodes=[200,204],i.errorHandler=_t(t),i}(e.storage,e._location);return e.storage.makeRequestWithTokens(t,Mt)}(e=b(e))},getMetadata:function(e){return function(e){e._throwIfRoot("getMetadata");const t=It(e.storage,e._location,pt());return e.storage.makeRequestWithTokens(t,Mt)}(e=b(e))},getStorage:function(e=he(),t){const n=se(e=b(e),$t).getImmediate({identifier:t}),i=o("storage");return i&&function(e,t,n,i={}){!function(e,t,n,i={}){e.host=`${t}:${n}`,e._protocol="http";const{mockUserToken:s}=i;s&&(e._overrideAuthToken="string"==typeof s?s:function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",i=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e);return[r(JSON.stringify({alg:"none",type:"JWT"})),r(JSON.stringify(o)),""].join(".")}(s,e.app.options.projectId))}(e,t,n,i)}(n,...i),n},ref:function(e,t){return Bt(e=b(e),t)},uploadBytesResumable:function(e,t,n){return function(e,t,n){return e._throwIfRoot("uploadBytesResumable"),new Ut(e,new ut(t),n)}(e=b(e),t,n)}},Firestore:{collection:function(e,t,...n){if(e=b(e),Dg("collection","path",t),e instanceof Mg){const r=Uo.fromString(t,...n);return Rg(r),new Vg(e,null,r)}{if(!(e instanceof Fg||e instanceof Vg))throw new _o(wo.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(Uo.fromString(t,...n));return Rg(r),new Vg(e.firestore,null,r)}},doc:function(e,t,...n){if(e=b(e),1===arguments.length&&(t=Do.newId()),Dg("doc","path",t),e instanceof Mg){const r=Uo.fromString(t,...n);return xg(r),new Fg(e,null,new Bo(r))}{if(!(e instanceof Fg||e instanceof Vg))throw new _o(wo.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(Uo.fromString(t,...n));return xg(r),new Fg(e.firestore,e instanceof Vg?e.converter:null,new Bo(r))}},getDoc:function(e){e=Pg(e,Fg);const t=Pg(e.firestore,jg);return function(e,t,n={}){const r=new Io;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new bg({next:s=>{t.enqueueAndForget((()=>Op(e,o)));const a=s.docs.has(n);!a&&s.fromCache?i.reject(new _o(wo.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new _o(wo.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new Up(gu(n.path),s,{includeMetadataChanges:!0,Z_:!0});return Rp(e,o)}(await Ag(e),e.asyncQueue,t,n,r))),r.promise}(zg(t),e._key).then((n=>km(t,e,n)))},initializeFirestore:function(e,t,n){n||(n="(default)");const r=se(e,"firestore");if(r.isInitialized(n)){const e=r.getImmediate({identifier:n});if(g(r.getOptions(n),t))return e;throw new _o(wo.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&&void 0!==t.localCache)throw new _o(wo.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(void 0!==t.cacheSizeBytes&&-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new _o(wo.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:t,instanceIdentifier:n})},query:function(e,t,...n){let r=[];t instanceof pm&&r.push(t),r=r.concat(n),function(e){const t=e.filter((e=>e instanceof ym)).length,n=e.filter((e=>e instanceof mm)).length;if(t>1||t>0&&n>0)throw new _o(wo.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e},onSnapshot:function(e,...t){var n,r,i;e=b(e);let s={includeMetadataChanges:!1},o=0;"object"!=typeof t[o]||qg(t[o])||(s=t[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(qg(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[o+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}let c,u,h;if(e instanceof Fg)u=Pg(e.firestore,jg),h=gu(e._key.path),c={next:n=>{t[o]&&t[o](km(u,e,n))},error:t[o+1],complete:t[o+2]};else{const n=Pg(e,Ug);u=Pg(n.firestore,jg),h=n._query;const r=new Am(u);c={next:e=>{t[o]&&t[o](new Sm(u,r,n,e))},error:t[o+1],complete:t[o+2]},function(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new _o(wo.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(e._query)}return function(e,t,n,r){const i=new bg(r),s=new Up(t,i,n);return e.asyncQueue.enqueueAndForget((async()=>Rp(await Ag(e),s))),()=>{i.La(),e.asyncQueue.enqueueAndForget((async()=>Op(await Ag(e),s)))}}(zg(u),h,a,c)},persistentLocalCache:function(e){return new Nm(e)},persistentMultipleTabManager:function(){return new xm},setDoc:function(e,t,n){e=Pg(e,Fg);const r=Pg(e.firestore,jg),i=function(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}(e.converter,t,n);return function(e,t){return function(e,t){const n=new Io;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=yg(e);try{const e=await function(e,t){const n=vo(e),r=Po.now(),i=t.reduce(((e,t)=>e.add(t.key)),Bu());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=xu(),c=Bu();return n.os.getEntries(e,i).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((i=>{s=i;const o=[];for(const e of t){const t=lh(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new ph(e.key,t,Oc(t.value.mapValue),sh.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)})).next((t=>{o=t;const r=t.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:Pu(s)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Da[e.currentUser.toKey()];r||(r=new Ha(xo)),r=r.insert(t,n),e.Da[e.currentUser.toKey()]=r}(r,e.batchId,n),await sg(r,e.changes),await dp(r.remoteStore)}catch(e){const t=Cp(e,"Failed to persist write");n.reject(t)}}(await function(e){return Cg(e).then((e=>e.syncEngine))}(e),t,n))),n.promise}(zg(e),t)}(r,[tm(em(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,sh.none())])},where:function(e,t,n){const r=t,i=fm("where",e);return mm._create(i,r,n)}},Auth:{EmailAuthProvider:Ky,initializeAuth:function(e,t){const n=se(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(g(n.getOptions(),null!=t?t:{}))return e;Um(e,"already-initialized")}return n.initialize({options:t})},reauthenticateWithCredential:async function(e,t){return async function(e,t,n=!1){const{auth:r}=e,i="reauthenticate";try{const s=await ay(e,Qy(r,i,t,e),n);Bm(s.idToken,r,"internal-error");const o=oy(s.idToken);Bm(o,r,"internal-error");const{sub:a}=o;return Bm(e.uid===a,r,"user-mismatch"),$y._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&Um(r,"user-mismatch"),e}}(b(e),t)},sendEmailVerification:async function(e,t){const n=b(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&Wy(n.auth,r,t);const{email:i}=await async function(e,t){return By(e,t)}(n.auth,r);i!==e.email&&await e.reload()},sendPasswordResetEmail:async function(e,t,n){const r=xy(e),i={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};n&&Wy(r,i,n),await My(r,i,"getOobCode",qy)},signInWithEmailAndPassword:function(e,t,n){return async function(e,t){return async function(e,t,n=!1){const r="signIn",i=await Qy(e,r,t),s=await $y._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}(xy(e),t)}(b(e),Ky.credential(t,n)).catch((async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&async function(e){const t=xy(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}(e),t}))},signOut:function(e){return b(e).signOut()},onAuthStateChanged:function(e,t,n,r){return b(e).onAuthStateChanged(t,n,r)},updateEmail:function(e,t){return Yy(b(e),t,null)},updatePassword:function(e,t){return Yy(b(e),null,t)},browserLocalPersistence:ev}};export{ov as default};